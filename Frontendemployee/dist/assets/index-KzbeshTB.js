import{ap as Ze,ag as J,aq as Xe,ah as F,ao as f,ar as je,as as et,at as Q,_ as d,au as tt,av as He,aw as U,ax as C,S as L,ay as q,az as H,aA as it,aB as nt,aC as rt}from"./index-BRB0XtRz.js";import{aD as ui}from"./index-BRB0XtRz.js";var G={exports:{}},ie,ge;function st(){if(ge)return ie;ge=1,ie=i;function i(e,t){if(e&&t)return i(e)(t);if(typeof e!="function")throw new TypeError("need wrapper function");return Object.keys(e).forEach(function(r){n[r]=e[r]}),n;function n(){for(var r=new Array(arguments.length),o=0;o<r.length;o++)r[o]=arguments[o];var s=e.apply(this,r),c=r[r.length-1];return typeof s=="function"&&s!==c&&Object.keys(c).forEach(function(a){s[a]=c[a]}),s}}return ie}var Ee;function pe(){if(Ee)return G.exports;Ee=1;var i=st();G.exports=i(e),G.exports.strict=i(t),e.proto=e(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return e(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return t(this)},configurable:!0})});function e(n){var r=function(){return r.called?r.value:(r.called=!0,r.value=n.apply(this,arguments))};return r.called=!1,r}function t(n){var r=function(){if(r.called)throw new Error(r.onceError);return r.called=!0,r.value=n.apply(this,arguments)},o=n.name||"Function wrapped with `once`";return r.onceError=o+" shouldn't be called more than once",r.called=!1,r}return G.exports}var ne,_e;function Fe(){if(_e)return ne;_e=1;var i=pe(),e=function(){},t=Ze.Bare?queueMicrotask:process.nextTick.bind(process),n=function(s){return s.setHeader&&typeof s.abort=="function"},r=function(s){return s.stdio&&Array.isArray(s.stdio)&&s.stdio.length===3},o=function(s,c,a){if(typeof c=="function")return o(s,null,c);c||(c={}),a=i(a||e);var u=s._writableState,g=s._readableState,E=c.readable||c.readable!==!1&&s.readable,l=c.writable||c.writable!==!1&&s.writable,v=!1,m=function(){s.writable||w()},w=function(){l=!1,E||a.call(s)},y=function(){E=!1,l||a.call(s)},_=function(O){a.call(s,O?new Error("exited with error code: "+O):null)},S=function(O){a.call(s,O)},P=function(){t(R)},R=function(){if(!v){if(E&&!(g&&g.ended&&!g.destroyed))return a.call(s,new Error("premature close"));if(l&&!(u&&u.ended&&!u.destroyed))return a.call(s,new Error("premature close"))}},x=function(){s.req.on("finish",w)};return n(s)?(s.on("complete",w),s.on("abort",P),s.req?x():s.on("request",x)):l&&!u&&(s.on("end",m),s.on("close",m)),r(s)&&s.on("exit",_),s.on("end",y),s.on("finish",w),c.error!==!1&&s.on("error",S),s.on("close",P),function(){v=!0,s.removeListener("complete",w),s.removeListener("abort",P),s.removeListener("request",x),s.req&&s.req.removeListener("finish",w),s.removeListener("end",m),s.removeListener("close",m),s.removeListener("finish",w),s.removeListener("exit",_),s.removeListener("end",y),s.removeListener("error",S),s.removeListener("close",P)}};return ne=o,ne}var ot=Fe();const ve=J(ot);var at=pe();const ct=J(at);var re,ye;function dt(){if(ye)return re;ye=1;var i=pe(),e=Fe(),t;try{t=Xe}catch{}var n=function(){},r=typeof process>"u"?!1:/^v?\.0/.test(process.version),o=function(l){return typeof l=="function"},s=function(l){return!r||!t?!1:(l instanceof(t.ReadStream||n)||l instanceof(t.WriteStream||n))&&o(l.close)},c=function(l){return l.setHeader&&o(l.abort)},a=function(l,v,m,w){w=i(w);var y=!1;l.on("close",function(){y=!0}),e(l,{readable:v,writable:m},function(S){if(S)return w(S);y=!0,w()});var _=!1;return function(S){if(!y&&!_){if(_=!0,s(l))return l.close(n);if(c(l))return l.abort();if(o(l.destroy))return l.destroy();w(S||new Error("stream was destroyed"))}}},u=function(l){l()},g=function(l,v){return l.pipe(v)},E=function(){var l=Array.prototype.slice.call(arguments),v=o(l[l.length-1]||n)&&l.pop()||n;if(Array.isArray(l[0])&&(l=l[0]),l.length<2)throw new Error("pump requires two streams per minimum");var m,w=l.map(function(y,_){var S=_<l.length-1,P=_>0;return a(y,S,P,function(R){m||(m=R),R&&w.forEach(u),!S&&(w.forEach(u),v(m))})});return l.reduce(g)};return re=E,re}var lt=dt();const Se=J(lt),de=F.getLogger("auth");de.setLevel("error");const p={MAINNET:"mainnet",TESTNET:"testnet",CYAN:"cyan",AQUA:"aqua",CELESTE:"celeste"},W={SAPPHIRE_DEVNET:"sapphire_devnet",SAPPHIRE_MAINNET:"sapphire_mainnet"};p.MAINNET+"",p.TESTNET+"",p.CYAN+"",p.AQUA+"",p.CELESTE+"";p.AQUA+"",W.SAPPHIRE_MAINNET,p.CELESTE+"",W.SAPPHIRE_MAINNET,p.CYAN+"",W.SAPPHIRE_MAINNET,p.MAINNET+"",W.SAPPHIRE_MAINNET,p.TESTNET+"",W.SAPPHIRE_DEVNET;p.MAINNET+"",p.TESTNET+"",p.CYAN+"",p.AQUA+"",p.CELESTE+"";const ut={[W.SAPPHIRE_MAINNET]:"https://api.web3auth.io/signer-service",[W.SAPPHIRE_DEVNET]:"https://api.web3auth.io/signer-service",[p.MAINNET]:"https://api.web3auth.io/signer-service",[p.TESTNET]:"https://api.web3auth.io/signer-service",[p.CYAN]:"https://api.web3auth.io/signer-polygon-service",[p.AQUA]:"https://api.web3auth.io/signer-polygon-service",[p.CELESTE]:"https://api.web3auth.io/signer-polygon-service"};p.MAINNET+"",p.TESTNET+"",p.CYAN+"",p.AQUA+"",p.CELESTE+"";const le=F.getLogger("http-helpers");le.setLevel(et.levels.INFO);let ht="torus-default";const ft="x-api-key";async function pt(i,e){let t=null;try{t=new URL(i)}catch{}return fetch(i,e)}function mt(){const i={};return i[ft]=ht,i}function wt(i){le.info(`Response: ${i.status} ${i.statusText}`),le.info(`Url: ${i.url}`)}const gt=async(i,e={},t={})=>{const n={mode:"cors",headers:{}};t.useAPIKey&&(n.headers=f(f({},n.headers),mt())),e.method="GET";const r=je(n,e),o=await pt(i,r);if(o.ok){const s=o.headers.get("content-type");return s!=null&&s.includes("application/json")?o.json():o.text()}throw wt(o),o},Et=p,_t=W,vt=f(f({},_t),Et),se={light:"light",dark:"dark"};function $(){}const be="SYN",oe="ACK",Ae="BRK";class Ie extends Q.Duplex{constructor({name:e,target:t,targetWindow:n=window,targetOrigin:r="*"}){if(super({objectMode:!0}),d(this,"_init",void 0),d(this,"_haveSyn",void 0),d(this,"_name",void 0),d(this,"_target",void 0),d(this,"_targetWindow",void 0),d(this,"_targetOrigin",void 0),d(this,"_onMessage",void 0),d(this,"_synIntervalId",void 0),!e||!t)throw new Error("Invalid input.");this._init=!1,this._haveSyn=!1,this._name=e,this._target=t,this._targetWindow=n,this._targetOrigin=r,this._onMessage=this.onMessage.bind(this),this._synIntervalId=null,window.addEventListener("message",this._onMessage,!1),this._handShake()}_break(){this.cork(),this._write(Ae,null,$),this._haveSyn=!1,this._init=!1}_handShake(){this._write(be,null,$),this.cork()}_onData(e){if(!this._init)e===be?(this._haveSyn=!0,this._write(oe,null,$)):e===oe&&(this._init=!0,this._haveSyn||this._write(oe,null,$),this.uncork());else if(e===Ae)this._break();else try{this.push(e)}catch(t){this.emit("error",t)}}_postMessage(e){const t=this._targetOrigin;this._targetWindow.postMessage({target:this._target,data:e},t)}onMessage(e){const t=e.data;this._targetOrigin!=="*"&&e.origin!==this._targetOrigin||e.source!==this._targetWindow||typeof t!="object"||t.target!==this._name||!t.data||this._onData(t.data)}_read(){}_write(e,t,n){this._postMessage(e),n()}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}function Te(i,e,t){try{Reflect.apply(i,e,t)}catch(n){setTimeout(()=>{throw n})}}function yt(i){const e=i.length,t=new Array(e);for(let n=0;n<e;n+=1)t[n]=i[n];return t}class Z extends tt.EventEmitter{emit(e,...t){let n=e==="error";const r=this._events;if(r!==void 0)n=n&&r.error===void 0;else if(!n)return!1;if(n){let s;if(t.length>0&&([s]=t),s instanceof Error)throw s;const c=new Error(`Unhandled error.${s?` (${s.message})`:""}`);throw c.context=s,c}const o=r[e];if(o===void 0)return!1;if(typeof o=="function")Te(o,this,t);else{const s=o.length,c=yt(o);for(let a=0;a<s;a+=1)Te(c[a],this,t)}return!0}}class j extends Error{constructor({code:e,message:t,data:n}){if(!Number.isInteger(e))throw new Error("code must be an integer");if(!t||typeof t!="string")throw new Error("message must be string");super(t),d(this,"code",void 0),d(this,"data",void 0),this.code=e,n!==void 0&&(this.data=n)}toString(){return He({code:this.code,message:this.message,data:this.data,stack:this.stack})}}class St extends Q.Duplex{constructor({parent:e,name:t}){super({objectMode:!0}),d(this,"_parent",void 0),d(this,"_name",void 0),this._parent=e,this._name=t}_read(){}_write(e,t,n){this._parent.push({name:this._name,data:e}),n()}}const T={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603}},Oe={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};var ke=function(i,e){if(typeof i>"u"||i===null)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(i),e)};const Ce=T.rpc.internal,bt="Unspecified error message. This is a bug, please report it.",At="Unspecified server error.";function qe(i){return Number.isInteger(i)}function Ne(i){return typeof i=="string"&&i.length>0}function K(i){return!!i&&typeof i=="object"&&!Array.isArray(i)}function It(i){if(typeof i!="object"||i===null)return!1;try{let e=i;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(i)===e}catch{return!1}}function Tt(i){return i>=-32099&&i<=-32e3}function Ge(i){const e=i;return!(!e||!qe(e.code)||!Ne(e.message)||e.stack&&!Ne(e.stack))}function me(i,e=bt){if(qe(i)){const t=i.toString();if(ke(Oe,t))return Oe[t].message;if(Tt(i))return At}return e}const Ot={code:Ce,message:me(Ce)};function ue(i){try{JSON.parse(JSON.stringify(i,(e,t)=>{if(e==="__proto__"||e==="constructor")throw new Error("Not valid json");if(typeof t=="function"||typeof t=="symbol")throw new Error("Not valid json");return t}),(e,t)=>{if(!(e==="__proto__"||e==="constructor"))return t})}catch{return!1}return!0}function Pe(i){return Object.getOwnPropertyNames(i).reduce((e,t)=>{const n=i[t];return ue(n)&&(e[t]=n),e},{})}function $e(i){return Array.isArray(i)?i.map(e=>ue(e)?e:K(e)?Pe(e):null):K(i)?Pe(i):ue(i)?i:null}function Ct(i,e){if(i&&typeof i=="object"&&"serialize"in i&&typeof i.serialize=="function")return i.serialize();if(Ge(i))return i;const t=$e(i);return f(f({},e),{},{data:{cause:t}})}function Re(i,{fallbackError:e=Ot,shouldIncludeStack:t=!0}={}){if(!Ge(e))throw new Error("Must provide fallback error with integer number code and string message.");const n=Ct(i,e);return t||delete n.stack,n}function Nt(i){return K(i)&&ke(i,"cause")&&K(i.cause)}var Pt=function(i,e){if(typeof i>"u"||i===null)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(i),e)};function Rt(i){return Number.isInteger(i)&&i>=1e3&&i<=4999}function Wt(i,e){if(e!=="[Circular]")return e}class Be extends Error{constructor(e,t,n){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!t||typeof t!="string")throw new Error('"message" must be a non-empty string.');Nt(n)?(super(t,{cause:n.cause}),d(this,"cause",void 0),d(this,"code",void 0),d(this,"data",void 0),Pt(this,"cause")||Object.assign(this,{cause:n.cause})):(super(t),d(this,"cause",void 0),d(this,"code",void 0),d(this,"data",void 0)),n!==void 0&&(this.data=n),this.code=e,this.cause=n==null?void 0:n.cause}serialize(){const e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data,It(this.data)&&(e.data.cause=$e(this.data.cause))),this.stack&&(e.stack=this.stack),e}toString(){return He(this.serialize(),{replacer:Wt,space:2})}}class Y extends Be{constructor(e,t,n){if(!Rt(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,n)}}function Lt(i){if(i){if(typeof i=="string")return[i];if(typeof i=="object"&&!Array.isArray(i)){const{message:e,data:t}=i;if(e&&typeof e!="string")throw new Error("Must specify string message.");return[e??void 0,t]}}return[]}function I(i,e){const[t,n]=Lt(e);return new Be(i,t??me(i),n)}const z={parse:i=>I(T.rpc.parse,i),invalidRequest:i=>I(T.rpc.invalidRequest,i),invalidParams:i=>I(T.rpc.invalidParams,i),methodNotFound:i=>I(T.rpc.methodNotFound,i),internal:i=>I(T.rpc.internal,i),server:i=>{if(!i||typeof i!="object"||Array.isArray(i))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:e}=i;if(!Number.isInteger(e)||e>-32005||e<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return I(e,i)},invalidInput:i=>I(T.rpc.invalidInput,i),resourceNotFound:i=>I(T.rpc.resourceNotFound,i),resourceUnavailable:i=>I(T.rpc.resourceUnavailable,i),transactionRejected:i=>I(T.rpc.transactionRejected,i),methodNotSupported:i=>I(T.rpc.methodNotSupported,i),limitExceeded:i=>I(T.rpc.limitExceeded,i)},he=(i,e,t=!0)=>(n,r)=>{n||r.error?e(n||r.error):!t||Array.isArray(r)?i(r):i(r.result)};function Dt(){const i={};function e(){return!1}const t=new Z;function n(a){const u=i[a.id];if(!u)throw new Error(`StreamMiddleware - Unknown response id "${a.id}"`);delete i[a.id],Object.assign(u.res,a),setTimeout(u.end)}function r(a){t.emit("notification",a)}function o(a,u,g){let E;try{!a.id?r(a):n(a)}catch(l){E=l}g(E)}const s=new Q.Duplex({objectMode:!0,read:e,write:o});return{events:t,middleware:(a,u,g,E)=>{s.push(a),i[a.id]={req:a,res:u,next:g,end:E}},stream:s}}function Mt(){return(i,e,t,n)=>{const r=i.id,o=Math.random().toString(36).slice(2);i.id=o,e.id=o,t(s=>{i.id=r,e.id=r,s()})}}function We(i){const{message:e="",code:t=-32603,stack:n="Stack trace is not available.",data:r=""}=i,o=parseInt((t==null?void 0:t.toString())||"-32603");return{message:e||(i==null?void 0:i.toString())||me(o),code:o,stack:n,data:r||e||(i==null?void 0:i.toString())}}class N extends Z{constructor(){super(),d(this,"_middleware",void 0),this._middleware=[]}static async _runAllMiddleware(e,t,n){const r=[];let o=null,s=!1;for(const c of n)if([o,s]=await N._runMiddleware(e,t,c,r),s)break;return[o,s,r.reverse()]}static _runMiddleware(e,t,n,r){return new Promise(o=>{const s=a=>{const u=a||t.error;u&&(typeof u=="object"&&Object.keys(u).includes("stack")===!1&&(u.stack="Stack trace is not available."),de.error(u),t.error=Re(u,{shouldIncludeStack:!0,fallbackError:We(u)})),o([u,!0])},c=a=>{t.error?s(t.error):(a&&(typeof a!="function"&&s(new j({code:-32603,message:"JRPCEngine: 'next' return handlers must be functions"})),r.push(a)),o([null,!1]))};try{n(e,t,c,s)}catch(a){s(a)}})}static async _runReturnHandlers(e){for(const t of e)await new Promise((n,r)=>{t(o=>o?r(o):n())})}static _checkForCompletion(e,t,n){if(!("result"in t)&&!("error"in t))throw new j({code:-32603,message:"Response has no error or result for request"});if(!n)throw new j({code:-32603,message:"Nothing ended request"})}push(e){this._middleware.push(e)}handle(e,t){if(t&&typeof t!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(e)?t?this._handleBatch(e,t):this._handleBatch(e):t?this._handle(e,t):this._promiseHandle(e)}asMiddleware(){return async(e,t,n,r)=>{try{const[o,s,c]=await N._runAllMiddleware(e,t,this._middleware);return s?(await N._runReturnHandlers(c),r(o)):n(async a=>{try{await N._runReturnHandlers(c)}catch(u){return a(u)}return a()})}catch(o){return r(o)}}}async _handleBatch(e,t){try{const n=await Promise.all(e.map(this._promiseHandle.bind(this)));return t?t(null,n):n}catch(n){if(t)return t(n);throw n}}_promiseHandle(e){return new Promise((t,n)=>{this._handle(e,(r,o)=>{r&&o===void 0?n(r):t(o)}).catch(n)})}async _handle(e,t){if(!e||Array.isArray(e)||typeof e!="object"){const s=new j({code:-32603,message:"request must be plain object"});return t(s,{id:void 0,jsonrpc:"2.0",error:s})}if(typeof e.method!="string"){const s=new j({code:-32603,message:"method must be string"});return t(s,{id:e.id,jsonrpc:"2.0",error:s})}const n=f({},e),r={id:n.id,jsonrpc:n.jsonrpc};let o=null;try{await this._processRequest(n,r)}catch(s){o=s}return o&&(delete r.result,r.error||(typeof o=="object"&&Object.keys(o).includes("stack")===!1&&(o.stack="Stack trace is not available."),de.error(o),r.error=Re(o,{shouldIncludeStack:!0,fallbackError:We(o)}))),t(o,r)}async _processRequest(e,t){const[n,r,o]=await N._runAllMiddleware(e,t,this._middleware);if(N._checkForCompletion(e,t,r),await N._runReturnHandlers(o),n)throw n}}const Le=Symbol("IGNORE_SUBSTREAM");class Ut extends Q.Duplex{constructor(e={}){super(f(f({},e),{},{objectMode:!0})),d(this,"_substreams",void 0),d(this,"getStream",void 0),this._substreams={}}createStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);const t=new St({parent:this,name:e});return this._substreams[e]=t,xt(this,n=>t.destroy(n||void 0)),t}ignoreStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);this._substreams[e]=Le}_read(){}_write(e,t,n){const{name:r,data:o}=e;if(!r)return window.console.warn(`ObjectMultiplex - malformed chunk without name "${e}"`),n();const s=this._substreams[r];return s?(s!==Le&&s.push(o),n()):(window.console.warn(`ObjectMultiplex - orphaned data for stream "${r}"`),n())}}function xt(i,e){const t=ct(e);ve(i,{readable:!1},t),ve(i,{writable:!1},t)}const jt={height:660,width:375},ze={height:700,width:1200},Ht={height:700,width:450},Ft="setup_complete",M={IFRAME_STATUS:"iframe_status",CLOSE_WINDOW:"close_window",USER_LOGGED_IN:"user_logged_in",USER_LOGGED_OUT:"user_logged_out",TOGGLE_WIDGET_BUTTON:"toggle_widget_button",ALLOW_WALLET_SERVICE:"allow_wallet_service"},b={LOGOUT:"logout",WALLET_INSTANCE_ID:"wallet_instance_id",USER_INFO:"user_info",SET_PROVIDER:"set_provider",TOPUP:"topup",IFRAME_STATUS:"iframe_status",CLOSED_WINDOW:"closed_window",WINDOW_BLOCKED:"window_blocked",GET_PROVIDER_STATE:"get_provider_state",LOGIN_WITH_PRIVATE_KEY:"login_with_private_key",SHOW_WALLET_CONNECT:"show_wallet_connect",SHOW_FUNDING:"show_funding",SHOW_CHECKOUT:"show_checkout",SHOW_RECEIVE:"show_receive",SHOW_TRANSFER:"show_transfer",SHOW_WALLET_UI:"show_wallet_ui",SHOW_SWAP:"show_swap",LOGIN_WITH_SESSION_ID:"login_with_session_id"},Ve={GET_PROVIDER_STATE:"wallet_get_provider_state",WALLET_SWITCH_CHAIN:"wallet_switchChain"},ae={ACCOUNTS_CHANGED:"wallet_accounts_changed",CHAIN_CHANGED:"wallet_chain_changed",UNLOCK_STATE_CHANGED:"wallet_unlock_state_changed"},D={POPUP:"popup",MODAL:"modal",AUTO_APPROVE:"auto-approve",DEFAULT:"default"},B=()=>Math.random().toString(36).slice(2);function V({width:i,height:e}){const t=window.screenLeft!==void 0?window.screenLeft:window.screenX,n=window.screenTop!==void 0?window.screenTop:window.screenY,r=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,s=1,c=Math.abs((r-i)/2/s+t),a=Math.abs((o-e)/2/s+n);return`titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${e/s},width=${i/s},top=${a},left=${c}`}function kt(i){return function(t,n,r){r(o=>{n.error&&F.warn(`Error in RPC response:
`,n),!t.isTorusInternal&&(F.info(`RPC (${i.origin}):`,t,"->",n),o())})}}function Ke(i){return i!==null&&typeof i=="object"&&typeof i.pipe=="function"}function qt(i){return Ke(i)&&i.writable!==!1&&typeof i._write=="function"&&typeof i._writableState=="object"}function Gt(i){return Ke(i)&&i.readable!==!1&&typeof i._read=="function"&&typeof i._readableState=="object"}function $t(i){return qt(i)&&Gt(i)}var A={errors:{disconnected:()=>"Web3Auth: Lost connection to Web3Auth.",permanentlyDisconnected:()=>"Web3Auth: Disconnected from iframe. Page reload required.",unsupportedSync:i=>`Web3Auth: The Web3Auth Ethereum provider does not support synchronous methods like ${i} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidOptions:i=>`Invalid options. Received: { maxEventListeners: ${i}}`,invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:i=>`'args.logger' must include required method '${i}'.`},info:{connected:i=>`Web3Auth: Connected to chain with ID "${i}".`}},h=F.getLogger("ws-embed");function Bt(){return(i,e,t)=>{(typeof i.method!="string"||!i.method)&&(e.error=z.invalidRequest({message:"The request 'method' must be a non-empty string.",data:f(f({},i||{}),{},{cause:"The request 'method' must be a non-empty string."})})),t(n=>{const{error:r}=e;return r&&h.error(`Ws-Embed - RPC Error: ${r.message}`,r),n()})}}function zt(i,e,t){let n=`Web3Auth: Lost connection to "${i}".`;e!=null&&e.stack&&(n+=`
${e.stack}`),h.warn(n),t&&t.listenerCount("error")>0&&t.emit("error",n)}const Vt=["eth_subscription"],Kt=(i=vt.SAPPHIRE_MAINNET)=>ut[i],Yt=async({clientId:i,web3AuthNetwork:e,authBuildEnv:t})=>{const n=new URL(`${Kt(e)}/api/v2/configuration`);return n.searchParams.append("project_id",i),n.searchParams.append("network",e),t&&n.searchParams.append("build_env",t),await gt(n.href)};class Ye extends Z{constructor(e,{maxEventListeners:t=100,jsonRpcStreamName:n="provider"}){if(super(),d(this,"rpcEngine",void 0),d(this,"jsonRpcConnectionEvents",void 0),d(this,"isWeb3Auth",void 0),d(this,"state",void 0),!$t(e))throw new Error(A.errors.invalidDuplexStream());this.isWeb3Auth=!0,this.setMaxListeners(t),this.handleConnect=this.handleConnect.bind(this),this.handleDisconnect=this.handleDisconnect.bind(this),this.handleStreamDisconnect=this.handleStreamDisconnect.bind(this),this.rpcRequest=this.rpcRequest.bind(this),this.initializeState=this.initializeState.bind(this),this.request=this.request.bind(this),this.sendAsync=this.sendAsync.bind(this),this.send=this.send.bind(this);const r=new Ut;Se(e,r,e,this.handleStreamDisconnect.bind(this,"Web3Auth")),r.ignoreStream("phishing");const o=Dt();Se(o.stream,r.createStream(n),o.stream,this.handleStreamDisconnect.bind(this,"Web3Auth RpcProvider"));const s=new N;s.push(Mt()),s.push(Bt()),s.push(kt({origin:location.origin})),s.push(o.middleware),this.rpcEngine=s,this.jsonRpcConnectionEvents=o.events}async request(e){if(!e||typeof e!="object"||Array.isArray(e))throw z.invalidRequest({message:A.errors.invalidRequestArgs(),data:f(f({},e||{}),{},{cause:A.errors.invalidRequestArgs()})});const{method:t,params:n}=e;if(typeof t!="string"||t.length===0)throw z.invalidRequest({message:A.errors.invalidRequestMethod(),data:f(f({},e||{}),{},{cause:A.errors.invalidRequestArgs()})});if(n!==void 0&&!Array.isArray(n)&&(typeof n!="object"||n===null))throw z.invalidRequest({message:A.errors.invalidRequestParams(),data:f(f({},e||{}),{},{cause:A.errors.invalidRequestArgs()})});return new Promise((r,o)=>{this.rpcRequest({method:t,params:n},he(r,o))})}send(e,t){this.rpcRequest(e,t)}sendAsync(e){return new Promise((t,n)=>{this.rpcRequest(e,he(t,n))})}handleStreamDisconnect(e,t){zt(e,t,this),this.handleDisconnect(!1,t?t.message:void 0)}}class Jt extends Z{constructor({url:e,target:t,features:n,timeout:r=3e4}){super(),d(this,"url",void 0),d(this,"target",void 0),d(this,"features",void 0),d(this,"window",void 0),d(this,"windowTimer",void 0),d(this,"iClosedWindow",void 0),d(this,"timeout",void 0),this.url=e,this.target=t||"_blank",this.features=n||V(ze),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this.timeout=r,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),setTimeout(()=>{this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0},this.timeout)),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){var e;this.window=window.open(this.url.href,this.target,this.features),(e=this.window)!==null&&e!==void 0&&e.focus&&this.window.focus()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(e){e?window.location.replace(this.url.href):window.location.href=this.url.href}}class X extends Ye{constructor(e,{maxEventListeners:t=100,jsonRpcStreamName:n="provider"},r){super(e,{maxEventListeners:t,jsonRpcStreamName:n}),d(this,"tryWindowHandle",void 0),d(this,"windowRefs",void 0),d(this,"iframeUrl",void 0),d(this,"authWindowRefs",[]),d(this,"iframeId",void 0),this.state=f(f({},X.defaultState),r),this.iframeUrl="",this.iframeId="",this.windowRefs=new Map,this.on("connect",()=>{this.state.isConnected=!0});const o=s=>{const{method:c,params:a}=s;if(c===M.IFRAME_STATUS){const{isFullScreen:u,rid:g}=a;this.displayIframe({isFull:u,rid:g},!0)}else if(c===M.CLOSE_WINDOW)this.handleCloseWindow(a);else if(c===M.USER_LOGGED_IN){const{currentAuthConnection:u}=a;this.state.isLoggedIn=!0,this.state.currentAuthConnection=u,this.authWindowRefs.length>0&&this.authWindowRefs.forEach(g=>{this.handleCloseWindow({windowId:g})})}else if(c===M.USER_LOGGED_OUT)this.state.isLoggedIn=!1,this.state.currentAuthConnection=null,this.displayIframe({isFull:!1},!0);else if(c===M.TOGGLE_WIDGET_BUTTON){const{show:u}=a;this.state.widgetVisibility=u,this.displayIframe()}else if(c===M.ALLOW_WALLET_SERVICE){const{allow:u}=a;this.state.allowWalletService=u}};this.jsonRpcConnectionEvents.on("notification",o)}get isLoggedIn(){return this.state.isLoggedIn}get isIFrameFullScreen(){return this.state.isIFrameFullScreen}get allowWalletService(){return this.state.allowWalletService}isConnected(){return this.state.isConnected}async initializeState(e){try{const{torusUrl:t,torusIframeId:n}=e;this.iframeUrl=t,this.iframeId=n;const{currentAuthConnection:r,isLoggedIn:o}=await this.request({method:b.GET_PROVIDER_STATE,params:[]});o&&this.handleConnect(r,o)}catch(t){h.error("Web3Auth: Failed to get initial state. Please report this bug.",t)}finally{h.info("initialized communication state"),this.state.initialized=!0}}displayIframe({isFull:e=!1,rid:t=""}={},n=!1){const r={};if(e)r.display="block",r.width="100%",r.height="100%",r.top="0px",r.right="0px",r.left="0px",r.bottom="0px";else switch(r.display=this.state.widgetVisibility?"block":"none",r.height=this.state.widgetVisibility?"70px":"0px",r.width=this.state.widgetVisibility?"70px":"0px",this.state.buttonPosition){case U.TOP_LEFT:r.top="0px",r.left="0px",r.right="auto",r.bottom="auto";break;case U.TOP_RIGHT:r.top="0px",r.right="0px",r.left="auto",r.bottom="auto";break;case U.BOTTOM_RIGHT:r.bottom="0px",r.right="0px",r.top="auto",r.left="auto";break;case U.BOTTOM_LEFT:default:r.bottom="0px",r.left="0px",r.top="auto",r.right="auto";break}const o=document.getElementById(this.iframeId);Object.assign(o.style,r),this.state.isIFrameFullScreen=e,n||this.request({method:b.IFRAME_STATUS,params:{isIFrameFullScreen:e,rid:t}})}async handleWindow(e,{url:t,target:n,features:r,timeout:o,isAuthWindow:s=!1}={}){const c=new URL(t||`${this.iframeUrl}/redirect?windowId=${e}&sessionNamespace=${window.location.hostname}`);s&&c.searchParams.set("isAuthWindow","true");const a=new Jt({url:c,target:n,features:r,timeout:o});if(a.open(),!a.window){this.displayIframe({isFull:!0}),this.request({method:b.WINDOW_BLOCKED,params:{windowId:e,finalUrl:c.href}});return}this.windowRefs.set(e,a),s&&this.authWindowRefs.push(e),a.once("close",()=>{this.windowRefs.delete(e),this.authWindowRefs=this.authWindowRefs.filter(u=>u!==e),this.request({method:b.CLOSED_WINDOW,params:{windowId:e}})})}rpcRequest(e,t){const n=t,r=e;Array.isArray(r)||r.jsonrpc||(r.jsonrpc="2.0"),this.rpcEngine.handle(r,n)}handleConnect(e,t){this.state.isConnected||(this.state.isConnected=!0,this.emit("connect",{currentAuthConnection:e,isLoggedIn:t}),h.debug(A.info.connected(e)))}handleDisconnect(e,t){if(this.state.isConnected||!this.state.isPermanentlyDisconnected&&!e){this.state.isConnected=!1;let n;e?(n=new Y(1013,t||A.errors.disconnected()),h.debug(n)):(n=new Y(1011,t||A.errors.permanentlyDisconnected()),h.error(n),this.state.currentAuthConnection=null,this.state.isLoggedIn=!1,this.state.widgetVisibility=!1,this.state.isIFrameFullScreen=!1,this.state.isPermanentlyDisconnected=!0),this.emit("disconnect",n)}}handleCloseWindow(e){const{windowId:t}=e;this.windowRefs.has(t)&&(this.windowRefs.get(t).close(),this.windowRefs.delete(t),this.authWindowRefs=this.authWindowRefs.filter(n=>n!==t))}}d(X,"defaultState",{buttonPosition:"bottom-left",currentAuthConnection:null,isIFrameFullScreen:!1,widgetVisibility:!1,initialized:!1,isLoggedIn:!1,isPermanentlyDisconnected:!1,isConnected:!1,hasEmittedConnection:!1,allowWalletService:!1});const Qt=i=>{const e=window.document.createElement("template"),t=i.trim();return e.innerHTML=t,e.content.firstChild};var ce,De;function Zt(){return De||(De=1,ce=function i(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,o;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!i(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(o=Object.keys(e),n=o.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,o[r]))return!1;for(r=n;r--!==0;){var s=o[r];if(!i(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}),ce}var Xt=Zt();const ei=J(Xt);class ee extends Ye{constructor(e,{maxEventListeners:t=100,jsonRpcStreamName:n="provider"}){super(e,{maxEventListeners:t,jsonRpcStreamName:n}),d(this,"chainId",void 0),d(this,"selectedAddress",void 0),d(this,"tryWindowHandle",void 0),this.state=f({},ee.defaultState),this.selectedAddress=null,this.chainId=null,this.handleAccountsChanged=this.handleAccountsChanged.bind(this),this.handleChainChanged=this.handleChainChanged.bind(this),this.handleUnlockStateChanged=this.handleUnlockStateChanged.bind(this),this.on("connect",()=>{this.state.isConnected=!0});const r=o=>{const{method:s,params:c}=o;s===ae.ACCOUNTS_CHANGED?this.handleAccountsChanged(c):s===ae.UNLOCK_STATE_CHANGED?this.handleUnlockStateChanged(c):s===ae.CHAIN_CHANGED?this.handleChainChanged(c):Vt.includes(s)&&(this.emit("data",o),this.emit("notification",c.result),this.emit("message",{type:s,data:c}))};this.jsonRpcConnectionEvents.on("notification",r)}isConnected(){return this.state.isConnected}async initializeState(){try{const{accounts:e,chainId:t,isUnlocked:n}=await this.request({method:Ve.GET_PROVIDER_STATE,params:[]});this.emit("connect",{chainId:t}),this.handleChainChanged({chainId:t}),this.handleUnlockStateChanged({accounts:e,isUnlocked:n}),this.handleAccountsChanged(e)}catch(e){h.error("WsEmbed: Failed to get initial state. Please report this bug.",e)}finally{h.info("initialized provider state"),this.state.initialized=!0}}rpcRequest(e,t,n=!1){let r=t;const o=e;if(!Array.isArray(o)){if(o.jsonrpc||(o.jsonrpc="2.0"),[C.GET_ACCOUNTS,C.ETH_REQUEST_ACCOUNTS,L.SOLANA_REQUEST_ACCOUNTS,L.GET_ACCOUNTS].includes(o.method))r=(s,c)=>{this.handleAccountsChanged(c.result||[],o.method==="eth_accounts",n),t(s,c)};else if(o.method==="wallet_getProviderState"){this.rpcEngine.handle(e,r);return}}this.tryWindowHandle(o,r)}handleConnect(e){this.state.isConnected||(this.state.isConnected=!0,this.emit("connect",{chainId:e}),h.debug(A.info.connected(e)))}handleDisconnect(e,t){if(this.state.isConnected||!this.state.isPermanentlyDisconnected&&!e){this.state.isConnected=!1;let n;e?(n=new Y(1013,t||A.errors.disconnected()),h.debug(n)):(n=new Y(1011,t||A.errors.permanentlyDisconnected()),h.error(n),this.chainId=null,this.state.accounts=null,this.selectedAddress=null,this.state.isUnlocked=!1,this.state.isPermanentlyDisconnected=!0),this.emit("disconnect",n)}}handleAccountsChanged(e,t=!1,n=!1){let r=e;Array.isArray(r)||(h.error("WsEmbed: Received non-array accounts parameter. Please report this bug.",r),r=[]);for(const o of e)if(typeof o!="string"){h.error("WsEmbed: Received non-string account. Please report this bug.",e),r=[];break}ei(this.state.accounts,r)||(t&&Array.isArray(this.state.accounts)&&this.state.accounts.length>0&&!n&&h.error('WsEmbed: "eth_accounts" unexpectedly updated accounts. Please report this bug.',r),this.state.accounts=r,this.emit("accountsChanged",r)),this.selectedAddress!==r[0]&&(this.selectedAddress=r[0]||null)}handleChainChanged({chainId:e}={}){if(!e){h.error("WsEmbed: Received invalid network parameters. Please report this bug.",{chainId:e});return}e==="loading"?this.handleDisconnect(!0):(this.handleConnect(e),e!==this.chainId&&(this.chainId=e,this.state.initialized&&this.emit("chainChanged",this.chainId)))}handleUnlockStateChanged({accounts:e,isUnlocked:t}={}){if(typeof t!="boolean"){h.error("WsEmbed: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:t});return}t!==this.state.isUnlocked&&(this.state.isUnlocked=t,this.handleAccountsChanged(e||[]))}}d(ee,"defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});function Me(i){return new Promise((e,t)=>{try{const n=document.createElement("img");n.onload=()=>e(!0),n.onerror=()=>e(!1),n.src=i}catch(n){t(n)}})}const ti=i=>{const{document:e}=i,t=e.querySelector('head > meta[property="og:site_name"]');if(t)return t.content;const n=e.querySelector('head > meta[name="title"]');return n?n.content:e.title&&e.title.length>0?e.title:i.location.hostname};async function ii(i){try{const{document:e}=i;let t=e.querySelector('head > link[rel="shortcut icon"]');return t&&await Me(t.href)||(t=Array.from(e.querySelectorAll('head > link[rel="icon"]')).find(n=>!!n.href),t&&await Me(t.href))?t.href:""}catch{return""}}const ni=async()=>({name:ti(window),icon:await ii(window)}),Ue=(i,e)=>e?`${e}_${i}`:i,ri=(i,e)=>{const t=new Set(rt),n=new Map;return i.forEach(r=>{const o=r;n.set(Ue(r.authConnectionId,r.groupedAuthConnectionId),o)}),Object.entries(e).forEach(([r,o])=>{if(!t.has(r))throw new Error(`Invalid auth connection: ${r}.`);const s=Ue(o.authConnectionId,o.groupedAuthConnectionId),c=n.get(s);if(!c)throw new Error(`Invalid auth connection config, authConnection: ${o.authConnection}. Missing AuthConnectionConfig from the dashboard.`);e[r]=f(f({},c),o)}),e},si="5.6.0",xe=`v${si.split(".")[0]}`,fe={[H.TESTING]:{url:"https://develop-wallet.web3auth.io",logLevel:"debug"},[H.DEVELOPMENT]:{url:"http://localhost:4050",logLevel:"debug"},[H.STAGING]:{url:`https://staging-wallet.web3auth.io/${xe}`,logLevel:"debug"},[H.PRODUCTION]:{url:`https://wallet.web3auth.io/${xe}`,logLevel:"error"}};(async function(){try{if(typeof document>"u")return;const e=document.createElement("link"),{url:t}=fe.production;e.href=`${t}/frame`,e.crossOrigin="anonymous",e.type="text/html",e.rel="prefetch",e.relList&&e.relList.supports&&e.relList.supports("prefetch")&&document.head.appendChild(e)}catch(e){h.warn(e)}})();const oi=new Set([L.SEND_TRANSACTION,L.SIGN_MESSAGE,L.SIGN_TRANSACTION,L.SIGN_ALL_TRANSACTIONS,C.ETH_SIGN,C.ETH_SIGN_TYPED_DATA_V4,C.PERSONAL_SIGN,C.ETH_TRANSACTION,C.ADD_CHAIN,C.SWITCH_CHAIN,Ve.WALLET_SWITCH_CHAIN]);class ci{constructor({modalZIndex:e=99999,web3AuthClientId:t,web3AuthNetwork:n}){d(this,"isInitialized",void 0),d(this,"modalZIndex",void 0),d(this,"provider",void 0),d(this,"communicationProvider",void 0),d(this,"buttonPosition",void 0),d(this,"web3AuthClientId",void 0),d(this,"web3AuthNetwork",void 0),d(this,"loginMode",q.EMBED),d(this,"enableLegacyConfig",!1),d(this,"confirmationStrategy",void 0),d(this,"buildEnv",void 0),d(this,"embedNonce",B()),this.isInitialized=!1,this.modalZIndex=e,this.web3AuthClientId=t,this.web3AuthNetwork=n}get isLoggedIn(){var e;return((e=this.communicationProvider)===null||e===void 0?void 0:e.isLoggedIn)||!1}get getBuildEnv(){return this.buildEnv}async init({buildEnv:e=H.PRODUCTION,enableLogging:t=!1,chains:n,chainId:r,walletUrls:o,whiteLabel:s,confirmationStrategy:c=D.DEFAULT,loginMethodConfig:a={},accountAbstractionConfig:u,enableKeyExport:g=!1,loginMode:E=q.EMBED,enableLegacyConfig:l=!1}){if(this.isInitialized)throw new Error("Already initialized");this.enableLegacyConfig=l,this.loginMode=E,this.buildEnv=e,this.confirmationStrategy=c;const{url:v,logLevel:m}=o&&o[e]?f(f({},fe[e]),o[e]):fe[e];h.info(v,"url loaded"),h.setDefaultLevel(m),t?h.enableAll():h.disableAll();let w,y=s;if(this.loginMode===q.EMBED){const O=await this.getProjectConfig();w=(O.embeddedWalletAuth||[]).filter(te=>!te.isDefault),a=await this.initializeAuthConnectionConfig(O,a),y=this.initializeWhiteLabel(O,s)}const _=new URL(v);_.pathname.endsWith("/")?_.pathname+="frame":_.pathname+="/frame";const S=new URLSearchParams;S.append("origin",window.location.origin),S.append("nonce",this.embedNonce),_.hash=S.toString();const P=this.getTheme((s==null?void 0:s.mode)||se.light),R=Qt(`<iframe
        id="walletIframe-${this.embedNonce}"
        class="walletIframe-${this.embedNonce}"
        sandbox="allow-popups allow-scripts allow-same-origin allow-forms allow-modals allow-downloads"
        src="${_.href}"
        style="display: none; position: fixed; top: 0; right: 0; width: 100%;
        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex.toString()};
        color-scheme: ${P}"
        allow="clipboard-write"
      ></iframe>`);this.buttonPosition=(s==null?void 0:s.buttonPosition)||U.BOTTOM_LEFT;const x=await ni();return new Promise((O,te)=>{try{window.document.body.appendChild(R);const k=async we=>{if(we.origin!==_.origin)return;const{message:Je,nonce:Qe}=we.data||{};Je===Ft&&Qe===this.embedNonce&&(window.removeEventListener("message",k),R.contentWindow.postMessage({chains:n,chainId:r,dappMetadata:x,enableLogging:t,web3AuthClientId:this.web3AuthClientId,web3AuthNetwork:this.web3AuthNetwork,authConnectionConfig:w,loginMethodConfig:a,whiteLabel:y,confirmationStrategy:c,accountAbstractionConfig:u,enableKeyExport:g,enableLegacyConfig:l},_.origin),await this.setupWeb3({torusUrl:v,walletIframe:R}),this.isInitialized=!0,O())};window.addEventListener("message",k)}catch(k){te(k)}})}async login(e={}){if(!this.isInitialized)throw new Error("Call init() first");const t=this.communicationProvider.isIFrameFullScreen;try{let n;e.authConnection?(n=B(),await this.communicationProvider.handleWindow(n,{target:"_blank",features:V(ze),isAuthWindow:!0,timeout:3e4})):t||this.communicationProvider.displayIframe({isFull:!0});const r=await new Promise((o,s)=>{const a=Object.values(it).includes(this.provider.chainId)?L.SOLANA_REQUEST_ACCOUNTS:C.ETH_REQUEST_ACCOUNTS;this.provider.rpcRequest({method:a,params:[e.authConnection,e.login_hint,e.authConnectionId,e.groupedAuthConnectionId,n]},he(o,s))});if(h.info("check: res",r),Array.isArray(r)&&r.length>0)return this.confirmationStrategy===D.AUTO_APPROVE&&h.warn("Confirmation strategy auto approve is not allowed on Embed Mode, using Default instead."),r;throw new Error("Login failed")}catch(n){throw h.error("login failed",n),n}finally{t||this.communicationProvider.displayIframe({isFull:!1})}}async loginWithSessionId(e){if(!this.isInitialized)throw new Error("Call init() first");if(!e.sessionId)throw new Error("sessionId is required");try{const t=await this.communicationProvider.request({method:b.LOGIN_WITH_SESSION_ID,params:[e.sessionId,e.sessionNamespace||""]});if(h.info("check: res",t),t.success)return this.confirmationStrategy===D.POPUP&&h.warn("Confirmation strategy popup is not allowed on Plugin Mode, using Default instead."),t.success;throw new Error("Login failed")}catch(t){throw h.error("login with session id failed",t),t}}async logout(){if(!this.communicationProvider.isLoggedIn)throw new Error("Not logged in");await this.communicationProvider.request({method:b.LOGOUT,params:[]})}async cleanUp(){var e;(e=this.communicationProvider)!==null&&e!==void 0&&e.isLoggedIn&&await this.logout(),this.clearInit()}clearInit(){function e(n){return n instanceof Element||n instanceof Document}const t=window.document.getElementById(`walletIframe-${this.embedNonce}`);e(t)&&t.remove(),this.isInitialized=!1}async getUserInfo(){return await this.communicationProvider.request({method:b.USER_INFO,params:[]})}async showWalletConnectScanner(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:b.SHOW_WALLET_CONNECT,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showWalletUi(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:b.SHOW_WALLET_UI,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showFunding(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:b.SHOW_FUNDING,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showCheckout(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:b.SHOW_CHECKOUT,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showReceive(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:b.SHOW_RECEIVE,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showSwap(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:b.SHOW_SWAP,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}getConfirmationStrategyFinal(e){let t=this.confirmationStrategy;return!Array.isArray(e)&&oi.has(e.method)&&this.confirmationStrategy!==D.MODAL&&this.loginMode!==q.PLUGIN&&(t=D.POPUP),t}getTheme(e){return e===se.light?"light":e===se.dark||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}async setupWeb3(e){h.info("setupWeb3 running");const t=new Ie({name:"embed_torus",target:"iframe_torus",targetWindow:e.walletIframe.contentWindow,targetOrigin:new URL(e.torusUrl).origin}),n=new Ie({name:"embed_communication",target:"iframe_communication",targetWindow:e.walletIframe.contentWindow,targetOrigin:new URL(e.torusUrl).origin}),r=new ee(t,{}),o=new X(n,{},{buttonPosition:this.buttonPosition});r.tryWindowHandle=(u,g)=>{const E=u,l=this.getConfirmationStrategyFinal(u),{allowWalletService:v}=o;if(l===D.POPUP&&v){const m=B();o.handleWindow(m,{target:"_blank",features:V(Ht),timeout:500}),E.windowId=m}r.rpcEngine.handle(E,g)},o.tryWindowHandle=(u,g)=>{const E=u,l=this.getConfirmationStrategyFinal(u),{allowWalletService:v}=o;if(l===D.POPUP&&v){const m=B();o.handleWindow(m,{target:"_blank",features:V(jt),timeout:500}),E.params.windowId=m}o.rpcEngine.handle(E,g)};const s=u=>{const g=r[u],E=this;r[u]=function(v,m){const{method:w,params:y=[]}=v;if(w===C.ETH_REQUEST_ACCOUNTS||w===L.SOLANA_REQUEST_ACCOUNTS){if(!m)return E.login({authConnection:y[0]});E.login({authConnection:y[0]}).then(_=>m(null,_)).catch(_=>m(_))}return g.apply(this,[v,m])}};s("request"),s("sendAsync"),s("send");const c=new Proxy(r,{deleteProperty:()=>!0}),a=new Proxy(o,{deleteProperty:()=>!0});this.provider=c,this.communicationProvider=a,h.info("test setupWeb3 "),await Promise.all([r.initializeState(),o.initializeState(f(f({},e),{},{torusIframeId:e.walletIframe.id}))]),h.debug("WsEmbed - injected provider")}async getProjectConfig(){let e;try{e=await Yt({clientId:this.web3AuthClientId,web3AuthNetwork:this.web3AuthNetwork,authBuildEnv:this.buildEnv})}catch(t){const n=await nt(t);throw h.error("Failed to fetch project configurations",n),new Error("failed to fetch project configurations")}return h.debug("projectConfig",e),e}async initializeAuthConnectionConfig(e,t){return t&&Object.keys(t).length>0&&(t=ri(e.embeddedWalletAuth||[],t)),t}initializeWhiteLabel(e,t={}){const{walletUi:n,whitelabel:r}=e,{enablePortfolioWidget:o=!1,enableTokenDisplay:s=!0,enableNftDisplay:c=!0,enableWalletConnect:a=!0,enableBuyButton:u=!0,enableSendButton:g=!0,enableSwapButton:E=!0,enableReceiveButton:l=!0,enableShowAllTokensButton:v=!0,enableDefiPositionsDisplay:m=!0,portfolioWidgetPosition:w=U.BOTTOM_LEFT,defaultPortfolio:y="token"}=n||{},_=f(f({},r),{},{showWidgetButton:o,hideNftDisplay:!c,hideTokenDisplay:!s,hideTransfers:!g,hideTopup:!u,hideReceive:!l,hideSwap:!E,hideShowAllTokens:!v,hideWalletConnect:!a,hideDefiPositionsDisplay:!m,buttonPosition:w,defaultPortfolio:y});return je.all([_,t])}}export{rt as AUTH_PROVIDERS,U as BUTTON_POSITION,D as CONFIRMATION_STRATEGY,C as EVM_METHOD_TYPES,it as SOLANA_CHAIN_IDS,L as SOLANA_METHOD_TYPES,ee as TorusInPageProvider,H as WS_EMBED_BUILD_ENV,q as WS_EMBED_LOGIN_MODE,ci as default,ui as restrictedLoginMethods};
