var Lp=Object.defineProperty;var jp=(t,e,r)=>e in t?Lp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Z=(t,e,r)=>jp(t,typeof e!="symbol"?e+"":e,r);import{q as rt,b1 as ko,b2 as qp,b3 as zp,as as mh,aw as Vt,ak as ie,b4 as Y,ar as St,b5 as Vp,aX as Kp,aY as Hp,aW as Wp,aq as un,b6 as bh,b7 as Xr,ap as oe,W as Pt,S as Gi,b0 as Re,az as mn,c as Na,a as ct,w as vh,x as Gp,B as Yp,_ as lt,J as _c,p as xc,u as Ze,aL as Zp,b8 as pr,o as Jp,r as Xp,s as Me,aM as Ht,at as Qp,t as gt,b9 as eg,ba as xi,bb as tg,v as rg,aN as ng,aO as ig,aP as sg,aQ as og,aR as ag}from"./index-LQJmjVny.js";import{h as cg,s as lg}from"./hmac-ByT5zJZT.js";import{b as ug,c as hg,d as fg}from"./solanaRpcMiddlewares-BV7DPW73.js";/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Eh(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function _h(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Yi(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function li(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function Zi(t){if(!Array.isArray(t))throw new Error("array expected")}function Ji(t,e){if(!_h(!0,e))throw new Error(`${t}: array of strings expected`)}function xh(t,e){if(!_h(!1,e))throw new Error(`${t}: array of numbers expected`)}function Sh(...t){const e=s=>s,r=(s,o)=>a=>s(o(a)),n=t.map(s=>s.encode).reduceRight(r,e),i=t.map(s=>s.decode).reduce(r,e);return{encode:n,decode:i}}function Ih(t){const e=typeof t=="string"?t.split(""):t,r=e.length;Ji("alphabet",e);const n=new Map(e.map((i,s)=>[i,s]));return{encode:i=>(Zi(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:i=>(Zi(i),i.map(s=>{Yi("alphabet.decode",s);const o=n.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function Dh(t=""){return Yi("join",t),{encode:e=>(Ji("join.decode",e),e.join(t)),decode:e=>(Yi("join.decode",e),e.split(t))}}function dg(t,e="="){return li(t),Yi("padding",e),{encode(r){for(Ji("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){Ji("padding.decode",r);let n=r.length;if(n*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if((n-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}function Sc(t,e,r){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(Zi(t),!t.length)return[];let n=0;const i=[],s=Array.from(t,a=>{if(li(a),a<0||a>=e)throw new Error(`invalid integer: ${a}`);return a}),o=s.length;for(;;){let a=0,c=!0;for(let l=n;l<o;l++){const u=s[l],h=e*a,f=h+u;if(!Number.isSafeInteger(f)||h/e!==a||f-u!==h)throw new Error("convertRadix: carry overflow");const p=f/r;a=f%r;const d=Math.floor(p);if(s[l]=d,!Number.isSafeInteger(d)||d*r+a!==f)throw new Error("convertRadix: carry overflow");if(c)d?c=!1:n=l;else continue}if(i.push(a),c)break}for(let a=0;a<t.length-1&&t[a]===0;a++)i.push(0);return i.reverse()}const Oh=(t,e)=>e===0?t:Oh(e,t%e),Xi=(t,e)=>t+(e-Oh(t,e)),ks=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function Ic(t,e,r,n){if(Zi(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Xi(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${Xi(e,r)}`);let i=0,s=0;const o=ks[e],a=ks[r]-1,c=[];for(const l of t){if(li(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=r;s-=r)c.push((i>>s-r&a)>>>0);const u=ks[s];if(u===void 0)throw new Error("invalid carry");i&=u-1}if(i=i<<r-s&a,!n&&s>=e)throw new Error("Excess padding");if(!n&&i>0)throw new Error(`Non-zero padding: ${i}`);return n&&s>0&&c.push(i>>>0),c}function pg(t){li(t);const e=2**8;return{encode:r=>{if(!Eh(r))throw new Error("radix.encode input should be Uint8Array");return Sc(Array.from(r),e,t)},decode:r=>(xh("radix.decode",r),Uint8Array.from(Sc(r,t,e)))}}function gg(t,e=!1){if(li(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Xi(8,t)>32||Xi(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!Eh(r))throw new Error("radix2.encode input should be Uint8Array");return Ic(Array.from(r),8,t,!e)},decode:r=>(xh("radix2.decode",r),Uint8Array.from(Ic(r,t,8,e)))}}const yg=Sh(gg(5),Ih("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),dg(5),Dh("")),wg=t=>Sh(pg(58),Ih(t),Dh("")),ui=wg("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");let mg=(function(t){return t.ETH_SEND_TRANSACTION="eth_sendTransaction",t.ETH_SIGN_TRANSACTION="eth_signTransaction",t.ETH_SIGN="eth_sign",t.PERSONAL_SIGN="personal_sign",t.ETH_SIGN_TYPED_DATA="eth_signTypedData",t.ETH_SIGN_TYPED_DATA_V3="eth_signTypedData_v3",t.ETH_SIGN_TYPED_DATA_V4="eth_signTypedData_v4",t.ADD_ETHEREUM_CHAIN="wallet_addEthereumChain",t.SWITCH_ETHEREUM_CHAIN="wallet_switchEthereumChain",t})({}),bg=(function(t){return t.SIGN_TRANSACTION="solana_signTransaction",t.SIGN_MESSAGE="solana_signMessage",t})({}),vg=(function(t){return t.ETH_CHAIN_CHANGED="chainChanged",t.ETH_ACCOUNTS_CHANGED="accountsChanged",t})({}),Eg=(function(t){return t.SOL_CHAIN_CHANGED="chainChanged",t.SOL_ACCOUNTS_CHANGED="accountsChanged",t})({});const _g=async()=>({name:zp(window),icon:await qp(window)}),xg=t=>{const e=[];return t.forEach(r=>{const[n]=r.split(":");e.includes(n)||e.push(n)}),e},Sg=t=>{switch(t){case rt.EIP155:return Object.values(mg);case rt.SOLANA:return Object.values(bg);default:throw new Error(`No default methods for namespace: ${t}`)}},Ig=t=>{switch(t){case rt.EIP155:return Object.values(vg);case rt.SOLANA:return Object.values(Eg);default:throw new Error(`No default events for namespace: ${t}`)}},Dg=t=>{const e=xg(t);return Object.fromEntries(e.map(r=>[r,{methods:Sg(r),chains:t.filter(n=>n.startsWith(r)),events:Ig(r)}]))},Og=async(t,e)=>{const r=await _g(),n={walletConnectInitOptions:{projectId:e,relayUrl:"wss://relay.walletconnect.com",metadata:{name:r.name,description:r.name,url:window.location.origin,icons:[r.icon||""]}}},i=t.map(o=>{if(o.chainNamespace===rt.SOLANA)return`${o.chainNamespace}:${ko[o.chainId]}`;if(o.chainNamespace===rt.EIP155)return`${o.chainNamespace}:${parseInt(o.chainId,16)}`;throw new Error(`Unsupported chain namespace: ${o.chainNamespace}`)}),s={optionalNamespaces:Dg(i)};return{connectorSettings:n,loginSettings:s}};var Ms={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Mo=function(t,e){return Mo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},Mo(t,e)};function Ag(t,e){Mo(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Fo=function(){return Fo=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Fo.apply(this,arguments)};function $g(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function Tg(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function Pg(t,e){return function(r,n){e(r,n,t)}}function Cg(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Ng(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})}function Rg(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],i=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Bg(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function Ug(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Lo(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ah(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function kg(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Ah(arguments[e]));return t}function Mg(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function ei(t){return this instanceof ei?(this.v=t,this):new ei(t)}function Fg(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){n[f]&&(i[f]=function(p){return new Promise(function(d,g){s.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(n[f](p))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof ei?Promise.resolve(f.value.v).then(l,u):h(s[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Lg(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:ei(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function jg(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Lo=="function"?Lo(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function qg(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function zg(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Vg(t){return t&&t.__esModule?t:{default:t}}function Kg(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Hg(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const Wg=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Fo},__asyncDelegator:Lg,__asyncGenerator:Fg,__asyncValues:jg,__await:ei,__awaiter:Ng,__classPrivateFieldGet:Kg,__classPrivateFieldSet:Hg,__createBinding:Bg,__decorate:Tg,__exportStar:Ug,__extends:Ag,__generator:Rg,__importDefault:Vg,__importStar:zg,__makeTemplateObject:qg,__metadata:Cg,__param:Pg,__read:Ah,__rest:$g,__spread:kg,__spreadArrays:Mg,__values:Lo},Symbol.toStringTag,{value:"Module"})),ys=mh(Wg);var Fs={},Cn={},Dc;function Gg(){if(Dc)return Cn;Dc=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Cn.delay=t,Cn}var Fr={},Ls={},Lr={},Oc;function Yg(){return Oc||(Oc=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.ONE_THOUSAND=Lr.ONE_HUNDRED=void 0,Lr.ONE_HUNDRED=100,Lr.ONE_THOUSAND=1e3),Lr}var js={},Ac;function Zg(){return Ac||(Ac=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365})(js)),js}var $c;function $h(){return $c||($c=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ys;e.__exportStar(Yg(),t),e.__exportStar(Zg(),t)})(Ls)),Ls}var Tc;function Jg(){if(Tc)return Fr;Tc=1,Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.fromMiliseconds=Fr.toMiliseconds=void 0;const t=$h();function e(n){return n*t.ONE_THOUSAND}Fr.toMiliseconds=e;function r(n){return Math.floor(n/t.ONE_THOUSAND)}return Fr.fromMiliseconds=r,Fr}var Pc;function Xg(){return Pc||(Pc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ys;e.__exportStar(Gg(),t),e.__exportStar(Jg(),t)})(Fs)),Fs}var hn={},Cc;function Qg(){if(Cc)return hn;Cc=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const n=this.get(r);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const i=Date.now()-n.started;this.timestamps.set(r,{started:n.started,elapsed:i})}get(r){const n=this.timestamps.get(r);if(typeof n>"u")throw new Error(`No timestamp found for label: ${r}`);return n}elapsed(r){const n=this.get(r);return n.elapsed||Date.now()-n.started}}return hn.Watch=t,hn.default=t,hn}var qs={},Nn={},Nc;function ey(){if(Nc)return Nn;Nc=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.IWatch=void 0;class t{}return Nn.IWatch=t,Nn}var Rc;function ty(){return Rc||(Rc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),ys.__exportStar(ey(),t)})(qs)),qs}var Bc;function ry(){return Bc||(Bc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ys;e.__exportStar(Xg(),t),e.__exportStar(Qg(),t),e.__exportStar(ty(),t),e.__exportStar($h(),t)})(Ms)),Ms}var L=ry();class sn{}let ny=class extends sn{constructor(e){super()}};const Uc=L.FIVE_SECONDS,on={pulse:"heartbeat_pulse"};let iy=class Th extends ny{constructor(e){super(e),this.events=new Vt.EventEmitter,this.interval=Uc,this.interval=(e==null?void 0:e.interval)||Uc}static async init(e){const r=new Th(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),L.toMiliseconds(this.interval))}pulse(){this.events.emit(on.pulse)}};const sy=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,oy=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,ay=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function cy(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){ly(t);return}return e}function ly(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Si(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!ay.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(sy.test(t)||oy.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,cy)}return JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}function uy(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function De(t,...e){try{return uy(t(...e))}catch(r){return Promise.reject(r)}}function hy(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function fy(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Li(t){if(hy(t))return String(t);if(fy(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Li(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const jo="base64:";function dy(t){return typeof t=="string"?t:jo+yy(t)}function py(t){return typeof t!="string"||!t.startsWith(jo)?t:gy(t.slice(jo.length))}function gy(t){return globalThis.Buffer?ie.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function yy(t){return globalThis.Buffer?ie.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Je(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function wy(...t){return Je(t.join(":"))}function Ii(t){return t=Je(t),t?t+":":""}function my(t,e){if(e===void 0)return!0;let r=0,n=t.indexOf(":");for(;n>-1;)r++,n=t.indexOf(":",n+1);return r<=e}function by(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const vy="memory",Ey=()=>{const t=new Map;return{name:vy,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function _y(t={}){const e={mounts:{"":t.driver||Ey()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},n=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),i=(l,u)=>{if(e.watching){u=Je(u);for(const h of e.watchListeners)h(l,u)}},s=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await kc(e.mounts[l],i,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const f=new Map,p=d=>{let g=f.get(d.base);return g||(g={driver:d.driver,base:d.base,items:[]},f.set(d.base,g)),g};for(const d of l){const g=typeof d=="string",w=Je(g?d:d.key),m=g?void 0:d.value,_=g||!d.options?u:{...u,...d.options},y=r(w);p(y).items.push({key:w,value:m,relativeKey:y.relativeKey,options:_})}return Promise.all([...f.values()].map(d=>h(d))).then(d=>d.flat())},c={hasItem(l,u={}){l=Je(l);const{relativeKey:h,driver:f}=r(l);return De(f.hasItem,h,u)},getItem(l,u={}){l=Je(l);const{relativeKey:h,driver:f}=r(l);return De(f.getItem,h,u).then(p=>Si(p))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?De(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),u).then(f=>f.map(p=>({key:wy(h.base,p.key),value:Si(p.value)}))):Promise.all(h.items.map(f=>De(h.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:Si(p)})))))},getItemRaw(l,u={}){l=Je(l);const{relativeKey:h,driver:f}=r(l);return f.getItemRaw?De(f.getItemRaw,h,u):De(f.getItem,h,u).then(p=>py(p))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=Je(l);const{relativeKey:f,driver:p}=r(l);p.setItem&&(await De(p.setItem,f,Li(u),h),p.watch||i("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return De(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:Li(f.value),options:f.options})),u);h.driver.setItem&&await Promise.all(h.items.map(f=>De(h.driver.setItem,f.relativeKey,Li(f.value),f.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=Je(l);const{relativeKey:f,driver:p}=r(l);if(p.setItemRaw)await De(p.setItemRaw,f,u,h);else if(p.setItem)await De(p.setItem,f,dy(u),h);else return;p.watch||i("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=Je(l);const{relativeKey:h,driver:f}=r(l);f.removeItem&&(await De(f.removeItem,h,u),(u.removeMeta||u.removeMata)&&await De(f.removeItem,h+"$",u),f.watch||i("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=Je(l);const{relativeKey:h,driver:f}=r(l),p=Object.create(null);if(f.getMeta&&Object.assign(p,await De(f.getMeta,h,u)),!u.nativeOnly){const d=await De(f.getItem,h+"$",u).then(g=>Si(g));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(p,d))}return p},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){var w;l=Ii(l);const h=n(l,!0);let f=[];const p=[];let d=!0;for(const m of h){(w=m.driver.flags)!=null&&w.maxDepth||(d=!1);const _=await De(m.driver.getKeys,m.relativeBase,u);for(const y of _){const E=m.mountpoint+Je(y);f.some(I=>E.startsWith(I))||p.push(E)}f=[m.mountpoint,...f.filter(y=>!y.startsWith(m.mountpoint))]}const g=u.maxDepth!==void 0&&!d;return p.filter(m=>(!g||my(m,u.maxDepth))&&by(m,l))},async clear(l,u={}){l=Ii(l),await Promise.all(n(l,!1).map(async h=>{if(h.driver.clear)return De(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(f.map(p=>h.driver.removeItem(p,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>Mc(l)))},async watch(l){return await s(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=Ii(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(kc(u,i,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){var h,f;l=Ii(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&((f=(h=e.unwatch)[l])==null||f.call(h),delete e.unwatch[l]),u&&await Mc(e.mounts[l]),e.mountpoints=e.mountpoints.filter(p=>p!==l),delete e.mounts[l])},getMount(l=""){l=Je(l)+":";const u=r(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=Je(l),n(l,u.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function kc(t,e,r){return t.watch?t.watch((n,i)=>e(n,r+i)):()=>{}}async function Mc(t){typeof t.dispose=="function"&&await De(t.dispose)}function an(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function Ph(t,e){let r;const n=()=>{if(r)return r;const i=indexedDB.open(t);return i.onupgradeneeded=()=>i.result.createObjectStore(e),r=an(i),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(i,s)=>n().then(o=>s(o.transaction(e,i).objectStore(e)))}let zs;function hi(){return zs||(zs=Ph("keyval-store","keyval")),zs}function Fc(t,e=hi()){return e("readonly",r=>an(r.get(t)))}function xy(t,e,r=hi()){return r("readwrite",n=>(n.put(e,t),an(n.transaction)))}function Sy(t,e=hi()){return e("readwrite",r=>(r.delete(t),an(r.transaction)))}function Iy(t=hi()){return t("readwrite",e=>(e.clear(),an(e.transaction)))}function Dy(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},an(t.transaction)}function Oy(t=hi()){return t("readonly",e=>{if(e.getAllKeys)return an(e.getAllKeys());const r=[];return Dy(e,n=>r.push(n.key)).then(()=>r)})}const Ay=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),$y=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(n,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function Dn(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return $y(t)}catch{return t}}function fi(t){return typeof t=="string"?t:Ay(t)||""}const Ty="idb-keyval";var Py=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=i=>e+i;let n;return t.dbName&&t.storeName&&(n=Ph(t.dbName,t.storeName)),{name:Ty,options:t,async hasItem(i){return!(typeof await Fc(r(i),n)>"u")},async getItem(i){return await Fc(r(i),n)??null},setItem(i,s){return xy(r(i),s,n)},removeItem(i){return Sy(r(i),n)},getKeys(){return Oy(n)},clear(){return Iy(n)}}};const Cy="WALLET_CONNECT_V2_INDEXED_DB",Ny="keyvaluestorage";let Ry=class{constructor(){this.indexedDb=_y({driver:Py({dbName:Cy,storeName:Ny})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,fi(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Y<"u"?Y:typeof self<"u"?self:{},ji={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,n){this[r]=String(n)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Vs<"u"&&Vs.localStorage?ji.exports=Vs.localStorage:typeof window<"u"&&window.localStorage?ji.exports=window.localStorage:ji.exports=new e})();function By(t){var e;return[t[0],Dn((e=t[1])!=null?e:"")]}let Uy=class{constructor(){this.localStorage=ji.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(By)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return Dn(r)}async setItem(e,r){this.localStorage.setItem(e,fi(r))}async removeItem(e){this.localStorage.removeItem(e)}};const ky="wc_storage_version",Lc=1,My=async(t,e,r)=>{const n=ky,i=await e.getItem(n);if(i&&i>=Lc){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(n,Lc),r(e),Fy(t,o)},Fy=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let Ly=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new Uy;this.storage=e;try{const r=new Ry;My(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var jt={exports:{}};function jy(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var qy=zy;function zy(t,e,r){var n=r&&r.stringify||jy,i=1;if(typeof t=="object"&&t!==null){var s=e.length+i;if(s===1)return t;var o=new Array(s);o[0]=n(t);for(var a=1;a<s;a++)o[a]=n(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var l="",u=1-i,h=-1,f=t&&t.length||0,p=0;p<f;){if(t.charCodeAt(p)===37&&p+1<f){switch(h=h>-1?h:0,t.charCodeAt(p+1)){case 100:case 102:if(u>=c||e[u]==null)break;h<p&&(l+=t.slice(h,p)),l+=Number(e[u]),h=p+2,p++;break;case 105:if(u>=c||e[u]==null)break;h<p&&(l+=t.slice(h,p)),l+=Math.floor(Number(e[u])),h=p+2,p++;break;case 79:case 111:case 106:if(u>=c||e[u]===void 0)break;h<p&&(l+=t.slice(h,p));var d=typeof e[u];if(d==="string"){l+="'"+e[u]+"'",h=p+2,p++;break}if(d==="function"){l+=e[u].name||"<anonymous>",h=p+2,p++;break}l+=n(e[u]),h=p+2,p++;break;case 115:if(u>=c)break;h<p&&(l+=t.slice(h,p)),l+=String(e[u]),h=p+2,p++;break;case 37:h<p&&(l+=t.slice(h,p)),l+="%",h=p+2,p++,u--;break}++u}++p}return h===-1?t:(h<f&&(l+=t.slice(h)),l)}const jc=qy;jt.exports=lr;const ti=iw().console||{},Vy={mapHttpRequest:Di,mapHttpResponse:Di,wrapRequestSerializer:Ks,wrapResponseSerializer:Ks,wrapErrorSerializer:Ks,req:Di,res:Di,err:zc,errWithCause:zc};function Tr(t,e){return t==="silent"?1/0:e.levels.values[t]}const Ra=Symbol("pino.logFuncs"),qo=Symbol("pino.hierarchy"),Ky={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function qc(t,e){const r={logger:e,parent:t[qo]};e[qo]=r}function Hy(t,e,r){const n={};e.forEach(i=>{n[i]=r[i]?r[i]:ti[i]||ti[Ky[i]||"log"]||En}),t[Ra]=n}function Wy(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function lr(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||ti;t.browser.write&&(t.browser.asObject=!0);const n=t.serializers||{},i=Wy(t.browser.serialize,n);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof r=="function"&&a.forEach(function(g){r[g]=r}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const c=t.level||"info",l=Object.create(r);l.log||(l.log=En),Hy(l,a,r),qc({},l),Object.defineProperty(l,"levelVal",{get:h}),Object.defineProperty(l,"level",{get:f,set:p});const u={transmit:e,serialize:i,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:tw(t),messageKey:t.messageKey||"msg",onChild:t.onChild||En};l.levels=Gy(t),l.level=c,l.isLevelEnabled=function(g){return this.levels.values[g]?this.levels.values[g]>=this.levels.values[this.level]:!1},l.setMaxListeners=l.getMaxListeners=l.emit=l.addListener=l.on=l.prependListener=l.once=l.prependOnceListener=l.removeListener=l.removeAllListeners=l.listeners=l.listenerCount=l.eventNames=l.write=l.flush=En,l.serializers=n,l._serialize=i,l._stdErrSerialize=s,l.child=function(...g){return d.call(this,u,...g)},e&&(l._logEvent=zo());function h(){return Tr(this.level,this)}function f(){return this._level}function p(g){if(g!=="silent"&&!this.levels.values[g])throw Error("unknown level "+g);this._level=g,jr(this,u,l,"error"),jr(this,u,l,"fatal"),jr(this,u,l,"warn"),jr(this,u,l,"info"),jr(this,u,l,"debug"),jr(this,u,l,"trace"),o.forEach(w=>{jr(this,u,l,w)})}function d(g,w,m){if(!w)throw new Error("missing bindings for child Pino");m=m||{},i&&w.serializers&&(m.serializers=w.serializers);const _=m.serializers;if(i&&_){var y=Object.assign({},n,_),E=t.browser.serialize===!0?Object.keys(y):i;delete w.serializers,Ba([w],E,y,this._stdErrSerialize)}function I(N){this._childLevel=(N._childLevel|0)+1,this.bindings=w,y&&(this.serializers=y,this._serialize=E),e&&(this._logEvent=zo([].concat(N._logEvent.bindings,w)))}I.prototype=this;const O=new I(this);return qc(this,O),O.child=function(...N){return d.call(this,g,...N)},O.level=m.level||this.level,g.onChild(O),O}return l}function Gy(t){const e=t.customLevels||{},r=Object.assign({},lr.levels.values,e),n=Object.assign({},lr.levels.labels,Yy(e));return{values:r,labels:n}}function Yy(t){const e={};return Object.keys(t).forEach(function(r){e[t[r]]=r}),e}lr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},lr.stdSerializers=Vy,lr.stdTimeFunctions=Object.assign({},{nullTime:Ch,epochTime:Nh,unixTime:rw,isoTime:nw});function Zy(t){const e=[];t.bindings&&e.push(t.bindings);let r=t[qo];for(;r.parent;)r=r.parent,r.logger.bindings&&e.push(r.logger.bindings);return e.reverse()}function jr(t,e,r,n){if(Object.defineProperty(t,n,{value:Tr(t.level,r)>Tr(n,r)?En:r[Ra][n],writable:!0,enumerable:!0,configurable:!0}),t[n]===En){if(!e.transmit)return;const s=e.transmit.level||t.level,o=Tr(s,r);if(Tr(n,r)<o)return}t[n]=Xy(t,e,r,n);const i=Zy(t);i.length!==0&&(t[n]=Jy(i,t[n]))}function Jy(t,e){return function(){return e.apply(this,[...t,...arguments])}}function Xy(t,e,r,n){return(function(i){return function(){const s=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===ti?ti:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];var l=!1;if(e.serialize&&(Ba(o,this._serialize,this.serializers,this._stdErrSerialize),l=!0),e.asObject||e.formatters?i.call(a,...Qy(this,n,o,s,e)):i.apply(a,o),e.transmit){const u=e.transmit.level||t._level,h=Tr(u,r),f=Tr(n,r);if(f<h)return;ew(this,{ts:s,methodLevel:n,methodValue:f,transmitValue:r.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:Tr(t._level,r)},o,l)}}})(t[Ra][n])}function Qy(t,e,r,n,i){const{level:s,log:o=h=>h}=i.formatters||{},a=r.slice();let c=a[0];const l={};let u=(t._childLevel|0)+1;if(u<1&&(u=1),n&&(l.time=n),s){const h=s(e,t.levels.values[e]);Object.assign(l,h)}else l.level=t.levels.values[e];if(i.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;u--&&typeof a[0]=="object";)Object.assign(l,a.shift());return[o(l),...a]}else{if(c!==null&&typeof c=="object"){for(;u--&&typeof a[0]=="object";)Object.assign(l,a.shift());c=a.length?jc(a.shift(),a):void 0}else typeof c=="string"&&(c=jc(a.shift(),a));return c!==void 0&&(l[i.messageKey]=c),[o(l)]}}function Ba(t,e,r,n){for(const i in t)if(n&&t[i]instanceof Error)t[i]=lr.stdSerializers.err(t[i]);else if(typeof t[i]=="object"&&!Array.isArray(t[i])&&e)for(const s in t[i])e.indexOf(s)>-1&&s in r&&(t[i][s]=r[s](t[i][s]))}function ew(t,e,r,n=!1){const i=e.send,s=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,l=t._logEvent.bindings;n||Ba(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(u){return l.indexOf(u)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,i(o,t._logEvent,c),t._logEvent=zo(l)}function zo(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function zc(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function tw(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Ch:Nh}function Di(){return{}}function Ks(t){return t}function En(){}function Ch(){return!1}function Nh(){return Date.now()}function rw(){return Math.round(Date.now()/1e3)}function nw(){return new Date(Date.now()).toISOString()}function iw(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}jt.exports.default=lr;jt.exports.pino=lr;const sw={level:"info"},ws="custom_context",Ua=1e3*1024;var ow=Object.defineProperty,aw=(t,e,r)=>e in t?ow(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Or=(t,e,r)=>aw(t,typeof e!="symbol"?e+"":e,r);let cw=class{constructor(e){Or(this,"nodeValue"),Or(this,"sizeInBytes"),Or(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Vc=class{constructor(e){Or(this,"lengthInNodes"),Or(this,"sizeInBytes"),Or(this,"head"),Or(this,"tail"),Or(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new cw(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};const lw=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r);function Kc(t){return typeof t=="string"?t:lw(t)||""}var uw=Object.defineProperty,hw=(t,e,r)=>e in t?uw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Oi=(t,e,r)=>hw(t,typeof e!="symbol"?e+"":e,r);let Rh=class{constructor(e,r=Ua){Oi(this,"logs"),Oi(this,"level"),Oi(this,"levelValue"),Oi(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=jt.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Vc(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===jt.exports.levels.values.error?console.error(e):r===jt.exports.levels.values.warn?console.warn(e):r===jt.exports.levels.values.debug?console.debug(e):r===jt.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Kc({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Vc(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Kc({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var fw=Object.defineProperty,dw=(t,e,r)=>e in t?fw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pw=(t,e,r)=>dw(t,e+"",r);let gw=class{constructor(e,r=Ua){pw(this,"baseChunkLogger"),this.baseChunkLogger=new Rh(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}};var yw=Object.defineProperty,ww=(t,e,r)=>e in t?yw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mw=(t,e,r)=>ww(t,e+"",r);let bw=class{constructor(e,r=Ua){mw(this,"baseChunkLogger"),this.baseChunkLogger=new Rh(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var vw=Object.defineProperty,Ew=Object.defineProperties,_w=Object.getOwnPropertyDescriptors,Hc=Object.getOwnPropertySymbols,xw=Object.prototype.hasOwnProperty,Sw=Object.prototype.propertyIsEnumerable,Wc=(t,e,r)=>e in t?vw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cr=(t,e)=>{for(var r in e||(e={}))xw.call(e,r)&&Wc(t,r,e[r]);if(Hc)for(var r of Hc(e))Sw.call(e,r)&&Wc(t,r,e[r]);return t},Nr=(t,e)=>Ew(t,_w(e));function Iw(t){return Nr(Cr({},t),{level:(t==null?void 0:t.level)||sw.level})}function Dw(t,e,r=ws){return t[r]=e,t}function ot(t,e=ws){return t[e]||""}function Ow(t,e,r=ws){const n=ot(t,r);return n.trim()?`${n}/${e}`:e}function pt(t,e,r=ws){const n=Ow(t,e,r),i=t.child({context:n});return Dw(i,n,r)}function Aw(t){var e,r;const n=new gw((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:jt.exports(Nr(Cr({},t.opts),{level:"trace",browser:Nr(Cr({},(r=t.opts)==null?void 0:r.browser),{write:i=>n.write(i)})})),chunkLoggerController:n}}function $w(t){var e,r;const n=new bw((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:jt.exports(Nr(Cr({},t.opts),{level:"trace",browser:Nr(Cr({},(r=t.opts)==null?void 0:r.browser),{write:i=>n.write(i)})}),n),chunkLoggerController:n}}function Bh(t){var e;if(typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string")return{logger:t.loggerOverride,chunkLoggerController:null};const r=Nr(Cr({},t.opts),{level:typeof t.loggerOverride=="string"?t.loggerOverride:(e=t.opts)==null?void 0:e.level});return typeof window<"u"?Aw(Nr(Cr({},t),{opts:r})):$w(Nr(Cr({},t),{opts:r}))}var Tw=Object.defineProperty,Pw=(t,e,r)=>e in t?Tw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gc=(t,e,r)=>Pw(t,typeof e!="symbol"?e+"":e,r);let Cw=class extends sn{constructor(e){super(),this.opts=e,Gc(this,"protocol","wc"),Gc(this,"version",2)}};var Nw=Object.defineProperty,Rw=(t,e,r)=>e in t?Nw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bw=(t,e,r)=>Rw(t,e+"",r);class Uw extends sn{constructor(e,r){super(),this.core=e,this.logger=r,Bw(this,"records",new Map)}}class kw{constructor(e,r){this.logger=e,this.core=r}}class Mw extends sn{constructor(e,r){super(),this.relayer=e,this.logger=r}}let Fw=class extends sn{constructor(e){super()}},Lw=class{constructor(e,r,n,i){this.core=e,this.logger=r,this.name=n}},jw=class extends sn{constructor(e,r){super(),this.relayer=e,this.logger=r}},qw=class extends sn{constructor(e,r){super(),this.core=e,this.logger=r}},zw=class{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}};class Vw{constructor(e,r){this.projectId=e,this.logger=r}}class Kw{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}}var Hw=Object.defineProperty,Ww=(t,e,r)=>e in t?Hw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yc=(t,e,r)=>Ww(t,typeof e!="symbol"?e+"":e,r);let Gw=class{constructor(e){this.opts=e,Yc(this,"protocol","wc"),Yc(this,"version",2)}},Yw=class{constructor(e){this.client=e}};function Zw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Uh(t,...e){if(!Zw(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Zc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Jw(t,e){Uh(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const fn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Hs=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Xw(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function kh(t){return typeof t=="string"&&(t=Xw(t)),Uh(t),t}let Qw=class{clone(){return this._cloneInto()}};function e0(t){const e=n=>t().update(kh(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Mh(t=32){if(fn&&typeof fn.getRandomValues=="function")return fn.getRandomValues(new Uint8Array(t));if(fn&&typeof fn.randomBytes=="function")return fn.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function t0(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,l=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+l,a,n)}let r0=class extends Qw{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Hs(this.buffer)}update(e){Zc(this);const{view:r,buffer:n,blockLen:i}=this;e=kh(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Hs(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Zc(this),Jw(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;t0(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Hs(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}};const Ai=BigInt(2**32-1),Vo=BigInt(32);function Fh(t,e=!1){return e?{h:Number(t&Ai),l:Number(t>>Vo&Ai)}:{h:Number(t>>Vo&Ai)|0,l:Number(t&Ai)|0}}function n0(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=Fh(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const i0=(t,e)=>BigInt(t>>>0)<<Vo|BigInt(e>>>0),s0=(t,e,r)=>t>>>r,o0=(t,e,r)=>t<<32-r|e>>>r,a0=(t,e,r)=>t>>>r|e<<32-r,c0=(t,e,r)=>t<<32-r|e>>>r,l0=(t,e,r)=>t<<64-r|e>>>r-32,u0=(t,e,r)=>t>>>r-32|e<<64-r,h0=(t,e)=>e,f0=(t,e)=>t,d0=(t,e,r)=>t<<r|e>>>32-r,p0=(t,e,r)=>e<<r|t>>>32-r,g0=(t,e,r)=>e<<r-32|t>>>64-r,y0=(t,e,r)=>t<<r-32|e>>>64-r;function w0(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const m0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),b0=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,v0=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),E0=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,_0=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),x0=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,J={fromBig:Fh,split:n0,toBig:i0,shrSH:s0,shrSL:o0,rotrSH:a0,rotrSL:c0,rotrBH:l0,rotrBL:u0,rotr32H:h0,rotr32L:f0,rotlSH:d0,rotlSL:p0,rotlBH:g0,rotlBL:y0,add:w0,add3L:m0,add3H:b0,add4L:v0,add4H:E0,add5H:x0,add5L:_0},[S0,I0]=J.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),gr=new Uint32Array(80),yr=new Uint32Array(80);let D0=class extends r0{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:p,Gl:d,Hh:g,Hl:w}=this;return[e,r,n,i,s,o,a,c,l,u,h,f,p,d,g,w]}set(e,r,n,i,s,o,a,c,l,u,h,f,p,d,g,w){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=w|0}process(e,r){for(let y=0;y<16;y++,r+=4)gr[y]=e.getUint32(r),yr[y]=e.getUint32(r+=4);for(let y=16;y<80;y++){const E=gr[y-15]|0,I=yr[y-15]|0,O=J.rotrSH(E,I,1)^J.rotrSH(E,I,8)^J.shrSH(E,I,7),N=J.rotrSL(E,I,1)^J.rotrSL(E,I,8)^J.shrSL(E,I,7),R=gr[y-2]|0,P=yr[y-2]|0,M=J.rotrSH(R,P,19)^J.rotrBH(R,P,61)^J.shrSH(R,P,6),U=J.rotrSL(R,P,19)^J.rotrBL(R,P,61)^J.shrSL(R,P,6),C=J.add4L(N,U,yr[y-7],yr[y-16]),D=J.add4H(C,O,M,gr[y-7],gr[y-16]);gr[y]=D|0,yr[y]=C|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:p,Fl:d,Gh:g,Gl:w,Hh:m,Hl:_}=this;for(let y=0;y<80;y++){const E=J.rotrSH(h,f,14)^J.rotrSH(h,f,18)^J.rotrBH(h,f,41),I=J.rotrSL(h,f,14)^J.rotrSL(h,f,18)^J.rotrBL(h,f,41),O=h&p^~h&g,N=f&d^~f&w,R=J.add5L(_,I,N,I0[y],yr[y]),P=J.add5H(R,m,E,O,S0[y],gr[y]),M=R|0,U=J.rotrSH(n,i,28)^J.rotrBH(n,i,34)^J.rotrBH(n,i,39),C=J.rotrSL(n,i,28)^J.rotrBL(n,i,34)^J.rotrBL(n,i,39),D=n&s^n&a^s&a,T=i&o^i&c^o&c;m=g|0,_=w|0,g=p|0,w=d|0,p=h|0,d=f|0,{h,l:f}=J.add(l|0,u|0,P|0,M|0),l=a|0,u=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const v=J.add3L(M,C,T);n=J.add3H(v,P,U,D),i=v|0}({h:n,l:i}=J.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=J.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=J.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=J.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=J.add(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=J.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:w}=J.add(this.Gh|0,this.Gl|0,g|0,w|0),{h:m,l:_}=J.add(this.Hh|0,this.Hl|0,m|0,_|0),this.set(n,i,s,o,a,c,l,u,h,f,p,d,g,w,m,_)}roundClean(){gr.fill(0),yr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const O0=e0(()=>new D0);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ka=BigInt(0),Lh=BigInt(1),A0=BigInt(2);function Ma(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Fa(t){if(!Ma(t))throw new Error("Uint8Array expected")}function Ws(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const $0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function La(t){Fa(t);let e="";for(let r=0;r<t.length;r++)e+=$0[t[r]];return e}function jh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ka:BigInt("0x"+t)}const Wt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Jc(t){if(t>=Wt._0&&t<=Wt._9)return t-Wt._0;if(t>=Wt.A&&t<=Wt.F)return t-(Wt.A-10);if(t>=Wt.a&&t<=Wt.f)return t-(Wt.a-10)}function qh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Jc(t.charCodeAt(s)),a=Jc(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function T0(t){return jh(La(t))}function qi(t){return Fa(t),jh(La(Uint8Array.from(t).reverse()))}function zh(t,e){return qh(t.toString(16).padStart(e*2,"0"))}function Ko(t,e){return zh(t,e).reverse()}function Gt(t,e,r){let n;if(typeof e=="string")try{n=qh(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ma(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Xc(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Fa(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const Gs=t=>typeof t=="bigint"&&ka<=t;function P0(t,e,r){return Gs(t)&&Gs(e)&&Gs(r)&&e<=t&&t<r}function Rn(t,e,r,n){if(!P0(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function C0(t){let e;for(e=0;t>ka;t>>=Lh,e+=1);return e}const N0=t=>(A0<<BigInt(t-1))-Lh,R0={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ma(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ja(t,e,r={}){const n=(i,s,o)=>{const a=R0[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function Qc(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const $e=BigInt(0),ye=BigInt(1),Kr=BigInt(2),B0=BigInt(3),Ho=BigInt(4),el=BigInt(5),tl=BigInt(8);function _e(t,e){const r=t%e;return r>=$e?r:e+r}function U0(t,e,r){if(e<$e)throw new Error("invalid exponent, negatives unsupported");if(r<=$e)throw new Error("invalid modulus");if(r===ye)return $e;let n=ye;for(;e>$e;)e&ye&&(n=n*t%r),t=t*t%r,e>>=ye;return n}function Rt(t,e,r){let n=t;for(;e-- >$e;)n*=n,n%=r;return n}function rl(t,e){if(t===$e)throw new Error("invert: expected non-zero number");if(e<=$e)throw new Error("invert: expected positive modulus, got "+e);let r=_e(t,e),n=e,i=$e,s=ye;for(;r!==$e;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==ye)throw new Error("invert: does not exist");return _e(i,e)}function k0(t){const e=(t-ye)/Kr;let r,n,i;for(r=t-ye,n=0;r%Kr===$e;r/=Kr,n++);for(i=Kr;i<t&&U0(i,e,t)!==t-ye;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+ye)/Ho;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const s=(r+ye)/Kr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,l=o.pow(o.mul(o.ONE,i),r),u=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(h);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);const p=o.pow(l,ye<<BigInt(c-f-1));l=o.sqr(p),u=o.mul(u,p),h=o.mul(h,l),c=f}return u}}function M0(t){if(t%Ho===B0){const e=(t+ye)/Ho;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%tl===el){const e=(t-el)/tl;return function(r,n){const i=r.mul(n,Kr),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,Kr),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return k0(t)}const F0=(t,e)=>(_e(t,e)&ye)===ye,L0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function j0(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=L0.reduce((n,i)=>(n[i]="function",n),e);return ja(t,r)}function q0(t,e,r){if(r<$e)throw new Error("invalid exponent, negatives unsupported");if(r===$e)return t.ONE;if(r===ye)return e;let n=t.ONE,i=e;for(;r>$e;)r&ye&&(n=t.mul(n,i)),i=t.sqr(i),r>>=ye;return n}function z0(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function Vh(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Kh(t,e,r=!1,n={}){if(t<=$e)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Vh(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:N0(i),ZERO:$e,ONE:ye,create:c=>_e(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return $e<=c&&c<t},is0:c=>c===$e,isOdd:c=>(c&ye)===ye,neg:c=>_e(-c,t),eql:(c,l)=>c===l,sqr:c=>_e(c*c,t),add:(c,l)=>_e(c+l,t),sub:(c,l)=>_e(c-l,t),mul:(c,l)=>_e(c*l,t),pow:(c,l)=>q0(a,c,l),div:(c,l)=>_e(c*rl(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>rl(c,t),sqrt:n.sqrt||(c=>(o||(o=M0(t)),o(a,c))),invertBatch:c=>z0(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>r?Ko(c,s):zh(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?qi(c):T0(c)}});return Object.freeze(a)}const nl=BigInt(0),$i=BigInt(1);function Ys(t,e){const r=e.negate();return t?r:e}function Hh(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Zs(t,e){Hh(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function V0(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function K0(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Js=new WeakMap,Wh=new WeakMap;function Xs(t){return Wh.get(t)||1}function H0(t,e){return{constTimeNegate:Ys,hasPrecomputes(r){return Xs(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>nl;)n&$i&&(i=i.add(s)),s=s.double(),n>>=$i;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Zs(n,e),o=[];let a=r,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=Zs(r,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**r-1),u=2**r,h=BigInt(r);for(let f=0;f<s;f++){const p=f*o;let d=Number(i&l);i>>=h,d>o&&(d-=u,i+=$i);const g=p,w=p+Math.abs(d)-1,m=f%2!==0,_=d<0;d===0?c=c.add(Ys(m,n[g])):a=a.add(Ys(_,n[w]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=Zs(r,e),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(i===nl)break;let p=Number(i&c);if(i>>=u,p>a&&(p-=l,i+=$i),p===0)continue;let d=n[f+Math.abs(p)-1];p<0&&(d=d.negate()),s=s.add(d)}return s},getPrecomputes(r,n,i){let s=Js.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&Js.set(n,i(s))),s},wNAFCached(r,n,i){const s=Xs(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=Xs(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Hh(n,e),Wh.set(r,n),Js.delete(r)}}}function W0(t,e,r,n){if(V0(r,t),K0(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=C0(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),l=Math.floor((e.BITS-1)/o)*o;let u=i;for(let h=l;h>=0;h-=o){c.fill(i);for(let p=0;p<n.length;p++){const d=n[p],g=Number(d>>BigInt(h)&BigInt(a));c[g]=c[g].add(r[p])}let f=i;for(let p=c.length-1,d=i;p>0;p--)d=d.add(c[p]),f=f.add(d);if(u=u.add(f),h!==0)for(let p=0;p<o;p++)u=u.double()}return u}function G0(t){return j0(t.Fp),ja(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Vh(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const Dt=BigInt(0),Ge=BigInt(1),Ti=BigInt(2),Y0=BigInt(8),Z0={zip215:!0};function J0(t){const e=G0(t);return ja(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function X0(t){const e=J0(t),{Fp:r,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,l=Ti<<BigInt(a*8)-Ge,u=r.create,h=Kh(e.n,e.nBitLength),f=e.uvRatio||((v,b)=>{try{return{isValid:!0,value:r.sqrt(v*r.inv(b))}}catch{return{isValid:!1,value:Dt}}}),p=e.adjustScalarBytes||(v=>v),d=e.domain||((v,b,S)=>{if(Ws("phflag",S),b.length||S)throw new Error("Contexts/pre-hash are not supported");return v});function g(v,b){Rn("coordinate "+v,b,Dt,l)}function w(v){if(!(v instanceof y))throw new Error("ExtendedPoint expected")}const m=Qc((v,b)=>{const{ex:S,ey:$,ez:x}=v,A=v.is0();b==null&&(b=A?Y0:r.inv(x));const B=u(S*b),k=u($*b),K=u(x*b);if(A)return{x:Dt,y:Ge};if(K!==Ge)throw new Error("invZ was invalid");return{x:B,y:k}}),_=Qc(v=>{const{a:b,d:S}=e;if(v.is0())throw new Error("bad point: ZERO");const{ex:$,ey:x,ez:A,et:B}=v,k=u($*$),K=u(x*x),z=u(A*A),q=u(z*z),H=u(k*b),G=u(z*u(H+K)),X=u(q+u(S*u(k*K)));if(G!==X)throw new Error("bad point: equation left != right (1)");const W=u($*x),Q=u(A*B);if(W!==Q)throw new Error("bad point: equation left != right (2)");return!0});class y{constructor(b,S,$,x){this.ex=b,this.ey=S,this.ez=$,this.et=x,g("x",b),g("y",S),g("z",$),g("t",x),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(b){if(b instanceof y)throw new Error("extended point not allowed");const{x:S,y:$}=b||{};return g("x",S),g("y",$),new y(S,$,Ge,u(S*$))}static normalizeZ(b){const S=r.invertBatch(b.map($=>$.ez));return b.map(($,x)=>$.toAffine(S[x])).map(y.fromAffine)}static msm(b,S){return W0(y,h,b,S)}_setWindowSize(b){O.setWindowSize(this,b)}assertValidity(){_(this)}equals(b){w(b);const{ex:S,ey:$,ez:x}=this,{ex:A,ey:B,ez:k}=b,K=u(S*k),z=u(A*x),q=u($*k),H=u(B*x);return K===z&&q===H}is0(){return this.equals(y.ZERO)}negate(){return new y(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:b}=e,{ex:S,ey:$,ez:x}=this,A=u(S*S),B=u($*$),k=u(Ti*u(x*x)),K=u(b*A),z=S+$,q=u(u(z*z)-A-B),H=K+B,G=H-k,X=K-B,W=u(q*G),Q=u(H*X),pe=u(q*X),be=u(G*H);return new y(W,Q,be,pe)}add(b){w(b);const{a:S,d:$}=e,{ex:x,ey:A,ez:B,et:k}=this,{ex:K,ey:z,ez:q,et:H}=b;if(S===BigInt(-1)){const gc=u((A-x)*(z+K)),yc=u((A+x)*(z-K)),Us=u(yc-gc);if(Us===Dt)return this.double();const wc=u(B*Ti*H),mc=u(k*Ti*q),bc=mc+wc,vc=yc+gc,Ec=mc-wc,Up=u(bc*Us),kp=u(vc*Ec),Mp=u(bc*Ec),Fp=u(Us*vc);return new y(Up,kp,Fp,Mp)}const G=u(x*K),X=u(A*z),W=u(k*$*H),Q=u(B*q),pe=u((x+A)*(K+z)-G-X),be=Q-W,xe=Q+W,Ve=u(X-S*G),Kt=u(pe*be),dr=u(xe*Ve),Rp=u(pe*Ve),Bp=u(be*xe);return new y(Kt,dr,Bp,Rp)}subtract(b){return this.add(b.negate())}wNAF(b){return O.wNAFCached(this,b,y.normalizeZ)}multiply(b){const S=b;Rn("scalar",S,Ge,n);const{p:$,f:x}=this.wNAF(S);return y.normalizeZ([$,x])[0]}multiplyUnsafe(b,S=y.ZERO){const $=b;return Rn("scalar",$,Dt,n),$===Dt?I:this.is0()||$===Ge?this:O.wNAFCachedUnsafe(this,$,y.normalizeZ,S)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return O.unsafeLadder(this,n).is0()}toAffine(b){return m(this,b)}clearCofactor(){const{h:b}=e;return b===Ge?this:this.multiplyUnsafe(b)}static fromHex(b,S=!1){const{d:$,a:x}=e,A=r.BYTES;b=Gt("pointHex",b,A),Ws("zip215",S);const B=b.slice(),k=b[A-1];B[A-1]=k&-129;const K=qi(B),z=S?l:r.ORDER;Rn("pointHex.y",K,Dt,z);const q=u(K*K),H=u(q-Ge),G=u($*q-x);let{isValid:X,value:W}=f(H,G);if(!X)throw new Error("Point.fromHex: invalid y coordinate");const Q=(W&Ge)===Ge,pe=(k&128)!==0;if(!S&&W===Dt&&pe)throw new Error("Point.fromHex: x=0 and x_0=1");return pe!==Q&&(W=u(-W)),y.fromAffine({x:W,y:K})}static fromPrivateKey(b){return P(b).point}toRawBytes(){const{x:b,y:S}=this.toAffine(),$=Ko(S,r.BYTES);return $[$.length-1]|=b&Ge?128:0,$}toHex(){return La(this.toRawBytes())}}y.BASE=new y(e.Gx,e.Gy,Ge,u(e.Gx*e.Gy)),y.ZERO=new y(Dt,Ge,Ge,Dt);const{BASE:E,ZERO:I}=y,O=H0(y,a*8);function N(v){return _e(v,n)}function R(v){return N(qi(v))}function P(v){const b=r.BYTES;v=Gt("private key",v,b);const S=Gt("hashed private key",s(v),2*b),$=p(S.slice(0,b)),x=S.slice(b,2*b),A=R($),B=E.multiply(A),k=B.toRawBytes();return{head:$,prefix:x,scalar:A,point:B,pointBytes:k}}function M(v){return P(v).pointBytes}function U(v=new Uint8Array,...b){const S=Xc(...b);return R(s(d(S,Gt("context",v),!!i)))}function C(v,b,S={}){v=Gt("message",v),i&&(v=i(v));const{prefix:$,scalar:x,pointBytes:A}=P(b),B=U(S.context,$,v),k=E.multiply(B).toRawBytes(),K=U(S.context,k,A,v),z=N(B+K*x);Rn("signature.s",z,Dt,n);const q=Xc(k,Ko(z,r.BYTES));return Gt("result",q,r.BYTES*2)}const D=Z0;function T(v,b,S,$=D){const{context:x,zip215:A}=$,B=r.BYTES;v=Gt("signature",v,2*B),b=Gt("message",b),S=Gt("publicKey",S,B),A!==void 0&&Ws("zip215",A),i&&(b=i(b));const k=qi(v.slice(B,2*B));let K,z,q;try{K=y.fromHex(S,A),z=y.fromHex(v.slice(0,B),A),q=E.multiplyUnsafe(k)}catch{return!1}if(!A&&K.isSmallOrder())return!1;const H=U(x,z.toRawBytes(),K.toRawBytes(),b);return z.add(K.multiplyUnsafe(H)).subtract(q).clearCofactor().equals(y.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:M,sign:C,verify:T,ExtendedPoint:y,utils:{getExtendedPublicKey:P,randomPrivateKey:()=>o(r.BYTES),precompute(v=8,b=y.BASE){return b._setWindowSize(v),b.multiply(BigInt(3)),b}}}}BigInt(0),BigInt(1);const qa=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),il=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Q0=BigInt(1),sl=BigInt(2);BigInt(3);const em=BigInt(5),tm=BigInt(8);function rm(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=qa,o=t*t%s*t%s,a=Rt(o,sl,s)*o%s,c=Rt(a,Q0,s)*t%s,l=Rt(c,em,s)*c%s,u=Rt(l,e,s)*l%s,h=Rt(u,r,s)*u%s,f=Rt(h,n,s)*h%s,p=Rt(f,i,s)*f%s,d=Rt(p,i,s)*f%s,g=Rt(d,e,s)*l%s;return{pow_p_5_8:Rt(g,sl,s)*t%s,b2:o}}function nm(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function im(t,e){const r=qa,n=_e(e*e*e,r),i=_e(n*n*e,r),s=rm(t*i).pow_p_5_8;let o=_e(t*n*s,r);const a=_e(e*o*o,r),c=o,l=_e(o*il,r),u=a===t,h=a===_e(-t,r),f=a===_e(-t*il,r);return u&&(o=c),(h||f)&&(o=l),F0(o,r)&&(o=_e(-o,r)),{isValid:u||h,value:o}}const sm=Kh(qa,void 0,!0),om={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:sm,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:tm,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:O0,randomBytes:Mh,adjustScalarBytes:nm,uvRatio:im},Gh=X0(om),am="EdDSA",cm="JWT",Qi=".",ms="base64url",Yh="utf8",Zh="utf8",lm=":",um="did",hm="key",ol="base58btc",fm="z",dm="K36",pm=32;function za(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Jh(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?za(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Xh(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=Jh(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return za(r)}function gm(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,w=0,m=0,_=d.length;m!==_&&d[m]===0;)m++,g++;for(var y=(_-m)*u+1>>>0,E=new Uint8Array(y);m!==_;){for(var I=d[m],O=0,N=y-1;(I!==0||O<w)&&N!==-1;N--,O++)I+=256*E[N]>>>0,E[N]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");w=O,m++}for(var R=y-w;R!==y&&E[R]===0;)R++;for(var P=c.repeat(g);R<y;++R)P+=t.charAt(E[R]);return P}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var w=0,m=0;d[g]===c;)w++,g++;for(var _=(d.length-g)*l+1>>>0,y=new Uint8Array(_);d[g];){var E=r[d.charCodeAt(g)];if(E===255)return;for(var I=0,O=_-1;(E!==0||I<m)&&O!==-1;O--,I++)E+=a*y[O]>>>0,y[O]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=I,g++}if(d[g]!==" "){for(var N=_-m;N!==_&&y[N]===0;)N++;for(var R=new Uint8Array(w+(_-N)),P=w;N!==_;)R[P++]=y[N++];return R}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var ym=gm,wm=ym;const Qh=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},mm=t=>new TextEncoder().encode(t),bm=t=>new TextDecoder().decode(t);let vm=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Em=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ef(this,e)}},_m=class{constructor(e){this.decoders=e}or(e){return ef(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const ef=(t,e)=>new _m({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let xm=class{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new vm(e,r,n),this.decoder=new Em(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const bs=({name:t,prefix:e,encode:r,decode:n})=>new xm(t,e,r,n),di=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=wm(r,e);return bs({prefix:t,name:e,encode:n,decode:s=>Qh(i(s))})},Sm=(t,e,r,n)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=i[t[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Im=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},Be=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>bs({prefix:e,name:t,encode(i){return Im(i,n,r)},decode(i){return Sm(i,n,r,t)}}),Dm=bs({prefix:"\0",name:"identity",encode:t=>bm(t),decode:t=>mm(t)});var Om=Object.freeze({__proto__:null,identity:Dm});const Am=Be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var $m=Object.freeze({__proto__:null,base2:Am});const Tm=Be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Pm=Object.freeze({__proto__:null,base8:Tm});const Cm=di({prefix:"9",name:"base10",alphabet:"0123456789"});var Nm=Object.freeze({__proto__:null,base10:Cm});const Rm=Be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Bm=Be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Um=Object.freeze({__proto__:null,base16:Rm,base16upper:Bm});const km=Be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Mm=Be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Fm=Be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Lm=Be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),jm=Be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),qm=Be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),zm=Be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Vm=Be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Km=Be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Hm=Object.freeze({__proto__:null,base32:km,base32upper:Mm,base32pad:Fm,base32padupper:Lm,base32hex:jm,base32hexupper:qm,base32hexpad:zm,base32hexpadupper:Vm,base32z:Km});const Wm=di({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Gm=di({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ym=Object.freeze({__proto__:null,base36:Wm,base36upper:Gm});const Zm=di({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Jm=di({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Xm=Object.freeze({__proto__:null,base58btc:Zm,base58flickr:Jm});const Qm=Be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),eb=Be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),tb=Be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),rb=Be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var nb=Object.freeze({__proto__:null,base64:Qm,base64pad:eb,base64url:tb,base64urlpad:rb});const tf=Array.from(""),ib=tf.reduce((t,e,r)=>(t[r]=e,t),[]),sb=tf.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function ob(t){return t.reduce((e,r)=>(e+=ib[r],e),"")}function ab(t){const e=[];for(const r of t){const n=sb[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const cb=bs({prefix:"",name:"base256emoji",encode:ob,decode:ab});var lb=Object.freeze({__proto__:null,base256emoji:cb}),ub=rf,al=128,hb=-128,fb=Math.pow(2,31);function rf(t,e,r){e=e||[],r=r||0;for(var n=r;t>=fb;)e[r++]=t&255|al,t/=128;for(;t&hb;)e[r++]=t&255|al,t>>>=7;return e[r]=t|0,rf.bytes=r-n+1,e}var db=Wo,pb=128,cl=127;function Wo(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw Wo.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&cl)<<i:(o&cl)*Math.pow(2,i),i+=7}while(o>=pb);return Wo.bytes=s-n,r}var gb=Math.pow(2,7),yb=Math.pow(2,14),wb=Math.pow(2,21),mb=Math.pow(2,28),bb=Math.pow(2,35),vb=Math.pow(2,42),Eb=Math.pow(2,49),_b=Math.pow(2,56),xb=Math.pow(2,63),Sb=function(t){return t<gb?1:t<yb?2:t<wb?3:t<mb?4:t<bb?5:t<vb?6:t<Eb?7:t<_b?8:t<xb?9:10},Ib={encode:ub,decode:db,encodingLength:Sb},nf=Ib;const ll=(t,e,r=0)=>(nf.encode(t,e,r),e),ul=t=>nf.encodingLength(t),Go=(t,e)=>{const r=e.byteLength,n=ul(t),i=n+ul(r),s=new Uint8Array(i+r);return ll(t,s,0),ll(r,s,n),s.set(e,i),new Db(t,r,e,s)};let Db=class{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};const sf=({name:t,code:e,encode:r})=>new Ob(t,e,r);let Ob=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Go(this.code,r):r.then(n=>Go(this.code,n))}else throw Error("Unknown type, must be binary type")}};const of=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Ab=sf({name:"sha2-256",code:18,encode:of("SHA-256")}),$b=sf({name:"sha2-512",code:19,encode:of("SHA-512")});var Tb=Object.freeze({__proto__:null,sha256:Ab,sha512:$b});const af=0,Pb="identity",cf=Qh,Cb=t=>Go(af,cf(t)),Nb={code:af,name:Pb,encode:cf,digest:Cb};var Rb=Object.freeze({__proto__:null,identity:Nb});new TextEncoder,new TextDecoder;const hl={...Om,...$m,...Pm,...Nm,...Um,...Hm,...Ym,...Xm,...nb,...lb};({...Tb,...Rb});function lf(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const fl=lf("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Qs=lf("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Jh(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),uf={utf8:fl,"utf-8":fl,hex:hl.base16,latin1:Qs,ascii:Qs,binary:Qs,...hl};function vs(t,e="utf8"){const r=uf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function $n(t,e="utf8"){const r=uf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?za(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function dl(t){return Dn(vs($n(t,ms),Yh))}function es(t){return vs($n(fi(t),Yh),ms)}function hf(t){const e=$n(dm,ol),r=fm+vs(Xh([e,t]),ol);return[um,hm,r].join(lm)}function Bb(t){return vs(t,ms)}function Ub(t){return $n(t,ms)}function kb(t){return $n([es(t.header),es(t.payload)].join(Qi),Zh)}function Mb(t){return[es(t.header),es(t.payload),Bb(t.signature)].join(Qi)}function Yo(t){const e=t.split(Qi),r=dl(e[0]),n=dl(e[1]),i=Ub(e[2]),s=$n(e.slice(0,2).join(Qi),Zh);return{header:r,payload:n,signature:i,data:s}}function pl(t=Mh(pm)){const e=Gh.getPublicKey(t);return{secretKey:Xh([t,e]),publicKey:e}}async function Fb(t,e,r,n,i=L.fromMiliseconds(Date.now())){const s={alg:am,typ:cm},o=hf(n.publicKey),a=i+r,c={iss:o,sub:t,aud:e,iat:i,exp:a},l=kb({header:s,payload:c}),u=Gh.sign(l,n.secretKey.slice(0,32));return Mb({header:s,payload:c,signature:u})}var gl=function(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},Lb=(function(){function t(e,r,n){this.name=e,this.version=r,this.os=n,this.type="browser"}return t})(),jb=(function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=St.platform}return t})(),qb=(function(){function t(e,r,n,i){this.name=e,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return t})(),zb=(function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t})(),Vb=(function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t})(),Kb=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Hb=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,yl=3,Wb=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Kb]],wl=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Gb(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Vb:typeof navigator<"u"?Zb(navigator.userAgent):Xb()}function Yb(t){return t!==""&&Wb.reduce(function(e,r){var n=r[0],i=r[1];if(e)return e;var s=i.exec(t);return!!s&&[n,s]},!1)}function Zb(t){var e=Yb(t);if(!e)return null;var r=e[0],n=e[1];if(r==="searchbot")return new zb;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<yl&&(i=gl(gl([],i,!0),Qb(yl-i.length),!0)):i=[];var s=i.join("."),o=Jb(t),a=Hb.exec(t);return a&&a[1]?new qb(r,s,o,a[1]):new Lb(r,s,o)}function Jb(t){for(var e=0,r=wl.length;e<r;e++){var n=wl[e],i=n[0],s=n[1],o=s.exec(t);if(o)return i}return null}function Xb(){var t=typeof St<"u"&&St.version;return t?new jb(St.version.slice(1)):null}function Qb(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var ce={},ml;function ff(){if(ml)return ce;ml=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.getLocalStorage=ce.getLocalStorageOrThrow=ce.getCrypto=ce.getCryptoOrThrow=ce.getLocation=ce.getLocationOrThrow=ce.getNavigator=ce.getNavigatorOrThrow=ce.getDocument=ce.getDocumentOrThrow=ce.getFromWindowOrThrow=ce.getFromWindow=void 0;function t(f){let p;return typeof window<"u"&&typeof window[f]<"u"&&(p=window[f]),p}ce.getFromWindow=t;function e(f){const p=t(f);if(!p)throw new Error(`${f} is not defined in Window`);return p}ce.getFromWindowOrThrow=e;function r(){return e("document")}ce.getDocumentOrThrow=r;function n(){return t("document")}ce.getDocument=n;function i(){return e("navigator")}ce.getNavigatorOrThrow=i;function s(){return t("navigator")}ce.getNavigator=s;function o(){return e("location")}ce.getLocationOrThrow=o;function a(){return t("location")}ce.getLocation=a;function c(){return e("crypto")}ce.getCryptoOrThrow=c;function l(){return t("crypto")}ce.getCrypto=l;function u(){return e("localStorage")}ce.getLocalStorageOrThrow=u;function h(){return t("localStorage")}return ce.getLocalStorage=h,ce}var hr=ff(),Bn={},bl;function e1(){if(bl)return Bn;bl=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.getWindowMetadata=void 0;const t=ff();function e(){let r,n;try{r=t.getDocumentOrThrow(),n=t.getLocationOrThrow()}catch{return null}function i(){const p=r.getElementsByTagName("link"),d=[];for(let g=0;g<p.length;g++){const w=p[g],m=w.getAttribute("rel");if(m&&m.toLowerCase().indexOf("icon")>-1){const _=w.getAttribute("href");if(_)if(_.toLowerCase().indexOf("https:")===-1&&_.toLowerCase().indexOf("http:")===-1&&_.indexOf("//")!==0){let y=n.protocol+"//"+n.host;if(_.indexOf("/")===0)y+=_;else{const E=n.pathname.split("/");E.pop();const I=E.join("/");y+=I+"/"+_}d.push(y)}else if(_.indexOf("//")===0){const y=n.protocol+_;d.push(y)}else d.push(_)}}return d}function s(...p){const d=r.getElementsByTagName("meta");for(let g=0;g<d.length;g++){const w=d[g],m=["itemprop","property","name"].map(_=>w.getAttribute(_)).filter(_=>_?p.includes(_):!1);if(m.length&&m){const _=w.getAttribute("content");if(_)return _}}return""}function o(){let p=s("name","og:site_name","og:title","twitter:title");return p||(p=r.title),p}function a(){return s("description","og:description","twitter:description","keywords")}const c=o(),l=a(),u=n.origin,h=i();return{description:l,url:u,icons:h,name:c}}return Bn.getWindowMetadata=e,Bn}var t1=e1();const r1="0.1.1";function n1(){return r1}class de extends Error{constructor(e,r={}){const n=(()=>{var c;if(r.cause instanceof de){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:(c=r.cause)!=null&&c.message?r.cause.message:r.details})(),i=r.cause instanceof de&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${i??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||i?["",n?`Details: ${n}`:void 0,i?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${n1()}`}),this.cause=r.cause,this.details=n,this.docs=o,this.docsPath=i,this.shortMessage=e}walk(e){return df(this,e)}}function df(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?df(t.cause,e):e?null:t}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Va=BigInt(0),Zo=BigInt(1);function pi(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ka(t){if(!pi(t))throw new Error("Uint8Array expected")}function ri(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function Pi(t){const e=t.toString(16);return e.length&1?"0"+e:e}function pf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Va:BigInt("0x"+t)}const gf=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",i1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ni(t){if(Ka(t),gf)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=i1[t[r]];return e}const Yt={_0:48,_9:57,A:65,F:70,a:97,f:102};function vl(t){if(t>=Yt._0&&t<=Yt._9)return t-Yt._0;if(t>=Yt.A&&t<=Yt.F)return t-(Yt.A-10);if(t>=Yt.a&&t<=Yt.f)return t-(Yt.a-10)}function ts(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(gf)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=vl(t.charCodeAt(s)),a=vl(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Qr(t){return pf(ni(t))}function yf(t){return Ka(t),pf(ni(Uint8Array.from(t).reverse()))}function gi(t,e){return ts(t.toString(16).padStart(e*2,"0"))}function wf(t,e){return gi(t,e).reverse()}function vt(t,e,r){let n;if(typeof e=="string")try{n=ts(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(pi(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function rs(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Ka(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const eo=t=>typeof t=="bigint"&&Va<=t;function Ha(t,e,r){return eo(t)&&eo(e)&&eo(r)&&e<=t&&t<r}function _n(t,e,r,n){if(!Ha(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function s1(t){let e;for(e=0;t>Va;t>>=Zo,e+=1);return e}const Es=t=>(Zo<<BigInt(t))-Zo,to=t=>new Uint8Array(t),El=t=>Uint8Array.from(t);function o1(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=to(t),i=to(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...h)=>r(i,n,...h),c=(h=to(0))=>{i=a(El([0]),h),n=a(),h.length!==0&&(i=a(El([1]),h),n=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){n=a();const p=n.slice();f.push(p),h+=n.length}return rs(...f)};return(h,f)=>{o(),c(h);let p;for(;!(p=f(l()));)c();return o(),p}}const a1={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||pi(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function _s(t,e,r={}){const n=(i,s,o)=>{const a=a1[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function _l(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}function c1(t,e){if(Dl(t)>e)throw new $1({givenSize:Dl(t),maxSize:e})}const Zt={zero:48,nine:57,A:65,F:70,a:97,f:102};function xl(t){if(t>=Zt.zero&&t<=Zt.nine)return t-Zt.zero;if(t>=Zt.A&&t<=Zt.F)return t-(Zt.A-10);if(t>=Zt.a&&t<=Zt.f)return t-(Zt.a-10)}function l1(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new T1({size:t.length,targetSize:n,type:"Bytes"});const i=new Uint8Array(n);for(let s=0;s<n;s++){const o=r==="right";i[o?s:n-s-1]=t[o?s:t.length-s-1]}return i}function mf(t,e){if(Br(t)>e)throw new b1({givenSize:Br(t),maxSize:e})}function u1(t,e){if(typeof e=="number"&&e>0&&e>Br(t)-1)throw new Ef({offset:e,position:"start",size:Br(t)})}function h1(t,e,r){if(typeof e=="number"&&typeof r=="number"&&Br(t)!==r-e)throw new Ef({offset:r,position:"end",size:Br(t)})}function bf(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;const i=t.replace("0x","");if(i.length>n*2)throw new v1({size:Math.ceil(i.length/2),targetSize:n,type:"Hex"});return`0x${i[r==="right"?"padEnd":"padStart"](n*2,"0")}`}const f1="#__bigint";function Wa(t,e,r){return JSON.stringify(t,(n,i)=>typeof i=="bigint"?i.toString()+f1:i,r)}const d1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function p1(t,e={}){const{strict:r=!1}=e;if(!t)throw new Sl(t);if(typeof t!="string")throw new Sl(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new Il(t);if(!t.startsWith("0x"))throw new Il(t)}function g1(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function Ga(t){return t instanceof Uint8Array?ns(t):Array.isArray(t)?ns(new Uint8Array(t)):t}function ns(t,e={}){let r="";for(let i=0;i<t.length;i++)r+=d1[t[i]];const n=`0x${r}`;return typeof e.size=="number"?(mf(n,e.size),vf(n,e.size)):n}function ro(t,e={}){const{signed:r,size:n}=e,i=BigInt(t);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<o){const l=typeof t=="bigint"?"n":"";throw new m1({max:s?`${s}${l}`:void 0,min:`${o}${l}`,signed:r,size:n,value:`${t}${l}`})}const c=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?y1(c,n):c}function y1(t,e){return bf(t,{dir:"left",size:e})}function vf(t,e){return bf(t,{dir:"right",size:e})}function rr(t,e,r,n={}){const{strict:i}=n;u1(t,e);const s=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return i&&h1(s,e,r),s}function Br(t){return Math.ceil((t.length-2)/2)}function w1(t,e={}){const{strict:r=!1}=e;try{return p1(t,{strict:r}),!0}catch{return!1}}class m1 extends de{constructor({max:e,min:r,signed:n,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class Sl extends de{constructor(e){super(`Value \`${typeof e=="object"?Wa(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class Il extends de{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let b1=class extends de{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class Ef extends de{constructor({offset:e,position:r,size:n}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let v1=class extends de{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const E1=new TextEncoder;function _1(t){if(!(t instanceof Uint8Array)){if(!t)throw new Ci(t);if(typeof t!="object")throw new Ci(t);if(!("BYTES_PER_ELEMENT"in t))throw new Ci(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new Ci(t)}}function x1(t){return t instanceof Uint8Array?t:typeof t=="string"?I1(t):S1(t)}function S1(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function I1(t,e={}){const{size:r}=e;let n=t;r&&(mf(t,r),n=vf(t,r));let i=n.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const l=xl(i.charCodeAt(c++)),u=xl(i.charCodeAt(c++));if(l===void 0||u===void 0)throw new de(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=l*16+u}return o}function D1(t,e={}){const{size:r}=e,n=E1.encode(t);return typeof r=="number"?(c1(n,r),O1(n,r)):n}function O1(t,e){return l1(t,{dir:"right",size:e})}function Dl(t){return t.length}function A1(t){try{return _1(t),!0}catch{return!1}}class Ci extends de{constructor(e){super(`Value \`${typeof e=="object"?Wa(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class $1 extends de{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class T1 extends de{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function _f(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,n=Vp(x1(t));return r==="Bytes"?n:ns(n)}class P1 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const C1={checksum:new P1(8192)},no=C1.checksum;function xf(t,e={}){const{compressed:r}=e,{prefix:n,x:i,y:s}=t;if(r===!1||typeof i=="bigint"&&typeof s=="bigint"){if(n!==4)throw new Ol({prefix:n,cause:new M1});return}if(r===!0||typeof i=="bigint"&&typeof s>"u"){if(n!==3&&n!==2)throw new Ol({prefix:n,cause:new k1});return}throw new U1({publicKey:t})}function N1(t){const e=(()=>{if(w1(t))return Sf(t);if(A1(t))return R1(t);const{prefix:r,x:n,y:i}=t;return typeof n=="bigint"&&typeof i=="bigint"?{prefix:r??4,x:n,y:i}:{prefix:r,x:n}})();return xf(e),e}function R1(t){return Sf(ns(t))}function Sf(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new F1({publicKey:t});if(t.length===130){const n=BigInt(rr(t,0,32)),i=BigInt(rr(t,32,64));return{prefix:4,x:n,y:i}}if(t.length===132){const n=Number(rr(t,0,1)),i=BigInt(rr(t,1,33)),s=BigInt(rr(t,33,65));return{prefix:n,x:i,y:s}}const e=Number(rr(t,0,1)),r=BigInt(rr(t,1,33));return{prefix:e,x:r}}function B1(t,e={}){xf(t);const{prefix:r,x:n,y:i}=t,{includePrefix:s=!0}=e;return g1(s?ro(r,{size:1}):"0x",ro(n,{size:32}),typeof i=="bigint"?ro(i,{size:32}):"0x")}class U1 extends de{constructor({publicKey:e}){super(`Value \`${Wa(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class Ol extends de{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class k1 extends de{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class M1 extends de{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let F1=class extends de{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${Br(Ga(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const L1=/^0x[a-fA-F0-9]{40}$/;function If(t,e={}){const{strict:r=!0}=e;if(!L1.test(t))throw new Al({address:t,cause:new z1});if(r){if(t.toLowerCase()===t)return;if(Df(t)!==t)throw new Al({address:t,cause:new V1})}}function Df(t){if(no.has(t))return no.get(t);If(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=_f(D1(e),{as:"Bytes"}),n=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&n[s]&&(n[s]=n[s].toUpperCase()),(r[s>>1]&15)>=8&&n[s+1]&&(n[s+1]=n[s+1].toUpperCase());const i=`0x${n.join("")}`;return no.set(t,i),i}function j1(t,e={}){const{checksum:r=!1}=e;return If(t),r?Df(t):t}function q1(t,e={}){const r=_f(`0x${B1(t).slice(4)}`).substring(26);return j1(`0x${r}`,e)}class Al extends de{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class z1 extends de{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class V1 extends de{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const nt=BigInt(0),Ke=BigInt(1),Wr=BigInt(2),K1=BigInt(3),Of=BigInt(4),Af=BigInt(5),$f=BigInt(8);function Qe(t,e){const r=t%e;return r>=nt?r:e+r}function yt(t,e,r){let n=t;for(;e-- >nt;)n*=n,n%=r;return n}function Jo(t,e){if(t===nt)throw new Error("invert: expected non-zero number");if(e<=nt)throw new Error("invert: expected positive modulus, got "+e);let r=Qe(t,e),n=e,i=nt,s=Ke;for(;r!==nt;){const a=n/r,c=n%r,l=i-s*a;n=r,r=c,i=s,s=l}if(n!==Ke)throw new Error("invert: does not exist");return Qe(i,e)}function Tf(t,e){const r=(t.ORDER+Ke)/Of,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function H1(t,e){const r=(t.ORDER-Af)/$f,n=t.mul(e,Wr),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,Wr),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function W1(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Ke,r=0;for(;e%Wr===nt;)e/=Wr,r++;let n=Wr;const i=Ya(t);for(;$l(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Tf;let s=i.pow(n,e);const o=(e+Ke)/Wr;return function(c,l){if(c.is0(l))return l;if($l(c,l)!==1)throw new Error("Cannot find square root");let u=r,h=c.mul(c.ONE,s),f=c.pow(l,e),p=c.pow(l,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let d=1,g=c.sqr(f);for(;!c.eql(g,c.ONE);)if(d++,g=c.sqr(g),d===u)throw new Error("Cannot find square root");const w=Ke<<BigInt(u-d-1),m=c.pow(h,w);u=d,h=c.sqr(m),f=c.mul(f,h),p=c.mul(p,m)}return p}}function G1(t){return t%Of===K1?Tf:t%$f===Af?H1:W1(t)}const Y1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Z1(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Y1.reduce((n,i)=>(n[i]="function",n),e);return _s(t,r)}function J1(t,e,r){if(r<nt)throw new Error("invalid exponent, negatives unsupported");if(r===nt)return t.ONE;if(r===Ke)return e;let n=t.ONE,i=e;for(;r>nt;)r&Ke&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Ke;return n}function Pf(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function $l(t,e){const r=(t.ORDER-Ke)/Wr,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Cf(t,e){e!==void 0&&Kp(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Ya(t,e,r=!1,n={}){if(t<=nt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Cf(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:Es(i),ZERO:nt,ONE:Ke,create:c=>Qe(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return nt<=c&&c<t},is0:c=>c===nt,isOdd:c=>(c&Ke)===Ke,neg:c=>Qe(-c,t),eql:(c,l)=>c===l,sqr:c=>Qe(c*c,t),add:(c,l)=>Qe(c+l,t),sub:(c,l)=>Qe(c-l,t),mul:(c,l)=>Qe(c*l,t),pow:(c,l)=>J1(a,c,l),div:(c,l)=>Qe(c*Jo(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Jo(c,t),sqrt:n.sqrt||(c=>(o||(o=G1(t)),o(a,c))),toBytes:c=>r?wf(c,s):gi(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?yf(c):Qr(c)},invertBatch:c=>Pf(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function Nf(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Rf(t){const e=Nf(t);return e+Math.ceil(e/2)}function X1(t,e,r=!1){const n=t.length,i=Nf(e),s=Rf(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?yf(t):Qr(t),a=Qe(o,e-Ke)+Ke;return r?wf(a,i):gi(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Tl=BigInt(0),Xo=BigInt(1);function io(t,e){const r=e.negate();return t?r:e}function Bf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function so(t,e){Bf(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=Es(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function Pl(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=Xo);const l=e*n,u=l+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:l}}function Q1(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function ev(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const oo=new WeakMap,Uf=new WeakMap;function ao(t){return Uf.get(t)||1}function tv(t,e){return{constTimeNegate:io,hasPrecomputes(r){return ao(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Tl;)n&Xo&&(i=i.add(s)),s=s.double(),n>>=Xo;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=so(n,e),o=[];let a=r,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){let s=t.ZERO,o=t.BASE;const a=so(r,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:d}=Pl(i,c,a);i=l,h?o=o.add(io(p,n[d])):s=s.add(io(f,n[u]))}return{p:s,f:o}},wNAFUnsafe(r,n,i,s=t.ZERO){const o=so(r,e);for(let a=0;a<o.windows&&i!==Tl;a++){const{nextN:c,offset:l,isZero:u,isNeg:h}=Pl(i,a,o);if(i=c,!u){const f=n[l];s=s.add(h?f.negate():f)}}return s},getPrecomputes(r,n,i){let s=oo.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&oo.set(n,i(s))),s},wNAFCached(r,n,i){const s=ao(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=ao(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Bf(n,e),Uf.set(r,n),oo.delete(r)}}}function rv(t,e,r,n){Q1(r,t),ev(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=s1(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Es(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let g=0;g<s;g++){const w=n[g],m=Number(w>>BigInt(p)&l);u[m]=u[m].add(r[g])}let d=o;for(let g=u.length-1,w=o;g>0;g--)w=w.add(u[g]),d=d.add(w);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function kf(t){return Z1(t.Fp),_s(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Cf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Cl(t){t.lowS!==void 0&&ri("lowS",t.lowS),t.prehash!==void 0&&ri("prehash",t.prehash)}function nv(t){const e=kf(t);_s(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class iv extends Error{constructor(e=""){super(e)}}const nr={Err:iv,_tlv:{encode:(t,e)=>{const{Err:r}=nr;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=Pi(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Pi(i.length/2|128):"";return Pi(t)+s+i+e},decode(t,e){const{Err:r}=nr;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=nr;if(t<or)throw new e("integer: negative integers are not allowed");let r=Pi(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=nr;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Qr(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=nr,i=vt("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=nr,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}};function co(t,e){return ni(gi(t,e))}const or=BigInt(0),Oe=BigInt(1);BigInt(2);const lo=BigInt(3),sv=BigInt(4);function ov(t){const e=nv(t),{Fp:r}=e,n=Ya(e.n,e.nBitLength),i=e.toBytes||((y,E,I)=>{const O=E.toAffine();return rs(Uint8Array.from([4]),r.toBytes(O.x),r.toBytes(O.y))}),s=e.fromBytes||(y=>{const E=y.subarray(1),I=r.fromBytes(E.subarray(0,r.BYTES)),O=r.fromBytes(E.subarray(r.BYTES,2*r.BYTES));return{x:I,y:O}});function o(y){const{a:E,b:I}=e,O=r.sqr(y),N=r.mul(O,y);return r.add(r.add(N,r.mul(y,E)),I)}function a(y,E){const I=r.sqr(E),O=o(y);return r.eql(I,O)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,lo),sv),l=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,l)))throw new Error("bad curve params: a or b");function u(y){return Ha(y,Oe,e.n)}function h(y){const{allowedPrivateKeyLengths:E,nByteLength:I,wrapPrivateKey:O,n:N}=e;if(E&&typeof y!="bigint"){if(pi(y)&&(y=ni(y)),typeof y!="string"||!E.includes(y.length))throw new Error("invalid private key");y=y.padStart(I*2,"0")}let R;try{R=typeof y=="bigint"?y:Qr(vt("private key",y,I))}catch{throw new Error("invalid private key, expected hex or "+I+" bytes, got "+typeof y)}return O&&(R=Qe(R,N)),_n("private key",R,Oe,N),R}function f(y){if(!(y instanceof g))throw new Error("ProjectivePoint expected")}const p=_l((y,E)=>{const{px:I,py:O,pz:N}=y;if(r.eql(N,r.ONE))return{x:I,y:O};const R=y.is0();E==null&&(E=R?r.ONE:r.inv(N));const P=r.mul(I,E),M=r.mul(O,E),U=r.mul(N,E);if(R)return{x:r.ZERO,y:r.ZERO};if(!r.eql(U,r.ONE))throw new Error("invZ was invalid");return{x:P,y:M}}),d=_l(y=>{if(y.is0()){if(e.allowInfinityPoint&&!r.is0(y.py))return;throw new Error("bad point: ZERO")}const{x:E,y:I}=y.toAffine();if(!r.isValid(E)||!r.isValid(I))throw new Error("bad point: x or y not FE");if(!a(E,I))throw new Error("bad point: equation left != right");if(!y.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(E,I,O){if(E==null||!r.isValid(E))throw new Error("x required");if(I==null||!r.isValid(I)||r.is0(I))throw new Error("y required");if(O==null||!r.isValid(O))throw new Error("z required");this.px=E,this.py=I,this.pz=O,Object.freeze(this)}static fromAffine(E){const{x:I,y:O}=E||{};if(!E||!r.isValid(I)||!r.isValid(O))throw new Error("invalid affine point");if(E instanceof g)throw new Error("projective point not allowed");const N=R=>r.eql(R,r.ZERO);return N(I)&&N(O)?g.ZERO:new g(I,O,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(E){const I=Pf(r,E.map(O=>O.pz));return E.map((O,N)=>O.toAffine(I[N])).map(g.fromAffine)}static fromHex(E){const I=g.fromAffine(s(vt("pointHex",E)));return I.assertValidity(),I}static fromPrivateKey(E){return g.BASE.multiply(h(E))}static msm(E,I){return rv(g,n,E,I)}_setWindowSize(E){_.setWindowSize(this,E)}assertValidity(){d(this)}hasEvenY(){const{y:E}=this.toAffine();if(r.isOdd)return!r.isOdd(E);throw new Error("Field doesn't support isOdd")}equals(E){f(E);const{px:I,py:O,pz:N}=this,{px:R,py:P,pz:M}=E,U=r.eql(r.mul(I,M),r.mul(R,N)),C=r.eql(r.mul(O,M),r.mul(P,N));return U&&C}negate(){return new g(this.px,r.neg(this.py),this.pz)}double(){const{a:E,b:I}=e,O=r.mul(I,lo),{px:N,py:R,pz:P}=this;let M=r.ZERO,U=r.ZERO,C=r.ZERO,D=r.mul(N,N),T=r.mul(R,R),v=r.mul(P,P),b=r.mul(N,R);return b=r.add(b,b),C=r.mul(N,P),C=r.add(C,C),M=r.mul(E,C),U=r.mul(O,v),U=r.add(M,U),M=r.sub(T,U),U=r.add(T,U),U=r.mul(M,U),M=r.mul(b,M),C=r.mul(O,C),v=r.mul(E,v),b=r.sub(D,v),b=r.mul(E,b),b=r.add(b,C),C=r.add(D,D),D=r.add(C,D),D=r.add(D,v),D=r.mul(D,b),U=r.add(U,D),v=r.mul(R,P),v=r.add(v,v),D=r.mul(v,b),M=r.sub(M,D),C=r.mul(v,T),C=r.add(C,C),C=r.add(C,C),new g(M,U,C)}add(E){f(E);const{px:I,py:O,pz:N}=this,{px:R,py:P,pz:M}=E;let U=r.ZERO,C=r.ZERO,D=r.ZERO;const T=e.a,v=r.mul(e.b,lo);let b=r.mul(I,R),S=r.mul(O,P),$=r.mul(N,M),x=r.add(I,O),A=r.add(R,P);x=r.mul(x,A),A=r.add(b,S),x=r.sub(x,A),A=r.add(I,N);let B=r.add(R,M);return A=r.mul(A,B),B=r.add(b,$),A=r.sub(A,B),B=r.add(O,N),U=r.add(P,M),B=r.mul(B,U),U=r.add(S,$),B=r.sub(B,U),D=r.mul(T,A),U=r.mul(v,$),D=r.add(U,D),U=r.sub(S,D),D=r.add(S,D),C=r.mul(U,D),S=r.add(b,b),S=r.add(S,b),$=r.mul(T,$),A=r.mul(v,A),S=r.add(S,$),$=r.sub(b,$),$=r.mul(T,$),A=r.add(A,$),b=r.mul(S,A),C=r.add(C,b),b=r.mul(B,A),U=r.mul(x,U),U=r.sub(U,b),b=r.mul(x,S),D=r.mul(B,D),D=r.add(D,b),new g(U,C,D)}subtract(E){return this.add(E.negate())}is0(){return this.equals(g.ZERO)}wNAF(E){return _.wNAFCached(this,E,g.normalizeZ)}multiplyUnsafe(E){const{endo:I,n:O}=e;_n("scalar",E,or,O);const N=g.ZERO;if(E===or)return N;if(this.is0()||E===Oe)return this;if(!I||_.hasPrecomputes(this))return _.wNAFCachedUnsafe(this,E,g.normalizeZ);let{k1neg:R,k1:P,k2neg:M,k2:U}=I.splitScalar(E),C=N,D=N,T=this;for(;P>or||U>or;)P&Oe&&(C=C.add(T)),U&Oe&&(D=D.add(T)),T=T.double(),P>>=Oe,U>>=Oe;return R&&(C=C.negate()),M&&(D=D.negate()),D=new g(r.mul(D.px,I.beta),D.py,D.pz),C.add(D)}multiply(E){const{endo:I,n:O}=e;_n("scalar",E,Oe,O);let N,R;if(I){const{k1neg:P,k1:M,k2neg:U,k2:C}=I.splitScalar(E);let{p:D,f:T}=this.wNAF(M),{p:v,f:b}=this.wNAF(C);D=_.constTimeNegate(P,D),v=_.constTimeNegate(U,v),v=new g(r.mul(v.px,I.beta),v.py,v.pz),N=D.add(v),R=T.add(b)}else{const{p:P,f:M}=this.wNAF(E);N=P,R=M}return g.normalizeZ([N,R])[0]}multiplyAndAddUnsafe(E,I,O){const N=g.BASE,R=(M,U)=>U===or||U===Oe||!M.equals(N)?M.multiplyUnsafe(U):M.multiply(U),P=R(this,I).add(R(E,O));return P.is0()?void 0:P}toAffine(E){return p(this,E)}isTorsionFree(){const{h:E,isTorsionFree:I}=e;if(E===Oe)return!0;if(I)return I(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:E,clearCofactor:I}=e;return E===Oe?this:I?I(g,this):this.multiplyUnsafe(e.h)}toRawBytes(E=!0){return ri("isCompressed",E),this.assertValidity(),i(g,this,E)}toHex(E=!0){return ri("isCompressed",E),ni(this.toRawBytes(E))}}g.BASE=new g(e.Gx,e.Gy,r.ONE),g.ZERO=new g(r.ZERO,r.ONE,r.ZERO);const{endo:w,nBitLength:m}=e,_=tv(g,w?Math.ceil(m/2):m);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:u}}function av(t){const e=kf(t);return _s(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function cv(t){const e=av(t),{Fp:r,n,nByteLength:i,nBitLength:s}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(v){return Qe(v,n)}function l(v){return Jo(v,n)}const{ProjectivePoint:u,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:p}=ov({...e,toBytes(v,b,S){const $=b.toAffine(),x=r.toBytes($.x),A=rs;return ri("isCompressed",S),S?A(Uint8Array.from([b.hasEvenY()?2:3]),x):A(Uint8Array.from([4]),x,r.toBytes($.y))},fromBytes(v){const b=v.length,S=v[0],$=v.subarray(1);if(b===o&&(S===2||S===3)){const x=Qr($);if(!Ha(x,Oe,r.ORDER))throw new Error("Point is not on curve");const A=f(x);let B;try{B=r.sqrt(A)}catch(z){const q=z instanceof Error?": "+z.message:"";throw new Error("Point is not on curve"+q)}const k=(B&Oe)===Oe;return(S&1)===1!==k&&(B=r.neg(B)),{x,y:B}}else if(b===a&&S===4){const x=r.fromBytes($.subarray(0,r.BYTES)),A=r.fromBytes($.subarray(r.BYTES,2*r.BYTES));return{x,y:A}}else{const x=o,A=a;throw new Error("invalid Point, expected length of "+x+", or uncompressed "+A+", got "+b)}}});function d(v){const b=n>>Oe;return v>b}function g(v){return d(v)?c(-v):v}const w=(v,b,S)=>Qr(v.slice(b,S));class m{constructor(b,S,$){_n("r",b,Oe,n),_n("s",S,Oe,n),this.r=b,this.s=S,$!=null&&(this.recovery=$),Object.freeze(this)}static fromCompact(b){const S=i;return b=vt("compactSignature",b,S*2),new m(w(b,0,S),w(b,S,2*S))}static fromDER(b){const{r:S,s:$}=nr.toSig(vt("DER",b));return new m(S,$)}assertValidity(){}addRecoveryBit(b){return new m(this.r,this.s,b)}recoverPublicKey(b){const{r:S,s:$,recovery:x}=this,A=N(vt("msgHash",b));if(x==null||![0,1,2,3].includes(x))throw new Error("recovery id invalid");const B=x===2||x===3?S+e.n:S;if(B>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const k=(x&1)===0?"02":"03",K=u.fromHex(k+co(B,r.BYTES)),z=l(B),q=c(-A*z),H=c($*z),G=u.BASE.multiplyAndAddUnsafe(K,q,H);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return ts(this.toDERHex())}toDERHex(){return nr.hexFromSig(this)}toCompactRawBytes(){return ts(this.toCompactHex())}toCompactHex(){const b=i;return co(this.r,b)+co(this.s,b)}}const _={isValidPrivateKey(v){try{return h(v),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const v=Rf(e.n);return X1(e.randomBytes(v),e.n)},precompute(v=8,b=u.BASE){return b._setWindowSize(v),b.multiply(BigInt(3)),b}};function y(v,b=!0){return u.fromPrivateKey(v).toRawBytes(b)}function E(v){if(typeof v=="bigint")return!1;if(v instanceof u)return!0;const S=vt("key",v).length,$=r.BYTES,x=$+1,A=2*$+1;if(!(e.allowedPrivateKeyLengths||i===x))return S===x||S===A}function I(v,b,S=!0){if(E(v)===!0)throw new Error("first arg must be private key");if(E(b)===!1)throw new Error("second arg must be public key");return u.fromHex(b).multiply(h(v)).toRawBytes(S)}const O=e.bits2int||function(v){if(v.length>8192)throw new Error("input is too large");const b=Qr(v),S=v.length*8-s;return S>0?b>>BigInt(S):b},N=e.bits2int_modN||function(v){return c(O(v))},R=Es(s);function P(v){return _n("num < 2^"+s,v,or,R),gi(v,i)}function M(v,b,S=U){if(["recovered","canonical"].some(W=>W in S))throw new Error("sign() legacy options not supported");const{hash:$,randomBytes:x}=e;let{lowS:A,prehash:B,extraEntropy:k}=S;A==null&&(A=!0),v=vt("msgHash",v),Cl(S),B&&(v=vt("prehashed msgHash",$(v)));const K=N(v),z=h(b),q=[P(z),P(K)];if(k!=null&&k!==!1){const W=k===!0?x(r.BYTES):k;q.push(vt("extraEntropy",W))}const H=rs(...q),G=K;function X(W){const Q=O(W);if(!p(Q))return;const pe=l(Q),be=u.BASE.multiply(Q).toAffine(),xe=c(be.x);if(xe===or)return;const Ve=c(pe*c(G+xe*z));if(Ve===or)return;let Kt=(be.x===xe?0:2)|Number(be.y&Oe),dr=Ve;return A&&d(Ve)&&(dr=g(Ve),Kt^=1),new m(xe,dr,Kt)}return{seed:H,k2sig:X}}const U={lowS:e.lowS,prehash:!1},C={lowS:e.lowS,prehash:!1};function D(v,b,S=U){const{seed:$,k2sig:x}=M(v,b,S),A=e;return o1(A.hash.outputLen,A.nByteLength,A.hmac)($,x)}u.BASE._setWindowSize(8);function T(v,b,S,$=C){var Kt;const x=v;b=vt("msgHash",b),S=vt("publicKey",S);const{lowS:A,prehash:B,format:k}=$;if(Cl($),"strict"in $)throw new Error("options.strict was renamed to lowS");if(k!==void 0&&k!=="compact"&&k!=="der")throw new Error("format must be compact or der");const K=typeof x=="string"||pi(x),z=!K&&!k&&typeof x=="object"&&x!==null&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!K&&!z)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let q,H;try{if(z&&(q=new m(x.r,x.s)),K){try{k!=="compact"&&(q=m.fromDER(x))}catch(dr){if(!(dr instanceof nr.Err))throw dr}!q&&k!=="der"&&(q=m.fromCompact(x))}H=u.fromHex(S)}catch{return!1}if(!q||A&&q.hasHighS())return!1;B&&(b=e.hash(b));const{r:G,s:X}=q,W=N(b),Q=l(X),pe=c(W*Q),be=c(G*Q),xe=(Kt=u.BASE.multiplyAndAddUnsafe(H,pe,be))==null?void 0:Kt.toAffine();return xe?c(xe.x)===G:!1}return{CURVE:e,getPublicKey:y,getSharedSecret:I,sign:D,verify:T,ProjectivePoint:u,Signature:m,utils:_}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function lv(t){return{hash:t,hmac:(e,...r)=>cg(t,e,Wp(...r)),randomBytes:Hp}}function uv(t,e){const r=n=>cv({...t,...lv(n)});return{...r(e),create:r}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Mf=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Nl=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),hv=BigInt(0),fv=BigInt(1),Qo=BigInt(2),Rl=(t,e)=>(t+e/Qo)/e;function dv(t){const e=Mf,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,h=yt(u,r,e)*u%e,f=yt(h,r,e)*u%e,p=yt(f,Qo,e)*l%e,d=yt(p,i,e)*p%e,g=yt(d,s,e)*d%e,w=yt(g,a,e)*g%e,m=yt(w,c,e)*w%e,_=yt(m,a,e)*g%e,y=yt(_,r,e)*u%e,E=yt(y,o,e)*d%e,I=yt(E,n,e)*l%e,O=yt(I,Qo,e);if(!ea.eql(ea.sqr(O),t))throw new Error("Cannot find square root");return O}const ea=Ya(Mf,void 0,void 0,{sqrt:dv}),pv=uv({a:hv,b:BigInt(7),Fp:ea,n:Nl,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Nl,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-fv*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=Rl(s*t,e),c=Rl(-n*t,e);let l=Qe(t-a*r-c*i,e),u=Qe(-a*n-c*s,e);const h=l>o,f=u>o;if(h&&(l=e-l),f&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}}},lg);function gv(t){if(t.length!==130&&t.length!==132)throw new wv({signature:t});const e=BigInt(rr(t,0,32)),r=BigInt(rr(t,32,64)),n=(()=>{const i=+`0x${t.slice(130)}`;if(!Number.isNaN(i))try{return yv(i)}catch{throw new mv({value:i})}})();return typeof n>"u"?{r:e,s:r}:{r:e,s:r,yParity:n}}function yv(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new bv({value:t})}class wv extends de{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${Br(Ga(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class mv extends de{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class bv extends de{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function vv(t){return q1(Ev(t))}function Ev(t){const{payload:e,signature:r}=t,{r:n,s:i,yParity:s}=r,a=new pv.Signature(BigInt(n),BigInt(i)).addRecoveryBit(s).recoverPublicKey(Ga(e).substring(2));return N1(a)}function _v(t){const e=t.length;let r=0,n=0;for(;n<e;){let i=t.charCodeAt(n++);if((i&4294967168)===0){r++;continue}else if((i&4294965248)===0)r+=2;else{if(i>=55296&&i<=56319&&n<e){const s=t.charCodeAt(n);(s&64512)===56320&&(++n,i=((i&1023)<<10)+(s&1023)+65536)}(i&4294901760)===0?r+=3:r+=4}}return r}function xv(t,e,r){const n=t.length;let i=r,s=0;for(;s<n;){let o=t.charCodeAt(s++);if((o&4294967168)===0){e[i++]=o;continue}else if((o&4294965248)===0)e[i++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<n){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[i++]=o>>12&15|224,e[i++]=o>>6&63|128):(e[i++]=o>>18&7|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128)}e[i++]=o&63|128}}const Sv=new TextEncoder,Iv=50;function Dv(t,e,r){Sv.encodeInto(t,e.subarray(r))}function Ov(t,e,r){t.length>Iv?Dv(t,e,r):xv(t,e,r)}const Av=4096;function Ff(t,e,r){let n=e;const i=n+r,s=[];let o="";for(;n<i;){const a=t[n++];if((a&128)===0)s.push(a);else if((a&224)===192){const c=t[n++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[n++]&63,l=t[n++]&63;s.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[n++]&63,l=t[n++]&63,u=t[n++]&63;let h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=Av&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const $v=new TextDecoder,Tv=200;function Pv(t,e,r){const n=t.subarray(e,e+r);return $v.decode(n)}function Cv(t,e,r){return r>Tv?Pv(t,e,r):Ff(t,e,r)}class Ni{constructor(e,r){Z(this,"type");Z(this,"data");this.type=e,this.data=r}}class ht extends Error{constructor(e){super(e);const r=Object.create(ht.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:ht.name})}}const Un=4294967295;function Nv(t,e,r){const n=r/4294967296,i=r;t.setUint32(e,n),t.setUint32(e+4,i)}function Lf(t,e,r){const n=Math.floor(r/4294967296),i=r;t.setUint32(e,n),t.setUint32(e+4,i)}function jf(t,e){const r=t.getInt32(e),n=t.getUint32(e+4);return r*4294967296+n}function Rv(t,e){const r=t.getUint32(e),n=t.getUint32(e+4);return r*4294967296+n}const Bv=-1,Uv=4294967296-1,kv=17179869184-1;function Mv({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=kv)if(e===0&&t<=Uv){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,n=t&4294967295,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,e<<2|r&3),s.setUint32(4,n),i}else{const r=new Uint8Array(12),n=new DataView(r.buffer);return n.setUint32(0,e),Lf(n,4,t),r}}function Fv(t){const e=t.getTime(),r=Math.floor(e/1e3),n=(e-r*1e3)*1e6,i=Math.floor(n/1e9);return{sec:r+i,nsec:n-i*1e9}}function Lv(t){if(t instanceof Date){const e=Fv(t);return Mv(e)}else return null}function jv(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),n=e.getUint32(4),i=(r&3)*4294967296+n,s=r>>>2;return{sec:i,nsec:s}}case 12:{const r=jf(e,4),n=e.getUint32(0);return{sec:r,nsec:n}}default:throw new ht(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function qv(t){const e=jv(t);return new Date(e.sec*1e3+e.nsec/1e6)}const zv={type:Bv,encode:Lv,decode:qv},gs=class gs{constructor(){Z(this,"__brand");Z(this,"builtInEncoders",[]);Z(this,"builtInDecoders",[]);Z(this,"encoders",[]);Z(this,"decoders",[]);this.register(zv)}register({type:e,encode:r,decode:n}){if(e>=0)this.encoders[e]=r,this.decoders[e]=n;else{const i=-1-e;this.builtInEncoders[i]=r,this.builtInDecoders[i]=n}}tryToEncode(e,r){for(let n=0;n<this.builtInEncoders.length;n++){const i=this.builtInEncoders[n];if(i!=null){const s=i(e,r);if(s!=null){const o=-1-n;return new Ni(o,s)}}}for(let n=0;n<this.encoders.length;n++){const i=this.encoders[n];if(i!=null){const s=i(e,r);if(s!=null){const o=n;return new Ni(o,s)}}}return e instanceof Ni?e:null}decode(e,r,n){const i=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return i?i(e,r,n):new Ni(r,e)}};Z(gs,"defaultCodec",new gs);let is=gs;function Vv(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function ta(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Vv(t)?new Uint8Array(t):Uint8Array.from(t)}const Kv=100,Hv=2048;let Wv=class qf{constructor(e){Z(this,"extensionCodec");Z(this,"context");Z(this,"useBigInt64");Z(this,"maxDepth");Z(this,"initialBufferSize");Z(this,"sortKeys");Z(this,"forceFloat32");Z(this,"ignoreUndefined");Z(this,"forceIntegerToFloat");Z(this,"pos");Z(this,"view");Z(this,"bytes");Z(this,"entered",!1);this.extensionCodec=(e==null?void 0:e.extensionCodec)??is.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??Kv,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??Hv,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new qf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),n=new Uint8Array(r),i=new DataView(r);n.set(this.bytes),this.view=i,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const n=_v(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),Ov(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,r){const n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const n=ta(e);this.writeU8a(n)}encodeArray(e,r){const n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(const i of e)this.doEncode(i,r+1)}countWithoutUndefined(e,r){let n=0;for(const i of r)e[i]!==void 0&&n++;return n}encodeMap(e,r){const n=Object.keys(e);this.sortKeys&&n.sort();const i=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error(`Too large map object: ${i}`);for(const s of n){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const n=e.data(this.pos+6),i=n.length;if(i>=4294967296)throw new Error(`Too large extension object: ${i}`);this.writeU8(201),this.writeU32(i),this.writeI8(e.type),this.writeU8a(n);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),Nv(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Lf(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function Gv(t,e){return new Wv(e).encodeSharedRef(t)}function uo(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const Yv=16,Zv=16;class Jv{constructor(e=Yv,r=Zv){Z(this,"hit",0);Z(this,"miss",0);Z(this,"caches");Z(this,"maxKeyLength");Z(this,"maxLengthPerKey");this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,n){const i=this.caches[n-1];e:for(const s of i){const o=s.bytes;for(let a=0;a<n;a++)if(o[a]!==e[r+a])continue e;return s.str}return null}store(e,r){const n=this.caches[e.length-1],i={bytes:e,str:r};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=i:n.push(i)}decode(e,r,n){const i=this.find(e,r,n);if(i!=null)return this.hit++,i;this.miss++;const s=Ff(e,r,n),o=Uint8Array.prototype.slice.call(e,r,r+n);return this.store(o,s),s}}const ra="array",Gn="map_key",zf="map_value",Xv=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new ht("The type of key must be string or number but "+typeof t)};class Qv{constructor(){Z(this,"stack",[]);Z(this,"stackHeadPosition",-1)}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=ra,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=Gn,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===ra){const n=e;n.size=0,n.array=void 0,n.position=0,n.type=void 0}if(e.type===Gn||e.type===zf){const n=e;n.size=0,n.map=void 0,n.readCount=0,n.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const kn=-1,Za=new DataView(new ArrayBuffer(0)),eE=new Uint8Array(Za.buffer);try{Za.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Bl=new RangeError("Insufficient data"),tE=new Jv;let rE=class Vf{constructor(e){Z(this,"extensionCodec");Z(this,"context");Z(this,"useBigInt64");Z(this,"rawStrings");Z(this,"maxStrLength");Z(this,"maxBinLength");Z(this,"maxArrayLength");Z(this,"maxMapLength");Z(this,"maxExtLength");Z(this,"keyDecoder");Z(this,"mapKeyConverter");Z(this,"totalPos",0);Z(this,"pos",0);Z(this,"view",Za);Z(this,"bytes",eE);Z(this,"headByte",kn);Z(this,"stack",new Qv);Z(this,"entered",!1);this.extensionCodec=(e==null?void 0:e.extensionCodec)??is.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??Un,this.maxBinLength=(e==null?void 0:e.maxBinLength)??Un,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??Un,this.maxMapLength=(e==null?void 0:e.maxMapLength)??Un,this.maxExtLength=(e==null?void 0:e.maxExtLength)??Un,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:tE,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??Xv}clone(){return new Vf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=kn,this.stack.reset()}setBuffer(e){const r=ta(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===kn&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),n=ta(e),i=new Uint8Array(r.length+n.length);i.set(r),i.set(n,r.length),this.setBuffer(i)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:n}=this;return new RangeError(`Extra ${r.byteLength-n} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,n;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{n=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}const{headByte:i,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${uo(i)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let n=r,i=-1;for await(const s of e){if(r&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),n&&(i=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--i!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const i=e-128;if(i!==0){this.pushMapState(i),this.complete();continue e}else r={}}else if(e<160){const i=e-144;if(i!==0){this.pushArrayState(i),this.complete();continue e}else r=[]}else{const i=e-160;r=this.decodeString(i,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const i=this.lookU8();r=this.decodeString(i,1)}else if(e===218){const i=this.lookU16();r=this.decodeString(i,2)}else if(e===219){const i=this.lookU32();r=this.decodeString(i,4)}else if(e===220){const i=this.readU16();if(i!==0){this.pushArrayState(i),this.complete();continue e}else r=[]}else if(e===221){const i=this.readU32();if(i!==0){this.pushArrayState(i),this.complete();continue e}else r=[]}else if(e===222){const i=this.readU16();if(i!==0){this.pushMapState(i),this.complete();continue e}else r={}}else if(e===223){const i=this.readU32();if(i!==0){this.pushMapState(i),this.complete();continue e}else r={}}else if(e===196){const i=this.lookU8();r=this.decodeBinary(i,1)}else if(e===197){const i=this.lookU16();r=this.decodeBinary(i,2)}else if(e===198){const i=this.lookU32();r=this.decodeBinary(i,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const i=this.lookU8();r=this.decodeExtension(i,1)}else if(e===200){const i=this.lookU16();r=this.decodeExtension(i,2)}else if(e===201){const i=this.lookU32();r=this.decodeExtension(i,4)}else throw new ht(`Unrecognized type byte: ${uo(e)}`);this.complete();const n=this.stack;for(;n.length>0;){const i=n.top();if(i.type===ra)if(i.array[i.position]=r,i.position++,i.position===i.size)r=i.array,n.release(i);else continue e;else if(i.type===Gn){if(r==="__proto__")throw new ht("The key __proto__ is not allowed");i.key=this.mapKeyConverter(r),i.type=zf;continue e}else if(i.map[i.key]=r,i.readCount++,i.readCount===i.size)r=i.map,n.release(i);else{i.key=null,i.type=Gn;continue e}}return r}}readHeadByte(){return this.headByte===kn&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=kn}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new ht(`Unrecognized array type byte: ${uo(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new ht(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new ht(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){var s;if(e>this.maxStrLength)throw new ht(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw Bl;const n=this.pos+r;let i;return this.stateIsMapKey()&&((s=this.keyDecoder)!=null&&s.canBeCached(e))?i=this.keyDecoder.decode(this.bytes,n,e):i=Cv(this.bytes,n,e),this.pos+=r+e,i}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Gn:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new ht(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw Bl;const n=this.pos+r,i=this.bytes.subarray(n,n+e);return this.pos+=r+e,i}decodeExtension(e,r){if(e>this.maxExtLength)throw new ht(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const n=this.view.getInt8(this.pos+r),i=this.decodeBinary(e,r+1);return this.extensionCodec.decode(i,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=Rv(this.view,this.pos);return this.pos+=8,e}readI64(){const e=jf(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function nE(t,e){return new rE(e).decode(t)}function Ja(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Kf(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ja(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Yn(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=Kf(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return Ja(r)}function iE(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,w=0,m=0,_=d.length;m!==_&&d[m]===0;)m++,g++;for(var y=(_-m)*u+1>>>0,E=new Uint8Array(y);m!==_;){for(var I=d[m],O=0,N=y-1;(I!==0||O<w)&&N!==-1;N--,O++)I+=256*E[N]>>>0,E[N]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");w=O,m++}for(var R=y-w;R!==y&&E[R]===0;)R++;for(var P=c.repeat(g);R<y;++R)P+=t.charAt(E[R]);return P}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var w=0,m=0;d[g]===c;)w++,g++;for(var _=(d.length-g)*l+1>>>0,y=new Uint8Array(_);d[g];){var E=r[d.charCodeAt(g)];if(E===255)return;for(var I=0,O=_-1;(E!==0||I<m)&&O!==-1;O--,I++)E+=a*y[O]>>>0,y[O]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=I,g++}if(d[g]!==" "){for(var N=_-m;N!==_&&y[N]===0;)N++;for(var R=new Uint8Array(w+(_-N)),P=w;N!==_;)R[P++]=y[N++];return R}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var sE=iE,oE=sE;const aE=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},cE=t=>new TextEncoder().encode(t),lE=t=>new TextDecoder().decode(t);class uE{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class hE{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Hf(this,e)}}class fE{constructor(e){this.decoders=e}or(e){return Hf(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Hf=(t,e)=>new fE({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class dE{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new uE(e,r,n),this.decoder=new hE(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const xs=({name:t,prefix:e,encode:r,decode:n})=>new dE(t,e,r,n),yi=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=oE(r,e);return xs({prefix:t,name:e,encode:n,decode:s=>aE(i(s))})},pE=(t,e,r,n)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=i[t[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},gE=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},Ue=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>xs({prefix:e,name:t,encode(i){return gE(i,n,r)},decode(i){return pE(i,n,r,t)}}),yE=xs({prefix:"\0",name:"identity",encode:t=>lE(t),decode:t=>cE(t)}),wE=Object.freeze(Object.defineProperty({__proto__:null,identity:yE},Symbol.toStringTag,{value:"Module"})),mE=Ue({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),bE=Object.freeze(Object.defineProperty({__proto__:null,base2:mE},Symbol.toStringTag,{value:"Module"})),vE=Ue({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),EE=Object.freeze(Object.defineProperty({__proto__:null,base8:vE},Symbol.toStringTag,{value:"Module"})),_E=yi({prefix:"9",name:"base10",alphabet:"0123456789"}),xE=Object.freeze(Object.defineProperty({__proto__:null,base10:_E},Symbol.toStringTag,{value:"Module"})),SE=Ue({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),IE=Ue({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),DE=Object.freeze(Object.defineProperty({__proto__:null,base16:SE,base16upper:IE},Symbol.toStringTag,{value:"Module"})),OE=Ue({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),AE=Ue({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$E=Ue({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),TE=Ue({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),PE=Ue({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),CE=Ue({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),NE=Ue({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),RE=Ue({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),BE=Ue({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),UE=Object.freeze(Object.defineProperty({__proto__:null,base32:OE,base32hex:PE,base32hexpad:NE,base32hexpadupper:RE,base32hexupper:CE,base32pad:$E,base32padupper:TE,base32upper:AE,base32z:BE},Symbol.toStringTag,{value:"Module"})),kE=yi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ME=yi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),FE=Object.freeze(Object.defineProperty({__proto__:null,base36:kE,base36upper:ME},Symbol.toStringTag,{value:"Module"})),LE=yi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),jE=yi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),qE=Object.freeze(Object.defineProperty({__proto__:null,base58btc:LE,base58flickr:jE},Symbol.toStringTag,{value:"Module"})),zE=Ue({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),VE=Ue({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),KE=Ue({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),HE=Ue({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),WE=Object.freeze(Object.defineProperty({__proto__:null,base64:zE,base64pad:VE,base64url:KE,base64urlpad:HE},Symbol.toStringTag,{value:"Module"})),Wf=Array.from(""),GE=Wf.reduce((t,e,r)=>(t[r]=e,t),[]),YE=Wf.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function ZE(t){return t.reduce((e,r)=>(e+=GE[r],e),"")}function JE(t){const e=[];for(const r of t){const n=YE[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const XE=xs({prefix:"",name:"base256emoji",encode:ZE,decode:JE}),QE=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:XE},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Ul={...wE,...bE,...EE,...xE,...DE,...UE,...FE,...qE,...WE,...QE};function Gf(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const kl=Gf("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ho=Gf("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Kf(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Yf={utf8:kl,"utf-8":kl,hex:Ul.base16,latin1:ho,ascii:ho,binary:ho,...Ul};function xt(t,e="utf8"){const r=Yf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ja(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function st(t,e="utf8"){const r=Yf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const e2={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var fo,Ml;function Zf(){if(Ml)return fo;Ml=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function r(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function n(o){return(4294967296+o).toString(16).substring(1)}function i(o,a,c){let l=`
`+o+" = ";for(let u=0;u<a.length;u+=2){if(c===32)l+=n(a[u]).toUpperCase(),l+=" ",l+=n(a[u+1]).toUpperCase();else if(c===64)l+=n(a[u+1]).toUpperCase(),l+=n(a[u]).toUpperCase();else throw new Error("Invalid size "+c);u%6===4?l+=`
`+new Array(o.length+4).join(" "):u<a.length-2&&(l+=" ")}console.log(l)}function s(o,a,c){let l=new Date().getTime();const u=new Uint8Array(a);for(let f=0;f<a;f++)u[f]=f%256;const h=new Date().getTime();console.log("Generated random input in "+(h-l)+"ms"),l=h;for(let f=0;f<c;f++){const p=o(u),d=new Date().getTime(),g=d-l;l=d,console.log("Hashed in "+g+"ms: "+p.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(g/1e3)*100)/100+" MB PER SECOND")}}return fo={normalizeInput:e,toHex:r,debugPrint:i,testSpeed:s},fo}var po,Fl;function t2(){if(Fl)return po;Fl=1;const t=Zf();function e(m,_,y){const E=m[_]+m[y];let I=m[_+1]+m[y+1];E>=4294967296&&I++,m[_]=E,m[_+1]=I}function r(m,_,y,E){let I=m[_]+y;y<0&&(I+=4294967296);let O=m[_+1]+E;I>=4294967296&&O++,m[_]=I,m[_+1]=O}function n(m,_){return m[_]^m[_+1]<<8^m[_+2]<<16^m[_+3]<<24}function i(m,_,y,E,I,O){const N=l[I],R=l[I+1],P=l[O],M=l[O+1];e(c,m,_),r(c,m,N,R);let U=c[E]^c[m],C=c[E+1]^c[m+1];c[E]=C,c[E+1]=U,e(c,y,E),U=c[_]^c[y],C=c[_+1]^c[y+1],c[_]=U>>>24^C<<8,c[_+1]=C>>>24^U<<8,e(c,m,_),r(c,m,P,M),U=c[E]^c[m],C=c[E+1]^c[m+1],c[E]=U>>>16^C<<16,c[E+1]=C>>>16^U<<16,e(c,y,E),U=c[_]^c[y],C=c[_+1]^c[y+1],c[_]=C>>>31^U<<1,c[_+1]=U>>>31^C<<1}const s=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(m){return m*2})),c=new Uint32Array(32),l=new Uint32Array(32);function u(m,_){let y=0;for(y=0;y<16;y++)c[y]=m.h[y],c[y+16]=s[y];for(c[24]=c[24]^m.t,c[25]=c[25]^m.t/4294967296,_&&(c[28]=~c[28],c[29]=~c[29]),y=0;y<32;y++)l[y]=n(m.b,4*y);for(y=0;y<12;y++)i(0,8,16,24,a[y*16+0],a[y*16+1]),i(2,10,18,26,a[y*16+2],a[y*16+3]),i(4,12,20,28,a[y*16+4],a[y*16+5]),i(6,14,22,30,a[y*16+6],a[y*16+7]),i(0,10,20,30,a[y*16+8],a[y*16+9]),i(2,12,22,24,a[y*16+10],a[y*16+11]),i(4,14,16,26,a[y*16+12],a[y*16+13]),i(6,8,18,28,a[y*16+14],a[y*16+15]);for(y=0;y<16;y++)m.h[y]=m.h[y]^c[y]^c[y+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function f(m,_,y,E){if(m===0||m>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(_&&_.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(y&&y.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(E&&E.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const I={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:m};h.fill(0),h[0]=m,_&&(h[1]=_.length),h[2]=1,h[3]=1,y&&h.set(y,32),E&&h.set(E,48);for(let O=0;O<16;O++)I.h[O]=s[O]^n(h,O*4);return _&&(p(I,_),I.c=128),I}function p(m,_){for(let y=0;y<_.length;y++)m.c===128&&(m.t+=m.c,u(m,!1),m.c=0),m.b[m.c++]=_[y]}function d(m){for(m.t+=m.c;m.c<128;)m.b[m.c++]=0;u(m,!0);const _=new Uint8Array(m.outlen);for(let y=0;y<m.outlen;y++)_[y]=m.h[y>>2]>>8*(y&3);return _}function g(m,_,y,E,I){y=y||64,m=t.normalizeInput(m),E&&(E=t.normalizeInput(E)),I&&(I=t.normalizeInput(I));const O=f(y,_,E,I);return p(O,m),d(O)}function w(m,_,y,E,I){const O=g(m,_,y,E,I);return t.toHex(O)}return po={blake2b:g,blake2bHex:w,blake2bInit:f,blake2bUpdate:p,blake2bFinal:d},po}var go,Ll;function r2(){if(Ll)return go;Ll=1;const t=Zf();function e(d,g){return d[g]^d[g+1]<<8^d[g+2]<<16^d[g+3]<<24}function r(d,g,w,m,_,y){o[d]=o[d]+o[g]+_,o[m]=n(o[m]^o[d],16),o[w]=o[w]+o[m],o[g]=n(o[g]^o[w],12),o[d]=o[d]+o[g]+y,o[m]=n(o[m]^o[d],8),o[w]=o[w]+o[m],o[g]=n(o[g]^o[w],7)}function n(d,g){return d>>>g^d<<32-g}const i=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),s=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(d,g){let w=0;for(w=0;w<8;w++)o[w]=d.h[w],o[w+8]=i[w];for(o[12]^=d.t,o[13]^=d.t/4294967296,g&&(o[14]=~o[14]),w=0;w<16;w++)a[w]=e(d.b,4*w);for(w=0;w<10;w++)r(0,4,8,12,a[s[w*16+0]],a[s[w*16+1]]),r(1,5,9,13,a[s[w*16+2]],a[s[w*16+3]]),r(2,6,10,14,a[s[w*16+4]],a[s[w*16+5]]),r(3,7,11,15,a[s[w*16+6]],a[s[w*16+7]]),r(0,5,10,15,a[s[w*16+8]],a[s[w*16+9]]),r(1,6,11,12,a[s[w*16+10]],a[s[w*16+11]]),r(2,7,8,13,a[s[w*16+12]],a[s[w*16+13]]),r(3,4,9,14,a[s[w*16+14]],a[s[w*16+15]]);for(w=0;w<8;w++)d.h[w]^=o[w]^o[w+8]}function l(d,g){if(!(d>0&&d<=32))throw new Error("Incorrect output length, should be in [1, 32]");const w=g?g.length:0;if(g&&!(w>0&&w<=32))throw new Error("Incorrect key length, should be in [1, 32]");const m={h:new Uint32Array(i),b:new Uint8Array(64),c:0,t:0,outlen:d};return m.h[0]^=16842752^w<<8^d,w>0&&(u(m,g),m.c=64),m}function u(d,g){for(let w=0;w<g.length;w++)d.c===64&&(d.t+=d.c,c(d,!1),d.c=0),d.b[d.c++]=g[w]}function h(d){for(d.t+=d.c;d.c<64;)d.b[d.c++]=0;c(d,!0);const g=new Uint8Array(d.outlen);for(let w=0;w<d.outlen;w++)g[w]=d.h[w>>2]>>8*(w&3)&255;return g}function f(d,g,w){w=w||32,d=t.normalizeInput(d);const m=l(w,g);return u(m,d),h(m)}function p(d,g,w){const m=f(d,g,w);return t.toHex(m)}return go={blake2s:f,blake2sHex:p,blake2sInit:l,blake2sUpdate:u,blake2sFinal:h},go}var yo,jl;function n2(){if(jl)return yo;jl=1;const t=t2(),e=r2();return yo={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},yo}var i2=n2(),s2={};const Jf=":";function zi(t){const[e,r]=t.split(Jf);return{namespace:e,reference:r}}function Xf(t){const[e,r,n]=t.split(Jf);return{namespace:e,reference:r,address:n}}function Qf(t,e=[]){const r=[];return Object.keys(t).forEach(n=>{if(e.length&&!e.includes(n))return;const i=t[n];r.push(...i.accounts)}),r}function ed(t,e){return t.includes(":")?[t]:e.chains||[]}var o2=Object.defineProperty,a2=Object.defineProperties,c2=Object.getOwnPropertyDescriptors,ql=Object.getOwnPropertySymbols,l2=Object.prototype.hasOwnProperty,u2=Object.prototype.propertyIsEnumerable,na=(t,e,r)=>e in t?o2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zl=(t,e)=>{for(var r in e||(e={}))l2.call(e,r)&&na(t,r,e[r]);if(ql)for(var r of ql(e))u2.call(e,r)&&na(t,r,e[r]);return t},h2=(t,e)=>a2(t,c2(e)),Vl=(t,e,r)=>na(t,typeof e!="symbol"?e+"":e,r);const f2="ReactNative",dt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},d2="js";function ss(){return typeof St<"u"&&typeof St.versions<"u"&&typeof St.versions.node<"u"}function kr(){return!hr.getDocument()&&!!hr.getNavigator()&&navigator.product===f2}function p2(){return kr()&&typeof Y<"u"&&typeof(Y==null?void 0:Y.Platform)<"u"&&(Y==null?void 0:Y.Platform.OS)==="android"}function g2(){return kr()&&typeof Y<"u"&&typeof(Y==null?void 0:Y.Platform)<"u"&&(Y==null?void 0:Y.Platform.OS)==="ios"}function Tn(){return!ss()&&!!hr.getNavigator()&&!!hr.getDocument()}function wi(){return kr()?dt.reactNative:ss()?dt.node:Tn()?dt.browser:dt.unknown}function Kl(){var t;try{return kr()&&typeof Y<"u"&&typeof(Y==null?void 0:Y.Application)<"u"?(t=Y.Application)==null?void 0:t.applicationId:void 0}catch{return}}function y2(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([n],[i])=>n.localeCompare(i)).forEach(([n,i])=>{i!=null&&r.set(n,String(i))}),r.toString()}function w2(t){var e,r;const n=td();try{return t!=null&&t.url&&n.url&&new URL(t.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),t.url=n.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),h2(zl(zl({},n),t),{url:(t==null?void 0:t.url)||n.url,name:(t==null?void 0:t.name)||n.name,description:(t==null?void 0:t.description)||n.description,icons:(r=t==null?void 0:t.icons)!=null&&r.length&&t.icons.length>0?t.icons:n.icons})}catch(i){return console.warn("Error populating app metadata",i),t||n}}function td(){return t1.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function m2(){if(wi()===dt.reactNative&&typeof Y<"u"&&typeof(Y==null?void 0:Y.Platform)<"u"){const{OS:r,Version:n}=Y.Platform;return[r,n].join("-")}const t=Gb();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function b2(){var t;const e=wi();return e===dt.browser?[e,((t=hr.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function rd(t,e,r){const n=m2(),i=b2();return[[t,e].join("-"),[d2,r].join("-"),n,i].join("/")}function v2({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=r.split("?"),u=rd(t,e,n),h={auth:i,ua:u,projectId:s,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=y2(l[1]||"",h);return l[0]+"?"+f}function Gr(t,e){return t.filter(r=>e.includes(r)).length===t.length}function ia(t){return Object.fromEntries(t.entries())}function sa(t){return new Map(Object.entries(t))}function Vr(t=L.FIVE_MINUTES,e){const r=L.toMiliseconds(t||L.FIVE_MINUTES);let n,i,s,o;return{resolve:a=>{s&&n&&(clearTimeout(s),n(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},r),n=a,i=c})}}function qt(t,e,r){return new Promise(async(n,i)=>{const s=setTimeout(()=>i(new Error(r)),e);try{const o=await t;n(o)}catch(o){i(o)}clearTimeout(s)})}function nd(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function E2(t){return nd("topic",t)}function _2(t){return nd("id",t)}function id(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function Ee(t,e){return L.fromMiliseconds(Date.now()+L.toMiliseconds(t))}function xr(t){return Date.now()>=L.toMiliseconds(t)}function ae(t,e){return`${t}${e?`:${e}`:""}`}function en(t=[],e=[]){return[...new Set([...t,...e])]}async function x2({id:t,topic:e,wcDeepLink:r}){var n;try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r,s=i==null?void 0:i.href;if(typeof s!="string")return;const o=S2(s,t,e),a=wi();if(a===dt.browser){if(!((n=hr.getDocument())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}I2(o)}else a===dt.reactNative&&typeof(Y==null?void 0:Y.Linking)<"u"&&await Y.Linking.openURL(o)}catch(i){console.error(i)}}function S2(t,e,r){const n=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${s}${$2(n,!0)}`}else i=`${i}/wc?${n}`;return i}function I2(t){let e="_self";A2()?e="_top":(O2()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function D2(t,e){let r="";try{if(Tn()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(n){console.error(n)}return r}function Hl(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),n=r.indexOf(e);return r[n+2]}function Wl(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Xa(){return typeof St<"u"&&s2.IS_VITEST==="true"}function O2(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function A2(){try{return window.self!==window.top}catch{return!1}}function $2(t,e=!1){const r=ie.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function sd(t){return ie.from(t,"base64").toString("utf-8")}function T2(t){return new Promise(e=>setTimeout(e,t))}let P2=class{constructor({limit:e}){Vl(this,"limit"),Vl(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const Ri=BigInt(2**32-1),Gl=BigInt(32);function od(t,e=!1){return e?{h:Number(t&Ri),l:Number(t>>Gl&Ri)}:{h:Number(t>>Gl&Ri)|0,l:Number(t&Ri)|0}}function ad(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=od(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const Yl=(t,e,r)=>t>>>r,Zl=(t,e,r)=>t<<32-r|e>>>r,Sr=(t,e,r)=>t>>>r|e<<32-r,Ir=(t,e,r)=>t<<32-r|e>>>r,Kn=(t,e,r)=>t<<64-r|e>>>r-32,Hn=(t,e,r)=>t>>>r-32|e<<64-r,C2=(t,e)=>e,N2=(t,e)=>t,R2=(t,e,r)=>t<<r|e>>>32-r,B2=(t,e,r)=>e<<r|t>>>32-r,U2=(t,e,r)=>e<<r-32|t>>>64-r,k2=(t,e,r)=>t<<r-32|e>>>64-r;function Tt(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const Qa=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),ec=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,M2=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),F2=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,L2=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),j2=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,dn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ss(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function fr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Nt(t,...e){if(!Ss(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Is(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");fr(t.outputLen),fr(t.blockLen)}function Ur(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function tc(t,e){Nt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function ii(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function It(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function wo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Bt(t,e){return t<<32-e|t>>>e}const cd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ld(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const er=cd?t=>t:t=>ld(t);function q2(t){for(let e=0;e<t.length;e++)t[e]=ld(t[e]);return t}const Dr=cd?t=>t:q2,ud=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",z2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function xn(t){if(Nt(t),ud)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=z2[t[r]];return e}const Jt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Jl(t){if(t>=Jt._0&&t<=Jt._9)return t-Jt._0;if(t>=Jt.A&&t<=Jt.F)return t-(Jt.A-10);if(t>=Jt.a&&t<=Jt.f)return t-(Jt.a-10)}function os(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(ud)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Jl(t.charCodeAt(s)),a=Jl(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function hd(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Ct(t){return typeof t=="string"&&(t=hd(t)),Nt(t),t}function Ar(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Nt(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}let Ds=class{};function mi(t){const e=n=>t().update(Ct(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function V2(t){const e=(n,i)=>t(i).update(Ct(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function cn(t=32){if(dn&&typeof dn.getRandomValues=="function")return dn.getRandomValues(new Uint8Array(t));if(dn&&typeof dn.randomBytes=="function")return Uint8Array.from(dn.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const K2=BigInt(0),Mn=BigInt(1),H2=BigInt(2),W2=BigInt(7),G2=BigInt(256),Y2=BigInt(113),fd=[],dd=[],pd=[];for(let t=0,e=Mn,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],fd.push(2*(5*n+r)),dd.push((t+1)*(t+2)/2%64);let i=K2;for(let s=0;s<7;s++)e=(e<<Mn^(e>>W2)*Y2)%G2,e&H2&&(i^=Mn<<(Mn<<BigInt(s))-Mn);pd.push(i)}const gd=ad(pd,!0),Z2=gd[0],J2=gd[1],Xl=(t,e,r)=>r>32?U2(t,e,r):R2(t,e,r),Ql=(t,e,r)=>r>32?k2(t,e,r):B2(t,e,r);function X2(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=Xl(l,u,1)^r[a],f=Ql(l,u,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=dd[o],c=Xl(i,s,a),l=Ql(i,s,a),u=fd[o];i=t[u],s=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=Z2[n],t[1]^=J2[n]}It(r)}let Q2=class yd extends Ds{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,fr(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=ii(this.state)}clone(){return this._cloneInto()}keccak(){Dr(this.state32),X2(this.state32,this.rounds),Dr(this.state32),this.posOut=0,this.pos=0}update(e){Ur(this),e=Ct(e),Nt(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Ur(this,!1),Nt(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return fr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(tc(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,It(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new yd(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const e_=(t,e,r)=>mi(()=>new Q2(e,t,r)),t_=e_(1,136,256/8);function r_(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,l=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+l,a,n)}function n_(t,e,r){return t&e^~t&r}function i_(t,e,r){return t&e^t&r^e&r}let wd=class extends Ds{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=wo(this.buffer)}update(e){Ur(this),e=Ct(e),Nt(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=wo(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ur(this),tc(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,It(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;r_(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=wo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const wr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Fe=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Le=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),s_=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),mr=new Uint32Array(64);class o_ extends wd{constructor(e=32){super(64,e,8,!1),this.A=wr[0]|0,this.B=wr[1]|0,this.C=wr[2]|0,this.D=wr[3]|0,this.E=wr[4]|0,this.F=wr[5]|0,this.G=wr[6]|0,this.H=wr[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)mr[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=mr[h-15],p=mr[h-2],d=Bt(f,7)^Bt(f,18)^f>>>3,g=Bt(p,17)^Bt(p,19)^p>>>10;mr[h]=g+mr[h-7]+d+mr[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=Bt(a,6)^Bt(a,11)^Bt(a,25),p=u+f+n_(a,c,l)+s_[h]+mr[h]|0,d=(Bt(n,2)^Bt(n,13)^Bt(n,22))+i_(n,i,s)|0;u=l,l=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+d|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,i,s,o,a,c,l,u)}roundClean(){It(mr)}destroy(){this.set(0,0,0,0,0,0,0,0),It(this.buffer)}}const md=ad(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),a_=md[0],c_=md[1],br=new Uint32Array(80),vr=new Uint32Array(80);let rc=class extends wd{constructor(e=64){super(128,e,16,!1),this.Ah=Le[0]|0,this.Al=Le[1]|0,this.Bh=Le[2]|0,this.Bl=Le[3]|0,this.Ch=Le[4]|0,this.Cl=Le[5]|0,this.Dh=Le[6]|0,this.Dl=Le[7]|0,this.Eh=Le[8]|0,this.El=Le[9]|0,this.Fh=Le[10]|0,this.Fl=Le[11]|0,this.Gh=Le[12]|0,this.Gl=Le[13]|0,this.Hh=Le[14]|0,this.Hl=Le[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:p,Gl:d,Hh:g,Hl:w}=this;return[e,r,n,i,s,o,a,c,l,u,h,f,p,d,g,w]}set(e,r,n,i,s,o,a,c,l,u,h,f,p,d,g,w){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=w|0}process(e,r){for(let y=0;y<16;y++,r+=4)br[y]=e.getUint32(r),vr[y]=e.getUint32(r+=4);for(let y=16;y<80;y++){const E=br[y-15]|0,I=vr[y-15]|0,O=Sr(E,I,1)^Sr(E,I,8)^Yl(E,I,7),N=Ir(E,I,1)^Ir(E,I,8)^Zl(E,I,7),R=br[y-2]|0,P=vr[y-2]|0,M=Sr(R,P,19)^Kn(R,P,61)^Yl(R,P,6),U=Ir(R,P,19)^Hn(R,P,61)^Zl(R,P,6),C=M2(N,U,vr[y-7],vr[y-16]),D=F2(C,O,M,br[y-7],br[y-16]);br[y]=D|0,vr[y]=C|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:p,Fl:d,Gh:g,Gl:w,Hh:m,Hl:_}=this;for(let y=0;y<80;y++){const E=Sr(h,f,14)^Sr(h,f,18)^Kn(h,f,41),I=Ir(h,f,14)^Ir(h,f,18)^Hn(h,f,41),O=h&p^~h&g,N=f&d^~f&w,R=L2(_,I,N,c_[y],vr[y]),P=j2(R,m,E,O,a_[y],br[y]),M=R|0,U=Sr(n,i,28)^Kn(n,i,34)^Kn(n,i,39),C=Ir(n,i,28)^Hn(n,i,34)^Hn(n,i,39),D=n&s^n&a^s&a,T=i&o^i&c^o&c;m=g|0,_=w|0,g=p|0,w=d|0,p=h|0,d=f|0,{h,l:f}=Tt(l|0,u|0,P|0,M|0),l=a|0,u=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const v=Qa(M,C,T);n=ec(v,P,U,D),i=v|0}({h:n,l:i}=Tt(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Tt(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Tt(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Tt(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=Tt(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=Tt(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:w}=Tt(this.Gh|0,this.Gl|0,g|0,w|0),{h:m,l:_}=Tt(this.Hh|0,this.Hl|0,m|0,_|0),this.set(n,i,s,o,a,c,l,u,h,f,p,d,g,w,m,_)}roundClean(){It(br,vr)}destroy(){It(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class l_ extends rc{constructor(){super(48),this.Ah=Fe[0]|0,this.Al=Fe[1]|0,this.Bh=Fe[2]|0,this.Bl=Fe[3]|0,this.Ch=Fe[4]|0,this.Cl=Fe[5]|0,this.Dh=Fe[6]|0,this.Dl=Fe[7]|0,this.Eh=Fe[8]|0,this.El=Fe[9]|0,this.Fh=Fe[10]|0,this.Fl=Fe[11]|0,this.Gh=Fe[12]|0,this.Gl=Fe[13]|0,this.Hh=Fe[14]|0,this.Hl=Fe[15]|0}}const je=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class u_ extends rc{constructor(){super(32),this.Ah=je[0]|0,this.Al=je[1]|0,this.Bh=je[2]|0,this.Bl=je[3]|0,this.Ch=je[4]|0,this.Cl=je[5]|0,this.Dh=je[6]|0,this.Dl=je[7]|0,this.Eh=je[8]|0,this.El=je[9]|0,this.Fh=je[10]|0,this.Fl=je[11]|0,this.Gh=je[12]|0,this.Gl=je[13]|0,this.Hh=je[14]|0,this.Hl=je[15]|0}}const Os=mi(()=>new o_),h_=mi(()=>new rc),f_=mi(()=>new l_),d_=mi(()=>new u_),p_=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),ve=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),V=new Uint32Array(32);function Er(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=V[2*t],l=V[2*t+1],u=V[2*e],h=V[2*e+1],f=V[2*r],p=V[2*r+1],d=V[2*n],g=V[2*n+1],w=Qa(c,u,o);l=ec(w,l,h,a),c=w|0,{Dh:g,Dl:d}={Dh:g^l,Dl:d^c},{Dh:g,Dl:d}={Dh:C2(g,d),Dl:N2(g)},{h:p,l:f}=Tt(p,f,g,d),{Bh:h,Bl:u}={Bh:h^p,Bl:u^f},{Bh:h,Bl:u}={Bh:Sr(h,u,24),Bl:Ir(h,u,24)},V[2*t]=c,V[2*t+1]=l,V[2*e]=u,V[2*e+1]=h,V[2*r]=f,V[2*r+1]=p,V[2*n]=d,V[2*n+1]=g}function _r(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=V[2*t],l=V[2*t+1],u=V[2*e],h=V[2*e+1],f=V[2*r],p=V[2*r+1],d=V[2*n],g=V[2*n+1],w=Qa(c,u,o);l=ec(w,l,h,a),c=w|0,{Dh:g,Dl:d}={Dh:g^l,Dl:d^c},{Dh:g,Dl:d}={Dh:Sr(g,d,16),Dl:Ir(g,d,16)},{h:p,l:f}=Tt(p,f,g,d),{Bh:h,Bl:u}={Bh:h^p,Bl:u^f},{Bh:h,Bl:u}={Bh:Kn(h,u,63),Bl:Hn(h,u,63)},V[2*t]=c,V[2*t+1]=l,V[2*e]=u,V[2*e+1]=h,V[2*r]=f,V[2*r+1]=p,V[2*n]=d,V[2*n+1]=g}function g_(t,e={},r,n,i){if(fr(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class y_ extends Ds{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,fr(e),fr(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=ii(this.buffer)}update(e){Ur(this),e=Ct(e),Nt(e);const{blockLen:r,buffer:n,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(Dr(i),this.compress(i,0,!1),Dr(i),this.pos=0);const l=Math.min(r-this.pos,s-c),u=o+c;if(l===r&&!(u%4)&&c+l<s){const h=new Uint32Array(a,u,Math.floor((s-c)/4));Dr(h);for(let f=0;c+r<s;f+=i.length,c+=r)this.length+=r,this.compress(h,f,!1);Dr(h);continue}n.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Ur(this),tc(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,It(this.buffer.subarray(r)),Dr(n),this.compress(n,0,!0),Dr(n);const i=ii(e);this.get().forEach((s,o)=>i[o]=er(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=i,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class w_ extends y_{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=ve[0]|0,this.v0h=ve[1]|0,this.v1l=ve[2]|0,this.v1h=ve[3]|0,this.v2l=ve[4]|0,this.v2h=ve[5]|0,this.v3l=ve[6]|0,this.v3h=ve[7]|0,this.v4l=ve[8]|0,this.v4h=ve[9]|0,this.v5l=ve[10]|0,this.v5h=ve[11]|0,this.v6l=ve[12]|0,this.v6h=ve[13]|0,this.v7l=ve[14]|0,this.v7h=ve[15]|0,g_(r,e,64,16,16);let{key:n,personalization:i,salt:s}=e,o=0;if(n!==void 0&&(n=Ct(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Ct(s);const a=ii(s);this.v4l^=er(a[0]),this.v4h^=er(a[1]),this.v5l^=er(a[2]),this.v5h^=er(a[3])}if(i!==void 0){i=Ct(i);const a=ii(i);this.v6l^=er(a[0]),this.v6h^=er(a[1]),this.v7l^=er(a[2]),this.v7h^=er(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:f,v6l:p,v6h:d,v7l:g,v7h:w}=this;return[e,r,n,i,s,o,a,c,l,u,h,f,p,d,g,w]}set(e,r,n,i,s,o,a,c,l,u,h,f,p,d,g,w){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=f|0,this.v6l=p|0,this.v6h=d|0,this.v7l=g|0,this.v7h=w|0}compress(e,r,n){this.get().forEach((c,l)=>V[l]=c),V.set(ve,16);let{h:i,l:s}=od(BigInt(this.length));V[24]=ve[8]^s,V[25]=ve[9]^i,n&&(V[28]=~V[28],V[29]=~V[29]);let o=0;const a=p_;for(let c=0;c<12;c++)Er(0,4,8,12,e,r+2*a[o++]),_r(0,4,8,12,e,r+2*a[o++]),Er(1,5,9,13,e,r+2*a[o++]),_r(1,5,9,13,e,r+2*a[o++]),Er(2,6,10,14,e,r+2*a[o++]),_r(2,6,10,14,e,r+2*a[o++]),Er(3,7,11,15,e,r+2*a[o++]),_r(3,7,11,15,e,r+2*a[o++]),Er(0,5,10,15,e,r+2*a[o++]),_r(0,5,10,15,e,r+2*a[o++]),Er(1,6,11,12,e,r+2*a[o++]),_r(1,6,11,12,e,r+2*a[o++]),Er(2,7,8,13,e,r+2*a[o++]),_r(2,7,8,13,e,r+2*a[o++]),Er(3,4,9,14,e,r+2*a[o++]),_r(3,4,9,14,e,r+2*a[o++]);this.v0l^=V[0]^V[16],this.v0h^=V[1]^V[17],this.v1l^=V[2]^V[18],this.v1h^=V[3]^V[19],this.v2l^=V[4]^V[20],this.v2h^=V[5]^V[21],this.v3l^=V[6]^V[22],this.v3h^=V[7]^V[23],this.v4l^=V[8]^V[24],this.v4h^=V[9]^V[25],this.v5l^=V[10]^V[26],this.v5h^=V[11]^V[27],this.v6l^=V[12]^V[28],this.v6h^=V[13]^V[29],this.v7l^=V[14]^V[30],this.v7h^=V[15]^V[31],It(V)}destroy(){this.destroyed=!0,It(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const m_=V2(t=>new w_(t)),b_="https://rpc.walletconnect.org/v1";function bd(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+ie.from(t_(r)).toString("hex")}async function v_(t,e,r,n,i,s){switch(r.t){case"eip191":return await E_(t,e,r.s);case"eip1271":return await __(t,e,r.s,n,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function E_(t,e,r){const n=gv(r);return vv({payload:bd(e),signature:n}).toLowerCase()===t.toLowerCase()}async function __(t,e,r,n,i,s){const o=zi(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=r.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:bd(e)).substring(2),f=a+h+c+u+l,p=await fetch(`${s||b_}/?chainId=${n}&projectId=${i}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:x_(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:d}=await p.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function x_(){return Date.now()+Math.floor(Math.random()*1e3)}function S_(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const n=r[0];if(n===0)throw new Error("No signatures found");const i=1+n*64;if(r.length<i)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const s=ie.from(t,"base64").slice(1,65);return ui.encode(s)}function I_(t){const e=new Uint8Array(ie.from(t,"base64")),r=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),n=new Uint8Array(r.length+e.length);n.set(r),n.set(e,r.length);const i=m_(n,{dkLen:32});return ui.encode(i)}function eu(t){const e=new Uint8Array(Os(D_(t)));return ui.encode(e)}function D_(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function tu(t){const e=ie.from(t,"base64"),r=nE(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const n=Gv(r),i=ie.from("TX"),s=ie.concat([i,ie.from(n)]),o=d_(s);return yg.encode(o).replace(/=+$/,"")}function mo(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),ie.from(e)}function O_(t){const e=ie.from(t.signed.bodyBytes,"base64"),r=ie.from(t.signed.authInfoBytes,"base64"),n=ie.from(t.signature.signature,"base64"),i=[];i.push(ie.from([10])),i.push(mo(e.length)),i.push(e),i.push(ie.from([18])),i.push(mo(r.length)),i.push(r),i.push(ie.from([26])),i.push(mo(n.length)),i.push(n);const s=ie.concat(i),o=Os(s);return ie.from(o).toString("hex").toUpperCase()}function A_(t){var e,r;const n=[];try{if(typeof t=="string")return n.push(t),n;if(typeof t!="object")return n;t!=null&&t.id&&n.push(t.id);const i=(r=(e=t==null?void 0:t.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;i&&n.push(...i)}catch(i){console.warn("getWalletSendCallsHashes failed: ",i)}return n}var $_=Object.defineProperty,T_=Object.defineProperties,P_=Object.getOwnPropertyDescriptors,ru=Object.getOwnPropertySymbols,C_=Object.prototype.hasOwnProperty,N_=Object.prototype.propertyIsEnumerable,nu=(t,e,r)=>e in t?$_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,R_=(t,e)=>{for(var r in e||(e={}))C_.call(e,r)&&nu(t,r,e[r]);if(ru)for(var r of ru(e))N_.call(e,r)&&nu(t,r,e[r]);return t},B_=(t,e)=>T_(t,P_(e));const vd="did:pkh:",U_={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},k_=t=>t?U_[t]||t:"",As=t=>t==null?void 0:t.split(":"),M_=t=>{const e=t&&As(t);if(e)return t.includes(vd)?e[3]:e[1]},F_=t=>{const e=t&&As(t);if(e)return t.includes(vd)?e[2]:e[0]},oa=t=>{const e=t&&As(t);if(e)return e[2]+":"+e[3]},as=t=>{const e=t&&As(t);if(e)return e.pop()};async function iu(t){const{cacao:e,projectId:r}=t,{s:n,p:i}=e,s=Ed(i,i.iss),o=as(i.iss);return await v_(o,s,n,oa(i.iss),r)}const Ed=(t,e)=>{const r=F_(e);if(!r)throw new Error("Invalid issuer: "+e);const n=`${t.domain} wants you to sign in with your ${k_(r)} account:`,i=as(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${M_(e)}`,l=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,f=t.nbf?`Not Before: ${t.nbf}`:void 0,p=t.requestId?`Request ID: ${t.requestId}`:void 0,d=t.resources?`Resources:${t.resources.map(w=>`
- ${w}`).join("")}`:void 0,g=Vi(t.resources);if(g){const w=si(g);s=G_(s,w)}return[n,i,"",s,"",o,a,c,l,u,h,f,p,d].filter(w=>w!=null).join(`
`)};function L_(t){return ie.from(JSON.stringify(t)).toString("base64")}function j_(t){return JSON.parse(ie.from(t,"base64").toString("utf-8"))}function tn(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const n=t.att[r];if(Array.isArray(n))throw new Error(`Resource must be an object: ${r}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(n).forEach(i=>{const s=n[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function q_(t,e,r,n={}){return r==null||r.sort((i,s)=>i.localeCompare(s)),{att:{[t]:z_(e,r,n)}}}function z_(t,e,r={}){e=e==null?void 0:e.sort((i,s)=>i.localeCompare(s));const n=e.map(i=>({[`${t}/${i}`]:[r]}));return Object.assign({},...n)}function _d(t){return tn(t),`urn:recap:${L_(t).replace(/=/g,"")}`}function si(t){const e=j_(t.replace("urn:recap:",""));return tn(e),e}function V_(t,e,r){const n=q_(t,e,r);return _d(n)}function K_(t){return t&&t.includes("urn:recap:")}function H_(t,e){const r=si(t),n=si(e),i=W_(r,n);return _d(i)}function W_(t,e){tn(t),tn(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,s)=>i.localeCompare(s)),n={att:{}};return r.forEach(i=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;n.att[i]=B_(R_({},n.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((l=e.att[i])==null?void 0:l[a])})})}),n}function G_(t="",e){tn(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const n=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(i++,`(${i}) '${h}': '${l[h].join("', '")}' for '${a}'.`));n.push(u.join(", ").replace(".,","."))});const s=n.join(" "),o=`${r}${s}`;return`${t?t+" ":""}${o}`}function su(t){var e;const r=si(t);tn(r);const n=(e=r.att)==null?void 0:e.eip155;return n?Object.keys(n).map(i=>i.split("/")[1]):[]}function ou(t){const e=si(t);tn(e);const r=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(i=>{var s;(s=i==null?void 0:i[0])!=null&&s.chains&&r.push(i[0].chains)})}),[...new Set(r.flat())]}function Vi(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return K_(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function xd(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function aa(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function bo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function et(t,...e){if(!xd(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function au(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Y_(t,e){et(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Rr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function On(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Z_(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const J_=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function X_(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ca(t){if(typeof t=="string")t=X_(t);else if(xd(t))t=la(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function Q_(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function ex(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const tx=(t,e)=>{function r(n,...i){if(et(n),!J_)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=i[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?et(l):et(l,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&et(i[1]);const o=e(n,...i),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");et(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,et(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(et(l),s&&l.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(r,t),r};function cu(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!nx(e))throw new Error("invalid output, must be aligned");return e}function lu(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function rx(t,e,r){aa(r);const n=new Uint8Array(16),i=Z_(n);return lu(i,0,BigInt(e),r),lu(i,8,BigInt(t),r),n}function nx(t){return t.byteOffset%4===0}function la(t){return Uint8Array.from(t)}const Sd=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),ix=Sd("expand 16-byte k"),sx=Sd("expand 32-byte k"),ox=Rr(ix),ax=Rr(sx);function ne(t,e){return t<<e|t>>>32-e}function ua(t){return t.byteOffset%4===0}const Bi=64,cx=16,Id=2**32-1,uu=new Uint32Array;function lx(t,e,r,n,i,s,o,a){const c=i.length,l=new Uint8Array(Bi),u=Rr(l),h=ua(i)&&ua(s),f=h?Rr(i):uu,p=h?Rr(s):uu;for(let d=0;d<c;o++){if(t(e,r,n,u,o,a),o>=Id)throw new Error("arx: counter overflow");const g=Math.min(Bi,c-d);if(h&&g===Bi){const w=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let m=0,_;m<cx;m++)_=w+m,p[_]=f[_]^u[m];d+=Bi;continue}for(let w=0,m;w<g;w++)m=d+w,s[m]=i[m]^l[w];d+=g}}function ux(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=Q_({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return bo(i),bo(o),aa(s),aa(r),(a,c,l,u,h=0)=>{et(a),et(c),et(l);const f=l.length;if(u===void 0&&(u=new Uint8Array(f)),et(u),bo(h),h<0||h>=Id)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const p=[];let d=a.length,g,w;if(d===32)p.push(g=la(a)),w=ax;else if(d===16&&r)g=new Uint8Array(32),g.set(a),g.set(a,16),w=ox,p.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);ua(c)||p.push(c=la(c));const m=Rr(g);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(w,m,Rr(c.subarray(0,16)),m),c=c.subarray(16)}const _=16-i;if(_!==c.length)throw new Error(`arx: nonce must be ${_} or 16 bytes`);if(_!==12){const E=new Uint8Array(12);E.set(c,s?0:12-c.length),c=E,p.push(c)}const y=Rr(c);return lx(t,w,m,y,l,u,h,o),On(...p),u}}const Te=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class hx{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=ca(e),et(e,32);const r=Te(e,0),n=Te(e,2),i=Te(e,4),s=Te(e,6),o=Te(e,8),a=Te(e,10),c=Te(e,12),l=Te(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Te(e,16+2*u)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],f=o[5],p=o[6],d=o[7],g=o[8],w=o[9],m=Te(e,r+0),_=Te(e,r+2),y=Te(e,r+4),E=Te(e,r+6),I=Te(e,r+8),O=Te(e,r+10),N=Te(e,r+12),R=Te(e,r+14);let P=s[0]+(m&8191),M=s[1]+((m>>>13|_<<3)&8191),U=s[2]+((_>>>10|y<<6)&8191),C=s[3]+((y>>>7|E<<9)&8191),D=s[4]+((E>>>4|I<<12)&8191),T=s[5]+(I>>>1&8191),v=s[6]+((I>>>14|O<<2)&8191),b=s[7]+((O>>>11|N<<5)&8191),S=s[8]+((N>>>8|R<<8)&8191),$=s[9]+(R>>>5|i),x=0,A=x+P*a+M*(5*w)+U*(5*g)+C*(5*d)+D*(5*p);x=A>>>13,A&=8191,A+=T*(5*f)+v*(5*h)+b*(5*u)+S*(5*l)+$*(5*c),x+=A>>>13,A&=8191;let B=x+P*c+M*a+U*(5*w)+C*(5*g)+D*(5*d);x=B>>>13,B&=8191,B+=T*(5*p)+v*(5*f)+b*(5*h)+S*(5*u)+$*(5*l),x+=B>>>13,B&=8191;let k=x+P*l+M*c+U*a+C*(5*w)+D*(5*g);x=k>>>13,k&=8191,k+=T*(5*d)+v*(5*p)+b*(5*f)+S*(5*h)+$*(5*u),x+=k>>>13,k&=8191;let K=x+P*u+M*l+U*c+C*a+D*(5*w);x=K>>>13,K&=8191,K+=T*(5*g)+v*(5*d)+b*(5*p)+S*(5*f)+$*(5*h),x+=K>>>13,K&=8191;let z=x+P*h+M*u+U*l+C*c+D*a;x=z>>>13,z&=8191,z+=T*(5*w)+v*(5*g)+b*(5*d)+S*(5*p)+$*(5*f),x+=z>>>13,z&=8191;let q=x+P*f+M*h+U*u+C*l+D*c;x=q>>>13,q&=8191,q+=T*a+v*(5*w)+b*(5*g)+S*(5*d)+$*(5*p),x+=q>>>13,q&=8191;let H=x+P*p+M*f+U*h+C*u+D*l;x=H>>>13,H&=8191,H+=T*c+v*a+b*(5*w)+S*(5*g)+$*(5*d),x+=H>>>13,H&=8191;let G=x+P*d+M*p+U*f+C*h+D*u;x=G>>>13,G&=8191,G+=T*l+v*c+b*a+S*(5*w)+$*(5*g),x+=G>>>13,G&=8191;let X=x+P*g+M*d+U*p+C*f+D*h;x=X>>>13,X&=8191,X+=T*u+v*l+b*c+S*a+$*(5*w),x+=X>>>13,X&=8191;let W=x+P*w+M*g+U*d+C*p+D*f;x=W>>>13,W&=8191,W+=T*h+v*u+b*l+S*c+$*a,x+=W>>>13,W&=8191,x=(x<<2)+x|0,x=x+A|0,A=x&8191,x=x>>>13,B+=x,s[0]=A,s[1]=B,s[2]=k,s[3]=K,s[4]=z,s[5]=q,s[6]=H,s[7]=G,s[8]=X,s[9]=W}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;On(n)}update(e){au(this),e=ca(e),et(e);const{buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){On(this.h,this.r,this.buffer,this.pad)}digestInto(e){au(this),Y_(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}}function fx(t){const e=(n,i)=>t(i).update(ca(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const dx=fx(t=>new hx(t));function px(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],f=e[2],p=e[3],d=e[4],g=e[5],w=e[6],m=e[7],_=i,y=r[0],E=r[1],I=r[2],O=o,N=a,R=c,P=l,M=u,U=h,C=f,D=p,T=d,v=g,b=w,S=m,$=_,x=y,A=E,B=I;for(let K=0;K<s;K+=2)O=O+M|0,$=ne($^O,16),T=T+$|0,M=ne(M^T,12),O=O+M|0,$=ne($^O,8),T=T+$|0,M=ne(M^T,7),N=N+U|0,x=ne(x^N,16),v=v+x|0,U=ne(U^v,12),N=N+U|0,x=ne(x^N,8),v=v+x|0,U=ne(U^v,7),R=R+C|0,A=ne(A^R,16),b=b+A|0,C=ne(C^b,12),R=R+C|0,A=ne(A^R,8),b=b+A|0,C=ne(C^b,7),P=P+D|0,B=ne(B^P,16),S=S+B|0,D=ne(D^S,12),P=P+D|0,B=ne(B^P,8),S=S+B|0,D=ne(D^S,7),O=O+U|0,B=ne(B^O,16),b=b+B|0,U=ne(U^b,12),O=O+U|0,B=ne(B^O,8),b=b+B|0,U=ne(U^b,7),N=N+C|0,$=ne($^N,16),S=S+$|0,C=ne(C^S,12),N=N+C|0,$=ne($^N,8),S=S+$|0,C=ne(C^S,7),R=R+D|0,x=ne(x^R,16),T=T+x|0,D=ne(D^T,12),R=R+D|0,x=ne(x^R,8),T=T+x|0,D=ne(D^T,7),P=P+M|0,A=ne(A^P,16),v=v+A|0,M=ne(M^v,12),P=P+M|0,A=ne(A^P,8),v=v+A|0,M=ne(M^v,7);let k=0;n[k++]=o+O|0,n[k++]=a+N|0,n[k++]=c+R|0,n[k++]=l+P|0,n[k++]=u+M|0,n[k++]=h+U|0,n[k++]=f+C|0,n[k++]=p+D|0,n[k++]=d+T|0,n[k++]=g+v|0,n[k++]=w+b|0,n[k++]=m+S|0,n[k++]=_+$|0,n[k++]=y+x|0,n[k++]=E+A|0,n[k++]=I+B|0}const gx=ux(px,{counterRight:!1,counterLength:4,allowShortKeys:!1}),yx=new Uint8Array(16),hu=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(yx.subarray(r))},wx=new Uint8Array(32);function fu(t,e,r,n,i){const s=t(e,r,wx),o=dx.create(s);i&&hu(o,i),hu(o,n);const a=rx(n.length,i?i.length:0,!0);o.update(a);const c=o.digest();return On(s,a),c}const mx=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=cu(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=fu(t,e,r,a,n);return s.set(c,o),On(c),s},decrypt(i,s){s=cu(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=fu(t,e,r,o,n);if(!ex(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),On(c),s}}),Dd=tx({blockSize:64,nonceLength:12,tagLength:16},mx(gx));let Od=class extends Ds{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Is(e);const n=Ct(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),It(s)}update(e){return Ur(this),this.iHash.update(e),this}digestInto(e){Ur(this),Nt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const $s=(t,e,r)=>new Od(t,e).update(r).digest();$s.create=(t,e)=>new Od(t,e);function bx(t,e,r){return Is(t),r===void 0&&(r=new Uint8Array(t.outputLen)),$s(t,Ct(r),Ct(e))}const vo=Uint8Array.from([0]),du=Uint8Array.of();function vx(t,e,r,n=32){Is(t),fr(n);const i=t.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);r===void 0&&(r=du);const o=new Uint8Array(s*i),a=$s.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)vo[0]=u+1,c.update(u===0?du:l).update(r).update(vo).digestInto(l),o.set(l,i*u),a._cloneInto(c);return a.destroy(),c.destroy(),It(l,vo),o.slice(0,n)}const Ex=(t,e,r,n,i)=>vx(t,bx(t,e,r),n,i),Ts=Os,nc=BigInt(0),ha=BigInt(1);function cs(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Yr(t,e,r=""){const n=Ss(t),i=t==null?void 0:t.length,s=e!==void 0;if(!n||s&&i!==e){const o=r&&`"${r}" `,a=s?` of length ${e}`:"",c=n?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Ui(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Ad(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?nc:BigInt("0x"+t)}function Ps(t){return Ad(xn(t))}function ls(t){return Nt(t),Ad(xn(Uint8Array.from(t).reverse()))}function ic(t,e){return os(t.toString(16).padStart(e*2,"0"))}function sc(t,e){return ic(t,e).reverse()}function ze(t,e,r){let n;if(typeof e=="string")try{n=os(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ss(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}const Eo=t=>typeof t=="bigint"&&nc<=t;function _x(t,e,r){return Eo(t)&&Eo(e)&&Eo(r)&&e<=t&&t<r}function fa(t,e,r,n){if(!_x(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function $d(t){let e;for(e=0;t>nc;t>>=ha,e+=1);return e}const bi=t=>(ha<<BigInt(t))-ha;function xx(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=f=>new Uint8Array(f),i=f=>Uint8Array.of(f);let s=n(t),o=n(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},l=(...f)=>r(o,s,...f),u=(f=n(0))=>{o=l(i(0),f),s=l(),f.length!==0&&(o=l(i(1),f),s=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const p=[];for(;f<e;){s=l();const d=s.slice();p.push(d),f+=s.length}return Ar(...p)};return(f,p)=>{c(),u(f);let d;for(;!(d=p(h()));)u();return c(),d}}function Cs(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(r).forEach(([i,s])=>n(i,s,!0))}function pu(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const it=BigInt(0),He=BigInt(1),Zr=BigInt(2),Td=BigInt(3),Pd=BigInt(4),Cd=BigInt(5),Sx=BigInt(7),Nd=BigInt(8),Ix=BigInt(9),Rd=BigInt(16);function ft(t,e){const r=t%e;return r>=it?r:e+r}function $t(t,e,r){let n=t;for(;e-- >it;)n*=n,n%=r;return n}function gu(t,e){if(t===it)throw new Error("invert: expected non-zero number");if(e<=it)throw new Error("invert: expected positive modulus, got "+e);let r=ft(t,e),n=e,i=it,s=He;for(;r!==it;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==He)throw new Error("invert: does not exist");return ft(i,e)}function oc(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Bd(t,e){const r=(t.ORDER+He)/Pd,n=t.pow(e,r);return oc(t,n,e),n}function Dx(t,e){const r=(t.ORDER-Cd)/Nd,n=t.mul(e,Zr),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,Zr),i),a=t.mul(s,t.sub(o,t.ONE));return oc(t,a,e),a}function Ox(t){const e=Mr(t),r=Ud(t),n=r(e,e.neg(e.ONE)),i=r(e,n),s=r(e,e.neg(n)),o=(t+Sx)/Rd;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,n);const h=a.mul(l,i),f=a.mul(l,s),p=a.eql(a.sqr(u),c),d=a.eql(a.sqr(h),c);l=a.cmov(l,u,p),u=a.cmov(f,h,d);const g=a.eql(a.sqr(u),c),w=a.cmov(l,u,g);return oc(a,w,c),w}}function Ud(t){if(t<Td)throw new Error("sqrt is not defined for small field");let e=t-He,r=0;for(;e%Zr===it;)e/=Zr,r++;let n=Zr;const i=Mr(t);for(;yu(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Bd;let s=i.pow(n,e);const o=(e+He)/Zr;return function(a,c){if(a.is0(c))return c;if(yu(a,c)!==1)throw new Error("Cannot find square root");let l=r,u=a.mul(a.ONE,s),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,d=a.sqr(h);for(;!a.eql(d,a.ONE);)if(p++,d=a.sqr(d),p===l)throw new Error("Cannot find square root");const g=He<<BigInt(l-p-1),w=a.pow(u,g);l=p,u=a.sqr(w),h=a.mul(h,u),f=a.mul(f,w)}return f}}function Ax(t){return t%Pd===Td?Bd:t%Nd===Cd?Dx:t%Rd===Ix?Ox(t):Ud(t)}const $x=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Tx(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=$x.reduce((n,i)=>(n[i]="function",n),e);return Cs(t,r),t}function Px(t,e,r){if(r<it)throw new Error("invalid exponent, negatives unsupported");if(r===it)return t.ONE;if(r===He)return e;let n=t.ONE,i=e;for(;r>it;)r&He&&(n=t.mul(n,i)),i=t.sqr(i),r>>=He;return n}function kd(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function yu(t,e){const r=(t.ORDER-He)/Zr,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Md(t,e){e!==void 0&&fr(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Mr(t,e,r=!1,n={}){if(t<=it)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(i=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);const{nBitLength:c,nByteLength:l}=Md(t,i);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:l,MASK:bi(c),ZERO:it,ONE:He,allowedLengths:a,create:f=>ft(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return it<=f&&f<t},is0:f=>f===it,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&He)===He,neg:f=>ft(-f,t),eql:(f,p)=>f===p,sqr:f=>ft(f*f,t),add:(f,p)=>ft(f+p,t),sub:(f,p)=>ft(f-p,t),mul:(f,p)=>ft(f*p,t),pow:(f,p)=>Px(h,f,p),div:(f,p)=>ft(f*gu(p,t),t),sqrN:f=>f*f,addN:(f,p)=>f+p,subN:(f,p)=>f-p,mulN:(f,p)=>f*p,inv:f=>gu(f,t),sqrt:s||(f=>(u||(u=Ax(t)),u(h,f))),toBytes:f=>r?sc(f,l):ic(f,l),fromBytes:(f,p=!0)=>{if(a){if(!a.includes(f.length)||f.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const g=new Uint8Array(l);g.set(f,r?0:g.length-f.length),f=g}if(f.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+f.length);let d=r?ls(f):Ps(f);if(o&&(d=ft(d,t)),!p&&!h.isValid(d))throw new Error("invalid field element: outside of range 0..ORDER");return d},invertBatch:f=>kd(h,f),cmov:(f,p,d)=>d?p:f});return Object.freeze(h)}function Fd(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Ld(t){const e=Fd(t);return e+Math.ceil(e/2)}function Cx(t,e,r=!1){const n=t.length,i=Fd(e),s=Ld(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?ls(t):Ps(t),a=ft(o,e-He)+He;return r?sc(a,i):ic(a,i)}const An=BigInt(0),Jr=BigInt(1);function us(t,e){const r=e.negate();return t?r:e}function _o(t,e){const r=kd(t.Fp,e.map(n=>n.Z));return e.map((n,i)=>t.fromAffine(n.toAffine(r[i])))}function jd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function xo(t,e){jd(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=bi(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function wu(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=Jr);const l=e*n,u=l+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:l}}function Nx(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function Rx(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const So=new WeakMap,qd=new WeakMap;function Io(t){return qd.get(t)||1}function mu(t){if(t!==An)throw new Error("invalid wNAF")}class Bx{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let i=e;for(;r>An;)r&Jr&&(n=n.add(i)),i=i.double(),r>>=Jr;return n}precomputeWindow(e,r){const{windows:n,windowSize:i}=xo(r,this.bits),s=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,s.push(a);for(let l=1;l<i;l++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=xo(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:f,offsetF:p}=wu(n,a,o);n=c,u?s=s.add(us(f,r[p])):i=i.add(us(h,r[l]))}return mu(n),{p:i,f:s}}wNAFUnsafe(e,r,n,i=this.ZERO){const s=xo(e,this.bits);for(let o=0;o<s.windows&&n!==An;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=wu(n,o,s);if(n=a,!l){const h=r[c];i=i.add(u?h.negate():h)}}return mu(n),i}getPrecomputes(e,r,n){let i=So.get(r);return i||(i=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(i=n(i)),So.set(r,i))),i}cached(e,r,n){const i=Io(e);return this.wNAF(i,this.getPrecomputes(i,e,n),r)}unsafe(e,r,n,i){const s=Io(e);return s===1?this._unsafeLadder(e,r,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,i)}createCache(e,r){jd(r,this.bits),qd.set(e,r),So.delete(e)}hasCache(e){return Io(e)!==1}}function Ux(t,e,r,n){let i=e,s=t.ZERO,o=t.ZERO;for(;r>An||n>An;)r&Jr&&(s=s.add(i)),n&Jr&&(o=o.add(i)),i=i.double(),r>>=Jr,n>>=Jr;return{p1:s,p2:o}}function kx(t,e,r,n){Nx(r,t),Rx(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=$d(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=bi(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let g=0;g<s;g++){const w=n[g],m=Number(w>>BigInt(p)&l);u[m]=u[m].add(r[g])}let d=o;for(let g=u.length-1,w=o;g>0;g--)w=w.add(u[g]),d=d.add(w);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function bu(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Tx(e),e}else return Mr(t,{isLE:r})}function Mx(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>An))throw new Error(`CURVE.${a} must be positive bigint`)}const i=bu(e.p,r.Fp,n),s=bu(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),hd("HashToScalar-");const Fn=BigInt(0),pn=BigInt(1),ki=BigInt(2);function Fx(t){return Cs(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function Lx(t){const e=Fx(t),{P:r,type:n,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||cn,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),p=a?ki**BigInt(254):ki**BigInt(447),d=a?BigInt(8)*ki**BigInt(251)-pn:BigInt(4)*ki**BigInt(445)-pn,g=p+d+pn,w=C=>ft(C,r),m=_(h);function _(C){return sc(w(C),u)}function y(C){const D=ze("u coordinate",C,u);return a&&(D[31]&=127),w(ls(D))}function E(C){return ls(i(ze("scalar",C,u)))}function I(C,D){const T=R(y(D),E(C));if(T===Fn)throw new Error("invalid private or public key received");return _(T)}function O(C){return I(C,m)}function N(C,D,T){const v=w(C*(D-T));return D=w(D-v),T=w(T+v),{x_2:D,x_3:T}}function R(C,D){fa("u",C,Fn,r),fa("scalar",D,p,g);const T=D,v=C;let b=pn,S=Fn,$=C,x=pn,A=Fn;for(let k=BigInt(l-1);k>=Fn;k--){const K=T>>k&pn;A^=K,{x_2:b,x_3:$}=N(A,b,$),{x_2:S,x_3:x}=N(A,S,x),A=K;const z=b+S,q=w(z*z),H=b-S,G=w(H*H),X=q-G,W=$+x,Q=$-x,pe=w(Q*z),be=w(W*H),xe=pe+be,Ve=pe-be;$=w(xe*xe),x=w(v*w(Ve*Ve)),b=w(q*G),S=w(X*(q+w(f*X)))}({x_2:b,x_3:$}=N(A,b,$)),{x_2:S,x_3:x}=N(A,S,x);const B=s(S);return w(b*B)}const P={secretKey:u,publicKey:u,seed:u},M=(C=c(u))=>(Nt(C,P.seed),C);function U(C){const D=M(C);return{secretKey:D,publicKey:O(D)}}return{keygen:U,getSharedSecret:(C,D)=>I(C,D),getPublicKey:C=>O(C),scalarMult:I,scalarMultBase:O,utils:{randomSecretKey:M,randomPrivateKey:M},GuBytes:m.slice(),lengths:P}}const jx=BigInt(1),vu=BigInt(2),qx=BigInt(3),zx=BigInt(5);BigInt(8);const zd=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Vx={p:zd,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Kx(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=zd,o=t*t%s*t%s,a=$t(o,vu,s)*o%s,c=$t(a,jx,s)*t%s,l=$t(c,zx,s)*c%s,u=$t(l,e,s)*l%s,h=$t(u,r,s)*u%s,f=$t(h,n,s)*h%s,p=$t(f,i,s)*f%s,d=$t(p,i,s)*f%s,g=$t(d,e,s)*l%s;return{pow_p_5_8:$t(g,vu,s)*t%s,b2:o}}function Hx(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const Wx=Mr(Vx.p,{isLE:!0}),da=(()=>{const t=Wx.ORDER;return Lx({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=Kx(e);return ft($t(r,qx,t)*n,t)},adjustScalarBytes:Hx})})(),Eu=(t,e)=>(t+(t>=0?e:-e)/Vd)/e;function Gx(t,e,r){const[[n,i],[s,o]]=e,a=Eu(o*t,r),c=Eu(-i*t,r);let l=t-a*n-c*s,u=-a*i-c*o;const h=l<cr,f=u<cr;h&&(l=-l),f&&(u=-u);const p=bi(Math.ceil($d(r)/2))+Sn;if(l<cr||l>=p||u<cr||u>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}function pa(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Do(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return cs(r.lowS,"lowS"),cs(r.prehash,"prehash"),r.format!==void 0&&pa(r.format),r}class Yx extends Error{constructor(e=""){super(e)}}const ir={Err:Yx,_tlv:{encode:(t,e)=>{const{Err:r}=ir;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=Ui(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Ui(i.length/2|128):"";return Ui(t)+s+i+e},decode(t,e){const{Err:r}=ir;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=ir;if(t<cr)throw new e("integer: negative integers are not allowed");let r=Ui(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=ir;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Ps(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=ir,i=ze("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=ir,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},cr=BigInt(0),Sn=BigInt(1),Vd=BigInt(2),Mi=BigInt(3),Zx=BigInt(4);function bn(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let i=ze("private key",e);try{n=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function Jx(t,e={}){const r=Mx("weierstrass",t,e),{Fp:n,Fn:i}=r;let s=r.CURVE;const{h:o,n:a}=s;Cs(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=Hd(n,i);function u(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(C,D,T){const{x:v,y:b}=D.toAffine(),S=n.toBytes(v);if(cs(T,"isCompressed"),T){u();const $=!n.isOdd(b);return Ar(Kd($),S)}else return Ar(Uint8Array.of(4),S,n.toBytes(b))}function f(C){Yr(C,void 0,"Point");const{publicKey:D,publicKeyUncompressed:T}=l,v=C.length,b=C[0],S=C.subarray(1);if(v===D&&(b===2||b===3)){const $=n.fromBytes(S);if(!n.isValid($))throw new Error("bad point: is not on curve, wrong x");const x=g($);let A;try{A=n.sqrt(x)}catch(k){const K=k instanceof Error?": "+k.message:"";throw new Error("bad point: is not on curve, sqrt error"+K)}u();const B=n.isOdd(A);return(b&1)===1!==B&&(A=n.neg(A)),{x:$,y:A}}else if(v===T&&b===4){const $=n.BYTES,x=n.fromBytes(S.subarray(0,$)),A=n.fromBytes(S.subarray($,$*2));if(!w(x,A))throw new Error("bad point: is not on curve");return{x,y:A}}else throw new Error(`bad point: got length ${v}, expected compressed=${D} or uncompressed=${T}`)}const p=e.toBytes||h,d=e.fromBytes||f;function g(C){const D=n.sqr(C),T=n.mul(D,C);return n.add(n.add(T,n.mul(C,s.a)),s.b)}function w(C,D){const T=n.sqr(D),v=g(C);return n.eql(T,v)}if(!w(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const m=n.mul(n.pow(s.a,Mi),Zx),_=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(m,_)))throw new Error("bad curve params: a or b");function y(C,D,T=!1){if(!n.isValid(D)||T&&n.is0(D))throw new Error(`bad point coordinate ${C}`);return D}function E(C){if(!(C instanceof P))throw new Error("ProjectivePoint expected")}function I(C){if(!c||!c.basises)throw new Error("no endo");return Gx(C,c.basises,i.ORDER)}const O=pu((C,D)=>{const{X:T,Y:v,Z:b}=C;if(n.eql(b,n.ONE))return{x:T,y:v};const S=C.is0();D==null&&(D=S?n.ONE:n.inv(b));const $=n.mul(T,D),x=n.mul(v,D),A=n.mul(b,D);if(S)return{x:n.ZERO,y:n.ZERO};if(!n.eql(A,n.ONE))throw new Error("invZ was invalid");return{x:$,y:x}}),N=pu(C=>{if(C.is0()){if(e.allowInfinityPoint&&!n.is0(C.Y))return;throw new Error("bad point: ZERO")}const{x:D,y:T}=C.toAffine();if(!n.isValid(D)||!n.isValid(T))throw new Error("bad point: x or y not field elements");if(!w(D,T))throw new Error("bad point: equation left != right");if(!C.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(C,D,T,v,b){return T=new P(n.mul(T.X,C),T.Y,T.Z),D=us(v,D),T=us(b,T),D.add(T)}class P{constructor(D,T,v){this.X=y("x",D),this.Y=y("y",T,!0),this.Z=y("z",v),Object.freeze(this)}static CURVE(){return s}static fromAffine(D){const{x:T,y:v}=D||{};if(!D||!n.isValid(T)||!n.isValid(v))throw new Error("invalid affine point");if(D instanceof P)throw new Error("projective point not allowed");return n.is0(T)&&n.is0(v)?P.ZERO:new P(T,v,n.ONE)}static fromBytes(D){const T=P.fromAffine(d(Yr(D,void 0,"point")));return T.assertValidity(),T}static fromHex(D){return P.fromBytes(ze("pointHex",D))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(D=8,T=!0){return U.createCache(this,D),T||this.multiply(Mi),this}assertValidity(){N(this)}hasEvenY(){const{y:D}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(D)}equals(D){E(D);const{X:T,Y:v,Z:b}=this,{X:S,Y:$,Z:x}=D,A=n.eql(n.mul(T,x),n.mul(S,b)),B=n.eql(n.mul(v,x),n.mul($,b));return A&&B}negate(){return new P(this.X,n.neg(this.Y),this.Z)}double(){const{a:D,b:T}=s,v=n.mul(T,Mi),{X:b,Y:S,Z:$}=this;let x=n.ZERO,A=n.ZERO,B=n.ZERO,k=n.mul(b,b),K=n.mul(S,S),z=n.mul($,$),q=n.mul(b,S);return q=n.add(q,q),B=n.mul(b,$),B=n.add(B,B),x=n.mul(D,B),A=n.mul(v,z),A=n.add(x,A),x=n.sub(K,A),A=n.add(K,A),A=n.mul(x,A),x=n.mul(q,x),B=n.mul(v,B),z=n.mul(D,z),q=n.sub(k,z),q=n.mul(D,q),q=n.add(q,B),B=n.add(k,k),k=n.add(B,k),k=n.add(k,z),k=n.mul(k,q),A=n.add(A,k),z=n.mul(S,$),z=n.add(z,z),k=n.mul(z,q),x=n.sub(x,k),B=n.mul(z,K),B=n.add(B,B),B=n.add(B,B),new P(x,A,B)}add(D){E(D);const{X:T,Y:v,Z:b}=this,{X:S,Y:$,Z:x}=D;let A=n.ZERO,B=n.ZERO,k=n.ZERO;const K=s.a,z=n.mul(s.b,Mi);let q=n.mul(T,S),H=n.mul(v,$),G=n.mul(b,x),X=n.add(T,v),W=n.add(S,$);X=n.mul(X,W),W=n.add(q,H),X=n.sub(X,W),W=n.add(T,b);let Q=n.add(S,x);return W=n.mul(W,Q),Q=n.add(q,G),W=n.sub(W,Q),Q=n.add(v,b),A=n.add($,x),Q=n.mul(Q,A),A=n.add(H,G),Q=n.sub(Q,A),k=n.mul(K,W),A=n.mul(z,G),k=n.add(A,k),A=n.sub(H,k),k=n.add(H,k),B=n.mul(A,k),H=n.add(q,q),H=n.add(H,q),G=n.mul(K,G),W=n.mul(z,W),H=n.add(H,G),G=n.sub(q,G),G=n.mul(K,G),W=n.add(W,G),q=n.mul(H,W),B=n.add(B,q),q=n.mul(Q,W),A=n.mul(X,A),A=n.sub(A,q),q=n.mul(X,H),k=n.mul(Q,k),k=n.add(k,q),new P(A,B,k)}subtract(D){return this.add(D.negate())}is0(){return this.equals(P.ZERO)}multiply(D){const{endo:T}=e;if(!i.isValidNot0(D))throw new Error("invalid scalar: out of range");let v,b;const S=$=>U.cached(this,$,x=>_o(P,x));if(T){const{k1neg:$,k1:x,k2neg:A,k2:B}=I(D),{p:k,f:K}=S(x),{p:z,f:q}=S(B);b=K.add(q),v=R(T.beta,k,z,$,A)}else{const{p:$,f:x}=S(D);v=$,b=x}return _o(P,[v,b])[0]}multiplyUnsafe(D){const{endo:T}=e,v=this;if(!i.isValid(D))throw new Error("invalid scalar: out of range");if(D===cr||v.is0())return P.ZERO;if(D===Sn)return v;if(U.hasCache(this))return this.multiply(D);if(T){const{k1neg:b,k1:S,k2neg:$,k2:x}=I(D),{p1:A,p2:B}=Ux(P,v,S,x);return R(T.beta,A,B,b,$)}else return U.unsafe(v,D)}multiplyAndAddUnsafe(D,T,v){const b=this.multiplyUnsafe(T).add(D.multiplyUnsafe(v));return b.is0()?void 0:b}toAffine(D){return O(this,D)}isTorsionFree(){const{isTorsionFree:D}=e;return o===Sn?!0:D?D(P,this):U.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:D}=e;return o===Sn?this:D?D(P,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(D=!0){return cs(D,"isCompressed"),this.assertValidity(),p(P,this,D)}toHex(D=!0){return xn(this.toBytes(D))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(D=!0){return this.toBytes(D)}_setWindowSize(D){this.precompute(D)}static normalizeZ(D){return _o(P,D)}static msm(D,T){return kx(P,i,D,T)}static fromPrivateKey(D){return P.BASE.multiply(bn(i,D))}}P.BASE=new P(s.Gx,s.Gy,n.ONE),P.ZERO=new P(n.ZERO,n.ONE,n.ZERO),P.Fp=n,P.Fn=i;const M=i.BITS,U=new Bx(P,e.endo?Math.ceil(M/2):M);return P.BASE.precompute(8),P}function Kd(t){return Uint8Array.of(t?2:3)}function Hd(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function Xx(t,e={}){const{Fn:r}=t,n=e.randomBytes||cn,i=Object.assign(Hd(t.Fp,r),{seed:Ld(r.ORDER)});function s(f){try{return!!bn(r,f)}catch{return!1}}function o(f,p){const{publicKey:d,publicKeyUncompressed:g}=i;try{const w=f.length;return p===!0&&w!==d||p===!1&&w!==g?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=n(i.seed)){return Cx(Yr(f,i.seed,"seed"),r.ORDER)}function c(f,p=!0){return t.BASE.multiply(bn(r,f)).toBytes(p)}function l(f){const p=a(f);return{secretKey:p,publicKey:c(p)}}function u(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:p,publicKey:d,publicKeyUncompressed:g}=i;if(r.allowedLengths||p===d)return;const w=ze("key",f).length;return w===d||w===g}function h(f,p,d=!0){if(u(f)===!0)throw new Error("first arg must be private key");if(u(p)===!1)throw new Error("second arg must be public key");const g=bn(r,f);return t.fromHex(p).multiply(g).toBytes(d)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:f=>bn(r,f),precompute(f=8,p=t.BASE){return p.precompute(f,!1)}},lengths:i})}function Qx(t,e,r={}){Is(e),Cs(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||cn,i=r.hmac||((T,...v)=>$s(e,T,Ar(...v))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:p}=Xx(t,r),d={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function w(T){const v=a>>Sn;return T>v}function m(T,v){if(!o.isValidNot0(v))throw new Error(`invalid signature ${T}: out of range 1..Point.Fn.ORDER`);return v}function _(T,v){pa(v);const b=p.signature,S=v==="compact"?b:v==="recovered"?b+1:void 0;return Yr(T,S,`${v} signature`)}class y{constructor(v,b,S){this.r=m("r",v),this.s=m("s",b),S!=null&&(this.recovery=S),Object.freeze(this)}static fromBytes(v,b=g){_(v,b);let S;if(b==="der"){const{r:B,s:k}=ir.toSig(Yr(v));return new y(B,k)}b==="recovered"&&(S=v[0],b="compact",v=v.subarray(1));const $=o.BYTES,x=v.subarray(0,$),A=v.subarray($,$*2);return new y(o.fromBytes(x),o.fromBytes(A),S)}static fromHex(v,b){return this.fromBytes(os(v),b)}addRecoveryBit(v){return new y(this.r,this.s,v)}recoverPublicKey(v){const b=s.ORDER,{r:S,s:$,recovery:x}=this;if(x==null||![0,1,2,3].includes(x))throw new Error("recovery id invalid");if(a*Vd<b&&x>1)throw new Error("recovery id is ambiguous for h>1 curve");const A=x===2||x===3?S+a:S;if(!s.isValid(A))throw new Error("recovery id 2 or 3 invalid");const B=s.toBytes(A),k=t.fromBytes(Ar(Kd((x&1)===0),B)),K=o.inv(A),z=I(ze("msgHash",v)),q=o.create(-z*K),H=o.create($*K),G=t.BASE.multiplyUnsafe(q).add(k.multiplyUnsafe(H));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return w(this.s)}toBytes(v=g){if(pa(v),v==="der")return os(ir.hexFromSig(this));const b=o.toBytes(this.r),S=o.toBytes(this.s);if(v==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Ar(Uint8Array.of(this.recovery),b,S)}return Ar(b,S)}toHex(v){return xn(this.toBytes(v))}assertValidity(){}static fromCompact(v){return y.fromBytes(ze("sig",v),"compact")}static fromDER(v){return y.fromBytes(ze("sig",v),"der")}normalizeS(){return this.hasHighS()?new y(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return xn(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return xn(this.toBytes("compact"))}}const E=r.bits2int||function(T){if(T.length>8192)throw new Error("input is too large");const v=Ps(T),b=T.length*8-c;return b>0?v>>BigInt(b):v},I=r.bits2int_modN||function(T){return o.create(E(T))},O=bi(c);function N(T){return fa("num < 2^"+c,T,cr,O),o.toBytes(T)}function R(T,v){return Yr(T,void 0,"message"),v?Yr(e(T),void 0,"prehashed message"):T}function P(T,v,b){if(["recovered","canonical"].some(H=>H in b))throw new Error("sign() legacy options not supported");const{lowS:S,prehash:$,extraEntropy:x}=Do(b,d);T=R(T,$);const A=I(T),B=bn(o,v),k=[N(B),N(A)];if(x!=null&&x!==!1){const H=x===!0?n(p.secretKey):x;k.push(ze("extraEntropy",H))}const K=Ar(...k),z=A;function q(H){const G=E(H);if(!o.isValidNot0(G))return;const X=o.inv(G),W=t.BASE.multiply(G).toAffine(),Q=o.create(W.x);if(Q===cr)return;const pe=o.create(X*o.create(z+Q*B));if(pe===cr)return;let be=(W.x===Q?0:2)|Number(W.y&Sn),xe=pe;return S&&w(pe)&&(xe=o.neg(pe),be^=1),new y(Q,xe,be)}return{seed:K,k2sig:q}}function M(T,v,b={}){T=ze("message",T);const{seed:S,k2sig:$}=P(T,v,b);return xx(e.outputLen,o.BYTES,i)(S,$)}function U(T){let v;const b=typeof T=="string"||Ss(T),S=!b&&T!==null&&typeof T=="object"&&typeof T.r=="bigint"&&typeof T.s=="bigint";if(!b&&!S)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(S)v=new y(T.r,T.s);else if(b){try{v=y.fromBytes(ze("sig",T),"der")}catch($){if(!($ instanceof ir.Err))throw $}if(!v)try{v=y.fromBytes(ze("sig",T),"compact")}catch{return!1}}return v||!1}function C(T,v,b,S={}){const{lowS:$,prehash:x,format:A}=Do(S,d);if(b=ze("publicKey",b),v=R(ze("message",v),x),"strict"in S)throw new Error("options.strict was renamed to lowS");const B=A===void 0?U(T):y.fromBytes(ze("sig",T),A);if(B===!1)return!1;try{const k=t.fromBytes(b);if($&&B.hasHighS())return!1;const{r:K,s:z}=B,q=I(v),H=o.inv(z),G=o.create(q*H),X=o.create(K*H),W=t.BASE.multiplyUnsafe(G).add(k.multiplyUnsafe(X));return W.is0()?!1:o.create(W.x)===K}catch{return!1}}function D(T,v,b={}){const{prehash:S}=Do(b,d);return v=R(v,S),y.fromBytes(T,"recovered").recoverPublicKey(v).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:p,Point:t,sign:M,verify:C,recoverPublicKey:D,Signature:y,hash:e})}function e3(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=Mr(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function t3(t){const{CURVE:e,curveOpts:r}=e3(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function r3(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,Md(r.Fn.ORDER,r.Fn.BITS))})}function n3(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:i}=t3(t),s=Jx(e,r),o=Qx(s,n,i);return r3(t,o)}function ga(t,e){const r=n=>n3({...t,hash:n});return{...r(e),create:r}}const Wd={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Gd={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Yd={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},i3=Mr(Wd.p),s3=Mr(Gd.p),o3=Mr(Yd.p),a3=ga({...Wd,Fp:i3,lowS:!1},Os);ga({...Gd,Fp:s3,lowS:!1},f_),ga({...Yd,Fp:o3,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},h_);const c3=a3,Zd="base10",We="base16",tt="base64pad",$r="base64url",vi="utf8",Jd=0,ur=1,Ei=2,l3=0,_u=1,Zn=12,ac=32;function u3(){const t=da.utils.randomPrivateKey(),e=da.getPublicKey(t);return{privateKey:st(t,We),publicKey:st(e,We)}}function ya(){const t=cn(ac);return st(t,We)}function h3(t,e){const r=da.getSharedSecret(xt(t,We),xt(e,We)),n=Ex(Ts,r,void 0,void 0,ac);return st(n,We)}function Ki(t){const e=Ts(xt(t,We));return st(e,We)}function Et(t){const e=Ts(xt(t,vi));return st(e,We)}function Xd(t){return xt(`${t}`,Zd)}function rn(t){return Number(st(t,Zd))}function Qd(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function ep(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function f3(t){const e=Xd(typeof t.type<"u"?t.type:Jd);if(rn(e)===ur&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?xt(t.senderPublicKey,We):void 0,n=typeof t.iv<"u"?xt(t.iv,We):cn(Zn),i=xt(t.symKey,We),s=Dd(i,n).encrypt(xt(t.message,vi)),o=tp({type:e,sealed:s,iv:n,senderPublicKey:r});return t.encoding===$r?Qd(o):o}function d3(t){const e=xt(t.symKey,We),{sealed:r,iv:n}=oi({encoded:t.encoded,encoding:t.encoding}),i=Dd(e,n).decrypt(r);if(i===null)throw new Error("Failed to decrypt");return st(i,vi)}function p3(t,e){const r=Xd(Ei),n=cn(Zn),i=xt(t,vi),s=tp({type:r,sealed:i,iv:n});return e===$r?Qd(s):s}function g3(t,e){const{sealed:r}=oi({encoded:t,encoding:e});return st(r,vi)}function tp(t){if(rn(t.type)===Ei)return st(Yn([t.type,t.sealed]),tt);if(rn(t.type)===ur){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return st(Yn([t.type,t.senderPublicKey,t.iv,t.sealed]),tt)}return st(Yn([t.type,t.iv,t.sealed]),tt)}function oi(t){const e=(t.encoding||tt)===$r?ep(t.encoded):t.encoded,r=xt(e,tt),n=r.slice(l3,_u),i=_u;if(rn(n)===ur){const c=i+ac,l=c+Zn,u=r.slice(i,c),h=r.slice(c,l),f=r.slice(l);return{type:n,sealed:f,iv:h,senderPublicKey:u}}if(rn(n)===Ei){const c=r.slice(i),l=cn(Zn);return{type:n,sealed:c,iv:l}}const s=i+Zn,o=r.slice(i,s),a=r.slice(s);return{type:n,sealed:a,iv:o}}function y3(t,e){const r=oi({encoded:t,encoding:e==null?void 0:e.encoding});return rp({type:rn(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?st(r.senderPublicKey,We):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function rp(t){const e=(t==null?void 0:t.type)||Jd;if(e===ur){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function xu(t){return t.type===ur&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Su(t){return t.type===Ei}function w3(t){const e=ie.from(t.x,"base64"),r=ie.from(t.y,"base64");return Yn([new Uint8Array([4]),e,r])}function m3(t,e){const[r,n,i]=t.split("."),s=ie.from(ep(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${n}`,l=Ts(c),u=w3(e);if(!c3.verify(Yn([o,a]),l,u))throw new Error("Invalid signature");return Yo(t).payload}const b3="irn";function hs(t){return(t==null?void 0:t.relay)||{protocol:b3}}function vn(t){const e=e2[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var v3=Object.defineProperty,E3=Object.defineProperties,_3=Object.getOwnPropertyDescriptors,Iu=Object.getOwnPropertySymbols,x3=Object.prototype.hasOwnProperty,S3=Object.prototype.propertyIsEnumerable,Du=(t,e,r)=>e in t?v3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Oo=(t,e)=>{for(var r in e||(e={}))x3.call(e,r)&&Du(t,r,e[r]);if(Iu)for(var r of Iu(e))S3.call(e,r)&&Du(t,r,e[r]);return t},I3=(t,e)=>E3(t,_3(e));function D3(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(n)){const s=i.replace(n,""),o=t[i];r[s]=o}}),r}function Ou(t){if(!t.includes("wc:")){const l=sd(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),i=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:O3(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:D3(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function O3(t){return t.startsWith("//")?t.substring(2):t}function A3(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(i=>{const s=i,o=r+e+s;t[s]&&(n[o]=t[s])}),n}function Au(t){const e=new URLSearchParams,r=Oo(Oo(I3(Oo({},A3(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([n],[i])=>n.localeCompare(i)).forEach(([n,i])=>{i!==void 0&&e.append(n,String(i))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function Fi(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var $3=Object.defineProperty,T3=Object.defineProperties,P3=Object.getOwnPropertyDescriptors,$u=Object.getOwnPropertySymbols,C3=Object.prototype.hasOwnProperty,N3=Object.prototype.propertyIsEnumerable,Tu=(t,e,r)=>e in t?$3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,R3=(t,e)=>{for(var r in e||(e={}))C3.call(e,r)&&Tu(t,r,e[r]);if($u)for(var r of $u(e))N3.call(e,r)&&Tu(t,r,e[r]);return t},B3=(t,e)=>T3(t,P3(e));function Pn(t){const e=[];return t.forEach(r=>{const[n,i]=r.split(":");e.push(`${n}:${i}`)}),e}function np(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Pn(r.accounts))}),[...new Set(e)]}function U3(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.methods)}),[...new Set(e)]}function k3(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.events)}),[...new Set(e)]}function M3(t,e){const r=[];return Object.values(t).forEach(n=>{Pn(n.accounts).includes(e)&&r.push(...n.methods)}),r}function F3(t,e){const r=[];return Object.values(t).forEach(n=>{Pn(n.accounts).includes(e)&&r.push(...n.events)}),r}function ip(t){return t.includes(":")}function L3(t){return ip(t)?t.split(":")[0]:t}function Pu(t){var e,r,n;const i={};if(!ai(t))return i;for(const[s,o]of Object.entries(t)){const a=ip(s)?[s]:o.chains,c=o.methods||[],l=o.events||[],u=L3(s);i[u]=B3(R3({},i[u]),{chains:en(a,(e=i[u])==null?void 0:e.chains),methods:en(c,(r=i[u])==null?void 0:r.methods),events:en(l,(n=i[u])==null?void 0:n.events)})}return i}function j3(t){const e={};return t==null||t.forEach(r=>{var n;const[i,s]=r.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(r),(n=e[i].chains)==null||n.push(`${i}:${s}`)}),e}function Cu(t,e){e=e.map(n=>n.replace("did:pkh:",""));const r=j3(e);for(const[n,i]of Object.entries(r))i.methods?i.methods=en(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return r}function q3(t,e){var r,n,i,s,o,a;const c=Pu(t),l=Pu(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const f of h)u[f]={chains:en((r=c[f])==null?void 0:r.chains,(n=l[f])==null?void 0:n.chains),methods:en((i=c[f])==null?void 0:i.methods,(s=l[f])==null?void 0:s.methods),events:en((o=c[f])==null?void 0:o.events,(a=l[f])==null?void 0:a.events)};return u}const z3={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},V3={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function j(t,e){const{message:r,code:n}=V3[t];return{message:e?`${r} ${e}`:r,code:n}}function fe(t,e){const{message:r,code:n}=z3[t];return{message:e?`${r} ${e}`:r,code:n}}function nn(t,e){return!!Array.isArray(t)}function ai(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ae(t){return typeof t>"u"}function me(t,e){return e&&Ae(t)?!0:typeof t=="string"&&!!t.trim().length}function cc(t,e){return typeof t=="number"&&!isNaN(t)}function K3(t,e){const{requiredNamespaces:r}=e,n=Object.keys(t.namespaces),i=Object.keys(r);let s=!0;return Gr(i,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=Pn(a),h=r[o];(!Gr(ed(o,h),u)||!Gr(h.methods,c)||!Gr(h.events,l))&&(s=!1)}),s):!1}function fs(t){return me(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function H3(t){if(me(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&fs(r)}}return!1}function W3(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(me(t,!1)){if(e(t))return!0;const r=sd(t);return e(r)}}catch{}return!1}function G3(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function Y3(t){return t==null?void 0:t.topic}function Z3(t,e){let r=null;return me(t==null?void 0:t.publicKey,!1)||(r=j("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Nu(t){let e=!0;return nn(t)?t.length&&(e=t.every(r=>me(r,!1))):e=!1,e}function J3(t,e,r){let n=null;return nn(e)&&e.length?e.forEach(i=>{n||fs(i)||(n=fe("UNSUPPORTED_CHAINS",`${r}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):fs(t)||(n=fe("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function X3(t,e,r){let n=null;return Object.entries(t).forEach(([i,s])=>{if(n)return;const o=J3(i,ed(i,s),`${e} ${r}`);o&&(n=o)}),n}function Q3(t,e){let r=null;return nn(t)?t.forEach(n=>{r||H3(n)||(r=fe("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=fe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function eS(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const i=Q3(n==null?void 0:n.accounts,`${e} namespace`);i&&(r=i)}),r}function tS(t,e){let r=null;return Nu(t==null?void 0:t.methods)?Nu(t==null?void 0:t.events)||(r=fe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=fe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function sp(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const i=tS(n,`${e}, namespace`);i&&(r=i)}),r}function rS(t,e,r){let n=null;if(t&&ai(t)){const i=sp(t,e);i&&(n=i);const s=X3(t,e,r);s&&(n=s)}else n=j("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return n}function Ao(t,e){let r=null;if(t&&ai(t)){const n=sp(t,e);n&&(r=n);const i=eS(t,e);i&&(r=i)}else r=j("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function op(t){return me(t.protocol,!0)}function nS(t,e){let r=!1;return t?t&&nn(t)&&t.length&&t.forEach(n=>{r=op(n)}):r=!0,r}function iS(t){return typeof t=="number"}function Xe(t){return typeof t<"u"&&typeof t!==null}function sS(t){return!(!t||typeof t!="object"||!t.code||!cc(t.code)||!t.message||!me(t.message,!1))}function oS(t){return!(Ae(t)||!me(t.method,!1))}function aS(t){return!(Ae(t)||Ae(t.result)&&Ae(t.error)||!cc(t.id)||!me(t.jsonrpc,!1))}function cS(t){return!(Ae(t)||!me(t.name,!1))}function Ru(t,e){return!(!fs(e)||!np(t).includes(e))}function lS(t,e,r){return me(r,!1)?M3(t,e).includes(r):!1}function uS(t,e,r){return me(r,!1)?F3(t,e).includes(r):!1}function Bu(t,e,r){let n=null;const i=hS(t),s=fS(e),o=Object.keys(i),a=Object.keys(s),c=Uu(Object.keys(t)),l=Uu(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(n=j("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Gr(o,a)||(n=j("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||n)return;const f=Pn(e[h].accounts);f.includes(h)||(n=j("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{n||(Gr(i[h].methods,s[h].methods)?Gr(i[h].events,s[h].events)||(n=j("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):n=j("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),n}function hS(t){const e={};return Object.keys(t).forEach(r=>{var n;r.includes(":")?e[r]=t[r]:(n=t[r].chains)==null||n.forEach(i=>{e[i]={methods:t[r].methods,events:t[r].events}})}),e}function Uu(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function fS(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const n=Pn(t[r].accounts);n==null||n.forEach(i=>{e[i]={accounts:t[r].accounts.filter(s=>s.includes(`${i}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function dS(t,e){return cc(t)&&t<=e.max&&t>=e.min}function ku(){const t=wi();return new Promise(e=>{switch(t){case dt.browser:e(pS());break;case dt.reactNative:e(gS());break;case dt.node:e(yS());break;default:e(!0)}})}function pS(){return Tn()&&(navigator==null?void 0:navigator.onLine)}async function gS(){if(kr()&&typeof Y<"u"&&Y!=null&&Y.NetInfo){const t=await(Y==null?void 0:Y.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function yS(){return!0}function wS(t){switch(wi()){case dt.browser:mS(t);break;case dt.reactNative:bS(t);break}}function mS(t){!kr()&&Tn()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function bS(t){var e;kr()&&typeof Y<"u"&&Y!=null&&Y.NetInfo&&((e=Y)==null||e.NetInfo.addEventListener(r=>t(r==null?void 0:r.isConnected)))}function vS(){var t;return Tn()&&hr.getDocument()?((t=hr.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const $o={};class Ln{static get(e){return $o[e]}static set(e,r){$o[e]=r}static delete(e){delete $o[e]}}function ES(t){const e=ui.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function _S({publicKey:t,signature:e,payload:r}){var n;const i=wa(r.method),s=128|parseInt(((n=r.version)==null?void 0:n.toString())||"4"),o=IS(r.address),a=r.era==="00"?new Uint8Array([0]):wa(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${SS(r.tip)}`),h=OS(u),f=new Uint8Array([0,...t,o,...e,...a,...l,...h,...i]),p=DS(f.length+1);return new Uint8Array([...p,s,...f])}function xS(t){const e=wa(t),r=i2.blake2b(e,void 0,32);return"0x"+ie.from(r).toString("hex")}function wa(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function SS(t){return t.startsWith("0x")?t.slice(2):t}function IS(t){const e=ui.decode(t)[0];return e===42?0:e===60?2:1}function DS(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function OS(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function AS(t){const e=Uint8Array.from(ie.from(t.signature,"hex")),r=ES(t.transaction.address),n=_S({publicKey:r,signature:e,payload:t.transaction}),i=ie.from(n).toString("hex");return xS(i)}function ap({logger:t,name:e}){const r=typeof t=="string"?Bh({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}const $S="PARSE_ERROR",TS="INVALID_REQUEST",PS="METHOD_NOT_FOUND",CS="INVALID_PARAMS",cp="INTERNAL_ERROR",lc="SERVER_ERROR",NS=[-32700,-32600,-32601,-32602,-32603],Jn={[$S]:{code:-32700,message:"Parse error"},[TS]:{code:-32600,message:"Invalid Request"},[PS]:{code:-32601,message:"Method not found"},[CS]:{code:-32602,message:"Invalid params"},[cp]:{code:-32603,message:"Internal error"},[lc]:{code:-32e3,message:"Server error"}},lp=lc;function RS(t){return NS.includes(t)}function Mu(t){return Object.keys(Jn).includes(t)?Jn[t]:Jn[lp]}function BS(t){const e=Object.values(Jn).find(r=>r.code===t);return e||Jn[lp]}function US(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var To={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ma=function(t,e){return ma=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},ma(t,e)};function kS(t,e){ma(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var ba=function(){return ba=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ba.apply(this,arguments)};function MS(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function FS(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function LS(t,e){return function(r,n){e(r,n,t)}}function jS(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function qS(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})}function zS(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],i=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function VS(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function KS(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function va(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function up(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function HS(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(up(arguments[e]));return t}function WS(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function ci(t){return this instanceof ci?(this.v=t,this):new ci(t)}function GS(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){n[f]&&(i[f]=function(p){return new Promise(function(d,g){s.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(n[f](p))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof ci?Promise.resolve(f.value.v).then(l,u):h(s[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function YS(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:ci(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function ZS(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof va=="function"?va(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function JS(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function XS(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function QS(t){return t&&t.__esModule?t:{default:t}}function eI(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function tI(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const rI=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return ba},__asyncDelegator:YS,__asyncGenerator:GS,__asyncValues:ZS,__await:ci,__awaiter:qS,__classPrivateFieldGet:eI,__classPrivateFieldSet:tI,__createBinding:VS,__decorate:FS,__exportStar:KS,__extends:kS,__generator:zS,__importDefault:QS,__importStar:XS,__makeTemplateObject:JS,__metadata:jS,__param:LS,__read:up,__rest:MS,__spread:HS,__spreadArrays:WS,__values:va},Symbol.toStringTag,{value:"Module"})),nI=mh(rI);var Xt={},Fu;function iI(){if(Fu)return Xt;Fu=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.isBrowserCryptoAvailable=Xt.getSubtleCrypto=Xt.getBrowerCrypto=void 0;function t(){return(un===null||un===void 0?void 0:un.crypto)||(un===null||un===void 0?void 0:un.msCrypto)||{}}Xt.getBrowerCrypto=t;function e(){const n=t();return n.subtle||n.webkitSubtle}Xt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Xt.isBrowserCryptoAvailable=r,Xt}var Qt={},Lu;function sI(){if(Lu)return Qt;Lu=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.isBrowser=Qt.isNode=Qt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Qt.isReactNative=t;function e(){return typeof St<"u"&&typeof St.versions<"u"&&typeof St.versions.node<"u"}Qt.isNode=e;function r(){return!t()&&!e()}return Qt.isBrowser=r,Qt}var ju;function oI(){return ju||(ju=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=nI;e.__exportStar(iI(),t),e.__exportStar(sI(),t)})(To)),To}var aI=oI();function Ft(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Pr(t=6){return BigInt(Ft(t))}function sr(t,e,r){return{id:r||Ft(),jsonrpc:"2.0",method:t,params:e}}function ds(t,e){return{id:t,jsonrpc:"2.0",result:e}}function uc(t,e,r){return{id:t,jsonrpc:"2.0",error:cI(e)}}function cI(t,e){return typeof t>"u"?Mu(cp):(typeof t=="string"&&(t=Object.assign(Object.assign({},Mu(lc)),{message:t})),RS(t.code)&&(t=BS(t.code)),t)}class lI{}class uI extends lI{constructor(){super()}}class hI extends uI{constructor(e){super()}}const fI="^wss?:";function dI(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function pI(t,e){const r=dI(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function qu(t){return pI(t,fI)}function gI(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function hp(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function hc(t){return hp(t)&&"method"in t}function Ns(t){return hp(t)&&(Lt(t)||_t(t))}function Lt(t){return"result"in t}function _t(t){return"error"in t}class yI extends hI{constructor(e){super(e),this.events=new Vt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(sr(e.method,e.params||[],e.id||Pr().toString()),r)}async requestStrict(e,r){return new Promise(async(n,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{_t(s)?i(s.error):n(s.result)});try{await this.connection.send(e,r)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Ns(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const wI=()=>typeof WebSocket<"u"?WebSocket:typeof Y<"u"&&typeof Y.WebSocket<"u"?Y.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),mI=()=>typeof WebSocket<"u"||typeof Y<"u"&&typeof Y.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",zu=t=>t.split("?")[0],Vu=10,bI=wI();let vI=class{constructor(e){if(this.url=e,this.events=new Vt.EventEmitter,this.registering=!1,!qu(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(fi(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!qu(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{const i=aI.isReactNative()?void 0:{rejectUnauthorized:!gI(e)},s=new bI(e,[],i);mI()?s.onerror=o=>{const a=o;n(this.emitError(a.error))}:s.on("error",o=>{n(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Dn(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),i=n.message||n.toString(),s=uc(e,i);this.events.emit("payload",s)}parseError(e,r=this.url){return US(e,zu(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Vu&&this.events.setMaxListeners(Vu)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${zu(this.url)}`));return this.events.emit("register_error",r),r}};var EI={};const fp="wc",dp=2,Ea="core",zt=`${fp}@2:${Ea}:`,_I={logger:"error"},xI={database:":memory:"},SI="crypto",Ku="client_ed25519_seed",II=L.ONE_DAY,DI="keychain",OI="0.3",AI="messages",$I="0.3",TI=L.SIX_HOURS,PI="publisher",pp="irn",CI="error",gp="wss://relay.walletconnect.org",NI="relayer",ge={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},RI="_subscription",wt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},BI=.1,_a="2.23.5",he={link_mode:"link_mode",relay:"relay"},Hi={inbound:"inbound",outbound:"outbound"},UI="0.3",kI="WALLETCONNECT_CLIENT_ID",Hu="WALLETCONNECT_LINK_MODE_APPS",ut={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},MI="subscription",FI="0.3",LI="pairing",jI="0.3",jn={wc_pairingDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:L.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:L.ONE_DAY,prompt:!1,tag:0},res:{ttl:L.ONE_DAY,prompt:!1,tag:0}}},Hr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Ot={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},qI="history",zI="0.3",VI="expirer",bt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},KI="0.3",HI="verify-api",WI="https://verify.walletconnect.com",yp="https://verify.walletconnect.org",Xn=yp,GI=`${Xn}/v3`,YI=[WI,yp],ZI="echo",JI="https://echo.walletconnect.com",Mt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},tr={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},At={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},qr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},zr={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},qn={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},XI=.1,QI="event-client",e8=86400,t8="https://pulse.walletconnect.org/batch";function r8(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,w=0,m=0,_=d.length;m!==_&&d[m]===0;)m++,g++;for(var y=(_-m)*u+1>>>0,E=new Uint8Array(y);m!==_;){for(var I=d[m],O=0,N=y-1;(I!==0||O<w)&&N!==-1;N--,O++)I+=256*E[N]>>>0,E[N]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");w=O,m++}for(var R=y-w;R!==y&&E[R]===0;)R++;for(var P=c.repeat(g);R<y;++R)P+=t.charAt(E[R]);return P}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var w=0,m=0;d[g]===c;)w++,g++;for(var _=(d.length-g)*l+1>>>0,y=new Uint8Array(_);d[g];){var E=r[d.charCodeAt(g)];if(E===255)return;for(var I=0,O=_-1;(E!==0||I<m)&&O!==-1;O--,I++)E+=a*y[O]>>>0,y[O]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=I,g++}if(d[g]!==" "){for(var N=_-m;N!==_&&y[N]===0;)N++;for(var R=new Uint8Array(w+(_-N)),P=w;N!==_;)R[P++]=y[N++];return R}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var n8=r8,i8=n8;const wp=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},s8=t=>new TextEncoder().encode(t),o8=t=>new TextDecoder().decode(t);class a8{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class c8{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return mp(this,e)}}class l8{constructor(e){this.decoders=e}or(e){return mp(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const mp=(t,e)=>new l8({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class u8{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new a8(e,r,n),this.decoder=new c8(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Rs=({name:t,prefix:e,encode:r,decode:n})=>new u8(t,e,r,n),_i=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=i8(r,e);return Rs({prefix:t,name:e,encode:n,decode:s=>wp(i(s))})},h8=(t,e,r,n)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=i[t[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},f8=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},ke=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Rs({prefix:e,name:t,encode(i){return f8(i,n,r)},decode(i){return h8(i,n,r,t)}}),d8=Rs({prefix:"\0",name:"identity",encode:t=>o8(t),decode:t=>s8(t)});var p8=Object.freeze({__proto__:null,identity:d8});const g8=ke({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var y8=Object.freeze({__proto__:null,base2:g8});const w8=ke({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var m8=Object.freeze({__proto__:null,base8:w8});const b8=_i({prefix:"9",name:"base10",alphabet:"0123456789"});var v8=Object.freeze({__proto__:null,base10:b8});const E8=ke({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),_8=ke({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var x8=Object.freeze({__proto__:null,base16:E8,base16upper:_8});const S8=ke({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),I8=ke({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),D8=ke({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),O8=ke({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),A8=ke({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$8=ke({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),T8=ke({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),P8=ke({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),C8=ke({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var N8=Object.freeze({__proto__:null,base32:S8,base32upper:I8,base32pad:D8,base32padupper:O8,base32hex:A8,base32hexupper:$8,base32hexpad:T8,base32hexpadupper:P8,base32z:C8});const R8=_i({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),B8=_i({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var U8=Object.freeze({__proto__:null,base36:R8,base36upper:B8});const k8=_i({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),M8=_i({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var F8=Object.freeze({__proto__:null,base58btc:k8,base58flickr:M8});const L8=ke({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),j8=ke({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),q8=ke({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),z8=ke({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var V8=Object.freeze({__proto__:null,base64:L8,base64pad:j8,base64url:q8,base64urlpad:z8});const bp=Array.from(""),K8=bp.reduce((t,e,r)=>(t[r]=e,t),[]),H8=bp.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function W8(t){return t.reduce((e,r)=>(e+=K8[r],e),"")}function G8(t){const e=[];for(const r of t){const n=H8[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const Y8=Rs({prefix:"",name:"base256emoji",encode:W8,decode:G8});var Z8=Object.freeze({__proto__:null,base256emoji:Y8}),J8=vp,Wu=128,X8=-128,Q8=Math.pow(2,31);function vp(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Q8;)e[r++]=t&255|Wu,t/=128;for(;t&X8;)e[r++]=t&255|Wu,t>>>=7;return e[r]=t|0,vp.bytes=r-n+1,e}var eD=xa,tD=128,Gu=127;function xa(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw xa.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&Gu)<<i:(o&Gu)*Math.pow(2,i),i+=7}while(o>=tD);return xa.bytes=s-n,r}var rD=Math.pow(2,7),nD=Math.pow(2,14),iD=Math.pow(2,21),sD=Math.pow(2,28),oD=Math.pow(2,35),aD=Math.pow(2,42),cD=Math.pow(2,49),lD=Math.pow(2,56),uD=Math.pow(2,63),hD=function(t){return t<rD?1:t<nD?2:t<iD?3:t<sD?4:t<oD?5:t<aD?6:t<cD?7:t<lD?8:t<uD?9:10},fD={encode:J8,decode:eD,encodingLength:hD},Ep=fD;const Yu=(t,e,r=0)=>(Ep.encode(t,e,r),e),Zu=t=>Ep.encodingLength(t),Sa=(t,e)=>{const r=e.byteLength,n=Zu(t),i=n+Zu(r),s=new Uint8Array(i+r);return Yu(t,s,0),Yu(r,s,n),s.set(e,i),new dD(t,r,e,s)};class dD{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}}const _p=({name:t,code:e,encode:r})=>new pD(t,e,r);class pD{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Sa(this.code,r):r.then(n=>Sa(this.code,n))}else throw Error("Unknown type, must be binary type")}}const xp=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),gD=_p({name:"sha2-256",code:18,encode:xp("SHA-256")}),yD=_p({name:"sha2-512",code:19,encode:xp("SHA-512")});var wD=Object.freeze({__proto__:null,sha256:gD,sha512:yD});const Sp=0,mD="identity",Ip=wp,bD=t=>Sa(Sp,Ip(t)),vD={code:Sp,name:mD,encode:Ip,digest:bD};var ED=Object.freeze({__proto__:null,identity:vD});new TextEncoder,new TextDecoder;const Ju={...p8,...y8,...m8,...v8,...x8,...N8,...U8,...F8,...V8,...Z8};({...wD,...ED});function Dp(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function _D(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Dp(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Op(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Xu=Op("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Po=Op("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=_D(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),xD={utf8:Xu,"utf-8":Xu,hex:Ju.base16,latin1:Po,ascii:Po,binary:Po,...Ju};function SD(t,e="utf8"){const r=xD[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Dp(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var ID=Object.defineProperty,DD=(t,e,r)=>e in t?ID(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ut=(t,e,r)=>DD(t,typeof e!="symbol"?e+"":e,r);class OD{constructor(e,r){this.core=e,this.logger=r,Ut(this,"keychain",new Map),Ut(this,"name",DI),Ut(this,"version",OI),Ut(this,"initialized",!1),Ut(this,"storagePrefix",zt),Ut(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),Ut(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),Ut(this,"set",async(n,i)=>{this.isInitialized(),this.keychain.set(n,i),await this.persist()}),Ut(this,"get",n=>{this.isInitialized();const i=this.keychain.get(n);if(typeof i>"u"){const{message:s}=j("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return i}),Ut(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=pt(r,this.name)}get context(){return ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ia(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?sa(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var AD=Object.defineProperty,$D=(t,e,r)=>e in t?AD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Se=(t,e,r)=>$D(t,typeof e!="symbol"?e+"":e,r);class TD{constructor(e,r,n){this.core=e,this.logger=r,Se(this,"name",SI),Se(this,"keychain"),Se(this,"randomSessionIdentifier",ya()),Se(this,"initialized",!1),Se(this,"clientId"),Se(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Se(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),Se(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const i=await this.getClientSeed(),s=pl(i),o=hf(s.publicKey);return this.clientId=o,o}),Se(this,"generateKeyPair",()=>{this.isInitialized();const i=u3();return this.setPrivateKey(i.publicKey,i.privateKey)}),Se(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=pl(s),a=this.randomSessionIdentifier;return await Fb(a,i,II,o)}),Se(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=h3(a,s);return this.setSymKey(c,o)}),Se(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||Ki(i);return await this.keychain.set(o,i),o}),Se(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),Se(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),Se(this,"encode",async(i,s,o)=>{this.isInitialized();const a=rp(o),c=fi(s);if(Su(a))return p3(c,o==null?void 0:o.encoding);if(xu(a)){const f=a.senderPublicKey,p=a.receiverPublicKey;i=await this.generateSharedKey(f,p)}const l=this.getSymKey(i),{type:u,senderPublicKey:h}=a;return f3({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),Se(this,"decode",async(i,s,o)=>{this.isInitialized();const a=y3(s,o);if(Su(a)){const c=g3(s,o==null?void 0:o.encoding);return Dn(c)}if(xu(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;i=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(i),l=d3({symKey:c,encoded:s,encoding:o==null?void 0:o.encoding});return Dn(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Se(this,"getPayloadType",(i,s=tt)=>{const o=oi({encoded:i,encoding:s});return rn(o.type)}),Se(this,"getPayloadSenderPublicKey",(i,s=tt)=>{const o=oi({encoded:i,encoding:s});return o.senderPublicKey?st(o.senderPublicKey,We):void 0}),this.core=e,this.logger=pt(r,this.name),this.keychain=n||new OD(this.core,this.logger)}get context(){return ot(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Ku)}catch{e=ya(),await this.keychain.set(Ku,e)}return SD(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var PD=Object.defineProperty,CD=Object.defineProperties,ND=Object.getOwnPropertyDescriptors,Qu=Object.getOwnPropertySymbols,RD=Object.prototype.hasOwnProperty,BD=Object.prototype.propertyIsEnumerable,Ia=(t,e,r)=>e in t?PD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,UD=(t,e)=>{for(var r in e||(e={}))RD.call(e,r)&&Ia(t,r,e[r]);if(Qu)for(var r of Qu(e))BD.call(e,r)&&Ia(t,r,e[r]);return t},kD=(t,e)=>CD(t,ND(e)),at=(t,e,r)=>Ia(t,typeof e!="symbol"?e+"":e,r);class MD extends kw{constructor(e,r){super(e,r),this.logger=e,this.core=r,at(this,"messages",new Map),at(this,"messagesWithoutClientAck",new Map),at(this,"name",AI),at(this,"version",$I),at(this,"initialized",!1),at(this,"storagePrefix",zt),at(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),at(this,"set",async(n,i,s)=>{this.isInitialized();const o=Et(i);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(n,a),s===Hi.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,kD(UD({},c),{[o]:i}))}return await this.persist(),o}),at(this,"get",n=>{this.isInitialized();let i=this.messages.get(n);return typeof i>"u"&&(i={}),i}),at(this,"getWithoutAck",n=>{this.isInitialized();const i={};for(const s of n){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),at(this,"has",(n,i)=>{this.isInitialized();const s=this.get(n),o=Et(i);return typeof s[o]<"u"}),at(this,"ack",async(n,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(n);if(typeof s>"u")return;const o=Et(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,s),await this.persist()}),at(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=pt(e,this.name),this.core=r}get context(){return ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ia(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,ia(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?sa(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?sa(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var FD=Object.defineProperty,LD=Object.defineProperties,jD=Object.getOwnPropertyDescriptors,eh=Object.getOwnPropertySymbols,qD=Object.prototype.hasOwnProperty,zD=Object.prototype.propertyIsEnumerable,Da=(t,e,r)=>e in t?FD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gn=(t,e)=>{for(var r in e||(e={}))qD.call(e,r)&&Da(t,r,e[r]);if(eh)for(var r of eh(e))zD.call(e,r)&&Da(t,r,e[r]);return t},th=(t,e)=>LD(t,jD(e)),mt=(t,e,r)=>Da(t,typeof e!="symbol"?e+"":e,r);class VD extends Mw{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,mt(this,"events",new Vt.EventEmitter),mt(this,"name",PI),mt(this,"queue",new Map),mt(this,"publishTimeout",L.toMiliseconds(L.ONE_MINUTE)),mt(this,"initialPublishTimeout",L.toMiliseconds(L.ONE_SECOND*15)),mt(this,"needsTransportRestart",!1),mt(this,"publish",async(n,i,s)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:s}});const h=(s==null?void 0:s.ttl)||TI,f=(s==null?void 0:s.prompt)||!1,p=(s==null?void 0:s.tag)||0,d=(s==null?void 0:s.id)||Pr().toString(),g=vn(hs().protocol),w={id:d,method:(s==null?void 0:s.publishMethod)||g.publish,params:gn({topic:n,message:i,ttl:h,prompt:f,tag:p,attestation:s==null?void 0:s.attestation},s==null?void 0:s.tvf)},m=`Failed to publish payload, please try again. id:${d} tag:${p}`;try{Ae((o=w.params)==null?void 0:o.prompt)&&((a=w.params)==null||delete a.prompt),Ae((c=w.params)==null?void 0:c.tag)&&((l=w.params)==null||delete l.tag);const _=new Promise(async y=>{const E=({id:O})=>{var N;((N=w.id)==null?void 0:N.toString())===O.toString()&&(this.removeRequestFromQueue(O),this.relayer.events.removeListener(ge.publish,E),y())};this.relayer.events.on(ge.publish,E);const I=qt(new Promise((O,N)=>{this.rpcPublish(w,s).then(O).catch(R=>{this.logger.warn(R,R==null?void 0:R.message),N(R)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${p}`);try{await I,this.events.removeListener(ge.publish,E)}catch(O){this.queue.set(d,{request:w,opts:s,attempt:1}),this.logger.warn(O,O==null?void 0:O.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:n,message:i,opts:s}}),await qt(_,this.publishTimeout,m)}catch(_){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(_),(u=s==null?void 0:s.internal)!=null&&u.throwOnFailedPublish)throw _}finally{this.queue.delete(d)}}),mt(this,"publishCustom",async n=>{var i,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});const{payload:l,opts:u={}}=n,{attestation:h,tvf:f,publishMethod:p,prompt:d,tag:g,ttl:w=L.FIVE_MINUTES}=u,m=u.id||Pr().toString(),_=vn(hs().protocol),y=p||_.publish,E={id:m,method:y,params:gn(th(gn({},l),{ttl:w,prompt:d,tag:g,attestation:h}),f)},I=`Failed to publish custom payload, please try again. id:${m} tag:${g}`;try{Ae((i=E.params)==null?void 0:i.prompt)&&((s=E.params)==null||delete s.prompt),Ae((o=E.params)==null?void 0:o.tag)&&((a=E.params)==null||delete a.tag);const O=new Promise(async N=>{const R=({id:M})=>{var U;((U=E.id)==null?void 0:U.toString())===M.toString()&&(this.removeRequestFromQueue(M),this.relayer.events.removeListener(ge.publish,R),N())};this.relayer.events.on(ge.publish,R);const P=qt(new Promise((M,U)=>{this.rpcPublish(E,u).then(M).catch(C=>{this.logger.warn(C,C==null?void 0:C.message),U(C)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${y} id:${m} tag:${g}`);try{await P,this.events.removeListener(ge.publish,R)}catch(M){this.queue.set(m,{request:E,opts:u,attempt:1}),this.logger.warn(M,M==null?void 0:M.message)}});this.logger.trace({type:"method",method:"publish",params:{id:m,payload:l,opts:u}}),await qt(O,this.publishTimeout,I)}catch(O){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(O),(c=u==null?void 0:u.internal)!=null&&c.throwOnFailedPublish)throw O}finally{this.queue.delete(m)}}),mt(this,"on",(n,i)=>{this.events.on(n,i)}),mt(this,"once",(n,i)=>{this.events.once(n,i)}),mt(this,"off",(n,i)=>{this.events.off(n,i)}),mt(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.relayer=e,this.logger=pt(r,this.name),this.registerEventListeners()}get context(){return ot(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const n=await this.relayer.request(e);return this.relayer.events.emit(ge.publish,gn(gn({},e),r)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var n;const i=e.attempt+1;this.queue.set(r,th(gn({},e),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(on.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ge.connection_stalled);return}this.checkQueue()}),this.relayer.on(ge.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var KD=Object.defineProperty,HD=(t,e,r)=>e in t?KD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yn=(t,e,r)=>HD(t,typeof e!="symbol"?e+"":e,r);class WD{constructor(){yn(this,"map",new Map),yn(this,"set",(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),yn(this,"get",e=>this.map.get(e)||[]),yn(this,"exists",(e,r)=>this.get(e).includes(r)),yn(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const i=n.filter(s=>s!==r);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),yn(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var GD=Object.defineProperty,YD=Object.defineProperties,ZD=Object.getOwnPropertyDescriptors,rh=Object.getOwnPropertySymbols,JD=Object.prototype.hasOwnProperty,XD=Object.prototype.propertyIsEnumerable,Oa=(t,e,r)=>e in t?GD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zn=(t,e)=>{for(var r in e||(e={}))JD.call(e,r)&&Oa(t,r,e[r]);if(rh)for(var r of rh(e))XD.call(e,r)&&Oa(t,r,e[r]);return t},Co=(t,e)=>YD(t,ZD(e)),le=(t,e,r)=>Oa(t,typeof e!="symbol"?e+"":e,r);class QD extends jw{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,le(this,"subscriptions",new Map),le(this,"topicMap",new WD),le(this,"events",new Vt.EventEmitter),le(this,"name",MI),le(this,"version",FI),le(this,"pending",new Map),le(this,"cached",[]),le(this,"initialized",!1),le(this,"storagePrefix",zt),le(this,"subscribeTimeout",L.toMiliseconds(L.ONE_MINUTE)),le(this,"initialSubscribeTimeout",L.toMiliseconds(L.ONE_SECOND*15)),le(this,"clientId"),le(this,"batchSubscribeTopicsLimit",500),le(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),le(this,"subscribe",async(n,i)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}});try{const o=hs(i),a={topic:n,relay:o,transportType:i==null?void 0:i.transportType};(s=i==null?void 0:i.internal)!=null&&s.skipSubscribe||this.pending.set(n,a);const c=await this.rpcSubscribe(n,o,i);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),le(this,"unsubscribe",async(n,i)=>{this.isInitialized(),typeof(i==null?void 0:i.id)<"u"?await this.unsubscribeById(n,i.id,i):await this.unsubscribeByTopic(n,i)}),le(this,"isSubscribed",n=>new Promise(i=>{i(this.topicMap.topics.includes(n))})),le(this,"isKnownTopic",n=>new Promise(i=>{i(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(s=>s.topic===n))})),le(this,"on",(n,i)=>{this.events.on(n,i)}),le(this,"once",(n,i)=>{this.events.once(n,i)}),le(this,"off",(n,i)=>{this.events.off(n,i)}),le(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),le(this,"start",async()=>{await this.onConnect()}),le(this,"stop",async()=>{await this.onDisconnect()}),le(this,"restart",async()=>{await this.restore(),await this.onRestart()}),le(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(i=>{n.push(i)}),await this.batchSubscribe(n)}),le(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(on.pulse,async()=>{await this.checkPending()}),this.events.on(ut.created,async n=>{const i=ut.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()}),this.events.on(ut.deleted,async n=>{const i=ut.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()})}),this.relayer=e,this.logger=pt(r,this.name),this.clientId=""}get context(){return ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async i=>await this.unsubscribeById(e,i,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const i=hs(n);await this.restartToComplete({topic:e,id:r,relay:i}),await this.rpcUnsubscribe(e,r,i);const s=fe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,r,n){var i,s;const o=await this.getSubscriptionId(e);if((i=n==null?void 0:n.internal)!=null&&i.skipSubscribe)return o;(!n||(n==null?void 0:n.transportType)===he.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:vn(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(s=n==null?void 0:n.internal)==null?void 0:s.throwOnFailedPublish;try{if((n==null?void 0:n.transportType)===he.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},L.toMiliseconds(L.ONE_SECOND)),o;const l=new Promise(async h=>{const f=p=>{p.topic===e&&(this.events.removeListener(ut.created,f),h(p.id))};this.events.on(ut.created,f);try{const p=await qt(new Promise((d,g)=>{this.relayer.request(a).catch(w=>{this.logger.warn(w,w==null?void 0:w.message),g(w)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(ut.created,f),h(p)}catch{}}),u=await qt(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ge.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return!0;const r=e[0].relay,n={method:vn(r.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await qt(new Promise((i,s)=>{this.relayer.request(n).then(i).catch(o=>{this.logger.warn(o),s(o)})}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again"),!0}catch{return this.relayer.events.emit(ge.connection_stalled),!1}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,n={method:vn(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let i;try{i=await await qt(new Promise((s,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(ge.connection_stalled)}return i}rpcUnsubscribe(e,r,n){const i={method:vn(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,r){this.setSubscription(e,Co(zn({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,zn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,zn({},r)),this.topicMap.set(r.topic,e),this.events.emit(ut.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(ut.deleted,Co(zn({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(ut.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(ut.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var n;return r.topic===((n=this.subscriptions.get(r.id))==null?void 0:n.topic)})){const{message:r}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(e.length){if(!await this.rpcBatchSubscribe(e)){this.logger.warn(`Batch subscribe failed for ${e.length} topics, adding to pending for retry`),e.forEach(r=>{this.pending.set(r.topic,r)});return}this.onBatchSubscribe(await Promise.all(e.map(async r=>Co(zn({},r),{id:await this.getSubscriptionId(r.topic)}))))}}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await T2(L.toMiliseconds(L.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Et(e+await this.getClientId())}}var eO=Object.defineProperty,nh=Object.getOwnPropertySymbols,tO=Object.prototype.hasOwnProperty,rO=Object.prototype.propertyIsEnumerable,Aa=(t,e,r)=>e in t?eO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ih=(t,e)=>{for(var r in e||(e={}))tO.call(e,r)&&Aa(t,r,e[r]);if(nh)for(var r of nh(e))rO.call(e,r)&&Aa(t,r,e[r]);return t},ee=(t,e,r)=>Aa(t,typeof e!="symbol"?e+"":e,r);class nO extends Fw{constructor(e){var r;super(e),ee(this,"protocol","wc"),ee(this,"version",2),ee(this,"core"),ee(this,"logger"),ee(this,"events",new Vt.EventEmitter),ee(this,"provider"),ee(this,"messages"),ee(this,"subscriber"),ee(this,"publisher"),ee(this,"name",NI),ee(this,"transportExplicitlyClosed",!1),ee(this,"initialized",!1),ee(this,"connectionAttemptInProgress",!1),ee(this,"relayUrl"),ee(this,"projectId"),ee(this,"packageName"),ee(this,"bundleId"),ee(this,"hasExperiencedNetworkDisruption",!1),ee(this,"pingTimeout"),ee(this,"heartBeatTimeout",L.toMiliseconds(L.THIRTY_SECONDS+L.FIVE_SECONDS)),ee(this,"reconnectTimeout"),ee(this,"connectPromise"),ee(this,"reconnectInProgress",!1),ee(this,"requestsInFlight",[]),ee(this,"connectTimeout",L.toMiliseconds(L.ONE_SECOND*15)),ee(this,"stalledRestartInProgress",!1),ee(this,"stalledRestartTimeout"),ee(this,"stalledRestartBackoff",0),ee(this,"stalledRestartBaseInterval",L.toMiliseconds(L.ONE_SECOND*2)),ee(this,"stalledRestartMaxInterval",L.toMiliseconds(L.THIRTY_SECONDS)),ee(this,"request",async n=>{var i,s;this.logger.debug("Publishing Request Payload");const o=n.id||Pr().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:n.method,topic:(i=n.params)==null?void 0:i.topic},"relayer.request - publishing...");const a=`${o}:${((s=n.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),ee(this,"resetPingTimeout",()=>{ss()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,i,s,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||o.call(s)}catch(a){this.logger.warn(a,a==null?void 0:a.message)}},this.heartBeatTimeout))}),ee(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),ee(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(ge.connect)}),ee(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),ee(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(ge.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportExplicitlyClosed=!0,clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0,this.reconnectInProgress=!1,this.transportClose().catch(i=>this.logger.warn(i))}),ee(this,"registerProviderListeners",()=>{this.provider.on(wt.payload,this.onPayloadHandler),this.provider.on(wt.connect,this.onConnectHandler),this.provider.on(wt.disconnect,this.onDisconnectHandler),this.provider.on(wt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=ap({logger:(r=e.logger)!=null?r:CI,name:this.name}),this.messages=new MD(this.logger,e.core),this.subscriber=new QD(this,this.logger),this.publisher=new VD(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||gp,p2()?this.packageName=Kl():g2()&&(this.bundleId=Kl()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return ot(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:he.relay},Hi.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var n,i,s;this.isInitialized(),(!(r!=null&&r.transportType)||(r==null?void 0:r.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((n=r==null?void 0:r.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(ut.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(ut.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,ih({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,u()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await qt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,clearTimeout(this.stalledRestartTimeout),this.stalledRestartInProgress=!1,this.stalledRestartBackoff=0,await this.resetTransport()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.resetTransport(),await this.transportOpen())}async resetTransport(){this.reconnectInProgress=!0,clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0,await this.transportDisconnect(),await this.subscriber.stop(),this.reconnectInProgress=!1}async confirmOnlineStateOrThrow(){if(!await ku())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((n,i)=>n.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const n of r)try{await this.onMessageEvent(n)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+(i==null?void 0:i.message))}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:n}=e;if(!r.sessionExists){const i=Ee(L.FIVE_MINUTES),s={topic:n,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,s)}this.events.emit(ge.message,e),await this.recordMessageEvent(e,Hi.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(wt.disconnect,s),await qt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(wt.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(wt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(wt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const i=n;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,L.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,n,i,s;if(ss())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new yI(new vI(v2({sdkVersion:_a,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:n,message:i}=e;await this.messages.set(n,i,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const i=this.messages.has(r,n);return i&&this.logger.warn(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),hc(e)){if(!e.method.endsWith(RI))return;const r=e.params,{topic:n,message:i,publishedAt:s,attestation:o}=r.data,a={topic:n,message:i,publishedAt:s,transportType:he.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(ih({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Ns(e)&&this.events.emit(ge.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Hi.inbound),this.events.emit(ge.message,e))}async acknowledgePayload(e){const r=ds(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(wt.payload,this.onPayloadHandler),this.provider.off(wt.connect,this.onConnectHandler),this.provider.off(wt.disconnect,this.onDisconnectHandler),this.provider.off(wt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await ku();wS(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n==null?void 0:n.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(on.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&vS())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r==null?void 0:r.message)}}),this.events.on(ge.connection_stalled,()=>{if(this.transportExplicitlyClosed||this.stalledRestartInProgress)return;this.stalledRestartInProgress=!0;const r=this.stalledRestartBackoff===0?0:Math.min(Math.pow(2,this.stalledRestartBackoff-1)*this.stalledRestartBaseInterval,this.stalledRestartMaxInterval);this.stalledRestartBackoff++,this.logger.warn(`Connection stalled, restarting transport${r?` in ${r}ms`:""}...`),this.stalledRestartTimeout=setTimeout(async()=>{try{if(this.transportExplicitlyClosed)return;await this.restartTransport()}catch(n){this.logger.error(n,n==null?void 0:n.message)}finally{this.stalledRestartInProgress=!1}},r)})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(ge.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},L.toMiliseconds(BI)))))}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function iO(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function sh(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function oh(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const sO="[object RegExp]",oO="[object String]",aO="[object Number]",cO="[object Boolean]",ah="[object Arguments]",lO="[object Symbol]",uO="[object Date]",hO="[object Map]",fO="[object Set]",dO="[object Array]",pO="[object Function]",gO="[object ArrayBuffer]",No="[object Object]",yO="[object Error]",wO="[object DataView]",mO="[object Uint8Array]",bO="[object Uint8ClampedArray]",vO="[object Uint16Array]",EO="[object Uint32Array]",_O="[object BigUint64Array]",xO="[object Int8Array]",SO="[object Int16Array]",IO="[object Int32Array]",DO="[object BigInt64Array]",OO="[object Float32Array]",AO="[object Float64Array]";function ch(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function $O(t,e,r){return Wn(t,e,void 0,void 0,void 0,void 0,r)}function Wn(t,e,r,n,i,s,o){const a=o(t,e,r,n,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Qn(t,e,s,o)}return Qn(t,e,s,o)}function Qn(t,e,r,n){if(Object.is(t,e))return!0;let i=oh(t),s=oh(e);if(i===ah&&(i=No),s===ah&&(s=No),i!==s)return!1;switch(i){case oO:return t.toString()===e.toString();case aO:{const c=t.valueOf(),l=e.valueOf();return iO(c,l)}case cO:case uO:case lO:return Object.is(t.valueOf(),e.valueOf());case sO:return t.source===e.source&&t.flags===e.flags;case pO:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(i){case hO:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!Wn(l,e.get(c),c,t,e,r,n))return!1;return!0}case fO:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],f=l.findIndex(p=>Wn(h,p,void 0,t,e,r,n));if(f===-1)return!1;l.splice(f,1)}return!0}case dO:case mO:case bO:case vO:case EO:case _O:case xO:case SO:case IO:case DO:case OO:case AO:{if(typeof ie<"u"&&ie.isBuffer(t)!==ie.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Wn(t[c],e[c],c,t,e,r,n))return!1;return!0}case gO:return t.byteLength!==e.byteLength?!1:Qn(new Uint8Array(t),new Uint8Array(e),r,n);case wO:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Qn(new Uint8Array(t),new Uint8Array(e),r,n);case yO:return t.name===e.name&&t.message===e.message;case No:{if(!(Qn(t.constructor,e.constructor,r,n)||ch(t)&&ch(e)))return!1;const c=[...Object.keys(t),...sh(t)],l=[...Object.keys(e),...sh(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],f=t[h];if(!Object.hasOwn(e,h))return!1;const p=e[h];if(!Wn(f,p,h,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function TO(){}function PO(t,e){return $O(t,e,TO)}var CO=Object.defineProperty,lh=Object.getOwnPropertySymbols,NO=Object.prototype.hasOwnProperty,RO=Object.prototype.propertyIsEnumerable,$a=(t,e,r)=>e in t?CO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,uh=(t,e)=>{for(var r in e||(e={}))NO.call(e,r)&&$a(t,r,e[r]);if(lh)for(var r of lh(e))RO.call(e,r)&&$a(t,r,e[r]);return t},Ye=(t,e,r)=>$a(t,typeof e!="symbol"?e+"":e,r);class ln extends Lw{constructor(e,r,n,i=zt,s=void 0){super(e,r,n,i),this.core=e,this.logger=r,this.name=n,Ye(this,"map",new Map),Ye(this,"version",UI),Ye(this,"cached",[]),Ye(this,"initialized",!1),Ye(this,"getKey"),Ye(this,"storagePrefix",zt),Ye(this,"recentlyDeleted",[]),Ye(this,"recentlyDeletedLimit",200),Ye(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ae(o)?this.map.set(this.getKey(o),o):G3(o)?this.map.set(o.id,o):Y3(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ye(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ye(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ye(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>PO(a[c],o[c]))):this.values)),Ye(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=uh(uh({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ye(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=pt(r,this.name),this.storagePrefix=i,this.getKey=s}get context(){return ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:i}=j("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:n}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var BO=Object.defineProperty,UO=(t,e,r)=>e in t?BO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,te=(t,e,r)=>UO(t,typeof e!="symbol"?e+"":e,r);class kO{constructor(e,r){this.core=e,this.logger=r,te(this,"name",LI),te(this,"version",jI),te(this,"events",new bh),te(this,"pairings"),te(this,"initialized",!1),te(this,"storagePrefix",zt),te(this,"ignoredPayloadTypes",[ur]),te(this,"registeredMethods",[]),te(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),te(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),te(this,"create",async n=>{this.isInitialized();const i=ya(),s=await this.core.crypto.setSymKey(i),o=Ee(L.FIVE_MINUTES),a={protocol:pp},c={topic:s,expiry:o,relay:a,active:!1,methods:n==null?void 0:n.methods},l=Au({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:n==null?void 0:n.methods});return this.events.emit(Hr.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:n==null?void 0:n.transportType,internal:n==null?void 0:n.internal}),{topic:s,uri:l}}),te(this,"pair",async n=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:n==null?void 0:n.uri,trace:[Mt.pairing_started]}});this.isValidPair(n,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:l}=Ou(n.uri);i.props.properties.topic=s,i.addTrace(Mt.pairing_uri_validation_success),i.addTrace(Mt.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(s)){if(u=this.pairings.get(s),i.addTrace(Mt.existing_pairing),u.active)throw i.setError(tr.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(Mt.pairing_not_expired)}const h=c||Ee(L.FIVE_MINUTES),f={topic:s,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(s,h),await this.pairings.set(s,f),i.addTrace(Mt.store_new_pairing),n.activatePairing&&await this.activate({topic:s}),this.events.emit(Hr.create,f),i.addTrace(Mt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(Mt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(tr.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(p){throw i.setError(tr.subscribe_pairing_topic_failure),p}return i.addTrace(Mt.subscribe_pairing_topic_success),f}),te(this,"activate",async({topic:n})=>{this.isInitialized();const i=Ee(L.FIVE_MINUTES);this.core.expirer.set(n,i),await this.pairings.update(n,{active:!0,expiry:i})}),te(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=n;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Vr();this.events.once(ae("pairing_ping",s),({error:l})=>{l?c(l):a()}),await o()}}),te(this,"updateExpiry",async({topic:n,expiry:i})=>{this.isInitialized(),await this.pairings.update(n,{expiry:i})}),te(this,"updateMetadata",async({topic:n,metadata:i})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:i})}),te(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),te(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:i}=n;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",fe("USER_DISCONNECTED")),await this.deletePairing(i))}),te(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(i);return Au({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),te(this,"sendRequest",async(n,i,s)=>{const o=sr(i,s),a=await this.core.crypto.encode(n,o),c=jn[i].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),te(this,"sendResult",async(n,i,s)=>{const o=ds(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,l=jn[c].res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),te(this,"sendError",async(n,i,s)=>{const o=uc(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,l=jn[c]?jn[c].res:jn.unregistered_method.res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),te(this,"deletePairing",async(n,i)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,fe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),i?Promise.resolve():this.core.expirer.del(n)])}),te(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(i=>xr(i.expiry));await Promise.all(n.map(i=>this.deletePairing(i.topic)))}),te(this,"onRelayEventRequest",async n=>{const{topic:i,payload:s}=n;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),te(this,"onRelayEventResponse",async n=>{const{topic:i,payload:s}=n,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),te(this,"onPairingPingRequest",async(n,i)=>{const{id:s}=i;try{this.isValidPing({topic:n}),await this.sendResult(s,n,!0),this.events.emit(Hr.ping,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),te(this,"onPairingPingResponse",(n,i)=>{const{id:s}=i;setTimeout(()=>{Lt(i)?this.events.emit(ae("pairing_ping",s),{}):_t(i)&&this.events.emit(ae("pairing_ping",s),{error:i.error})},500)}),te(this,"onPairingDeleteRequest",async(n,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Hr.delete,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),te(this,"onUnknownRpcMethodRequest",async(n,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=fe("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,n,a),this.logger.error(a)}catch(a){await this.sendError(s,n,a),this.logger.error(a)}}),te(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(fe("WC_METHOD_UNSUPPORTED",n))}),te(this,"isValidPair",(n,i)=>{var s;if(!Xe(n)){const{message:a}=j("MISSING_OR_INVALID",`pair() params: ${n}`);throw i.setError(tr.malformed_pairing_uri),new Error(a)}if(!W3(n.uri)){const{message:a}=j("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw i.setError(tr.malformed_pairing_uri),new Error(a)}const o=Ou(n==null?void 0:n.uri);if(!((s=o==null?void 0:o.relay)!=null&&s.protocol)){const{message:a}=j("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(tr.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=j("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(tr.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&L.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){i.setError(tr.pairing_expired);const{message:a}=j("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),te(this,"isValidPing",async n=>{if(!Xe(n)){const{message:s}=j("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),te(this,"isValidDisconnect",async n=>{if(!Xe(n)){const{message:s}=j("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),te(this,"isValidPairingTopic",async n=>{if(!me(n,!1)){const{message:i}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(i)}if(!this.pairings.keys.includes(n)){const{message:i}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(i)}if(xr(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:i}=j("EXPIRED",`pairing topic: ${n}`);throw new Error(i)}}),this.core=e,this.logger=pt(r,this.name),this.pairings=new ln(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ot(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(ge.message,async e=>{const{topic:r,message:n,transportType:i}=e;if(this.pairings.keys.includes(r)&&i!==he.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const s=await this.core.crypto.decode(r,n);hc(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):Ns(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,n)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(bt.expired,async e=>{const{topic:r}=id(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Hr.expire,{topic:r}))})}}var MO=Object.defineProperty,FO=(t,e,r)=>e in t?MO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pe=(t,e,r)=>FO(t,typeof e!="symbol"?e+"":e,r);class LO extends Uw{constructor(e,r){super(e,r),this.core=e,this.logger=r,Pe(this,"records",new Map),Pe(this,"events",new Vt.EventEmitter),Pe(this,"name",qI),Pe(this,"version",zI),Pe(this,"cached",[]),Pe(this,"initialized",!1),Pe(this,"storagePrefix",zt),Pe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Pe(this,"set",(n,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:n,request:{method:i.method,params:i.params||null},chainId:s,expiry:Ee(L.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Ot.created,o)}),Pe(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const i=await this.getRecord(n.id);typeof i.response>"u"&&(i.response=_t(n)?{error:n.error}:{result:n.result},this.records.set(i.id,i),this.persist(),this.events.emit(Ot.updated,i))}),Pe(this,"get",async(n,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:i}),await this.getRecord(i))),Pe(this,"delete",(n,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===n){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(Ot.deleted,s)}}),this.persist()}),Pe(this,"exists",async(n,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===n:!1)),Pe(this,"on",(n,i)=>{this.events.on(n,i)}),Pe(this,"once",(n,i)=>{this.events.once(n,i)}),Pe(this,"off",(n,i)=>{this.events.off(n,i)}),Pe(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=pt(r,this.name)}get context(){return ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:sr(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Ot.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Ot.created,e=>{const r=Ot.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Ot.updated,e=>{const r=Ot.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Ot.deleted,e=>{const r=Ot.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(on.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{L.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(Ot.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var jO=Object.defineProperty,qO=(t,e,r)=>e in t?jO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qe=(t,e,r)=>qO(t,typeof e!="symbol"?e+"":e,r);class zO extends qw{constructor(e,r){super(e,r),this.core=e,this.logger=r,qe(this,"expirations",new Map),qe(this,"events",new Vt.EventEmitter),qe(this,"name",VI),qe(this,"version",KI),qe(this,"cached",[]),qe(this,"initialized",!1),qe(this,"storagePrefix",zt),qe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),qe(this,"has",n=>{try{const i=this.formatTarget(n);return typeof this.getExpiration(i)<"u"}catch{return!1}}),qe(this,"set",(n,i)=>{this.isInitialized();const s=this.formatTarget(n),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(bt.created,{target:s,expiration:o})}),qe(this,"get",n=>{this.isInitialized();const i=this.formatTarget(n);return this.getExpiration(i)}),qe(this,"del",n=>{if(this.isInitialized(),this.has(n)){const i=this.formatTarget(n),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(bt.deleted,{target:i,expiration:s})}}),qe(this,"on",(n,i)=>{this.events.on(n,i)}),qe(this,"once",(n,i)=>{this.events.once(n,i)}),qe(this,"off",(n,i)=>{this.events.off(n,i)}),qe(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=pt(r,this.name)}get context(){return ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return E2(e);if(typeof e=="number")return _2(e);const{message:r}=j("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(bt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;L.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(bt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(on.pulse,()=>this.checkExpirations()),this.events.on(bt.created,e=>{const r=bt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(bt.expired,e=>{const r=bt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(bt.deleted,e=>{const r=bt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var VO=Object.defineProperty,KO=(t,e,r)=>e in t?VO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,we=(t,e,r)=>KO(t,typeof e!="symbol"?e+"":e,r);class HO extends zw{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,we(this,"name",HI),we(this,"abortController"),we(this,"isDevEnv"),we(this,"verifyUrlV3",GI),we(this,"storagePrefix",zt),we(this,"version",dp),we(this,"publicKey"),we(this,"fetchPromise"),we(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&L.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),we(this,"register",async i=>{if(!Tn()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const l=hr.getDocument(),u=this.startAbortTimer(L.ONE_SECOND*5),h=await new Promise((f,p)=>{const d=()=>{window.removeEventListener("message",w),l.body.removeChild(g),p("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",d,{signal:this.abortController.signal});const w=m=>{if(m.data&&typeof m.data=="string")try{const _=JSON.parse(m.data);if(_.type==="verify_attestation"){if(Yo(_.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",w),f(_.attestation===null?"":_.attestation)}}catch(_){this.logger.warn(_)}};l.body.appendChild(g),window.addEventListener("message",w,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(l){this.logger.warn(l)}return""}),we(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(Yo(s).payload.id!==a)return;const l=await this.isValidJwtAttestation(s);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(i==null?void 0:i.verifyUrl);return this.fetchAttestation(o,c)}),we(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(L.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),we(this,"getVerifyUrl",i=>{let s=i||Xn;return YI.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Xn}`),s=Xn),s}),we(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(L.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),we(this,"persistPublicKey",async i=>{this.logger.debug(i,"persisting public key to local storage"),await this.store.setItem(this.storeKey,i),this.publicKey=i}),we(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),we(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),we(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),we(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),we(this,"validateAttestation",(i,s)=>{const o=m3(i,s.publicKey),a={hasExpired:L.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=pt(r,this.name),this.abortController=new AbortController,this.isDevEnv=Xa(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return ot(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),L.toMiliseconds(e))}}var WO=Object.defineProperty,GO=(t,e,r)=>e in t?WO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hh=(t,e,r)=>GO(t,typeof e!="symbol"?e+"":e,r);class YO extends Vw{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,hh(this,"context",ZI),hh(this,"registerDeviceToken",async n=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=n,c=`${JI}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=pt(r,this.context)}}var ZO=Object.defineProperty,fh=Object.getOwnPropertySymbols,JO=Object.prototype.hasOwnProperty,XO=Object.prototype.propertyIsEnumerable,Ta=(t,e,r)=>e in t?ZO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vn=(t,e)=>{for(var r in e||(e={}))JO.call(e,r)&&Ta(t,r,e[r]);if(fh)for(var r of fh(e))XO.call(e,r)&&Ta(t,r,e[r]);return t},Ie=(t,e,r)=>Ta(t,typeof e!="symbol"?e+"":e,r);class QO extends Kw{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,Ie(this,"context",QI),Ie(this,"storagePrefix",zt),Ie(this,"storageVersion",XI),Ie(this,"events",new Map),Ie(this,"shouldPersist",!1),Ie(this,"init",async()=>{if(!Xa())try{const i={eventId:Wl(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:rd(this.core.relayer.protocol,this.core.relayer.version,_a)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),Ie(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,l=Wl(),u=this.core.projectId||"",h=Date.now(),f=Vn({eventId:l,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,f),this.shouldPersist=!0),f}),Ie(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Vn(Vn({},a),this.setMethods(a.eventId))}),Ie(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),Ie(this,"setEventListeners",()=>{this.core.heartbeat.on(on.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{L.fromMiliseconds(Date.now())-L.fromMiliseconds(i.timestamp)>e8&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),Ie(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),Ie(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),Ie(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),Ie(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ie(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,Vn(Vn({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),Ie(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Ie(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${t8}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${_a}${s}`,{method:"POST",body:JSON.stringify(i)})}),Ie(this,"getAppDomain",()=>td().url),this.logger=pt(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var eA=Object.defineProperty,dh=Object.getOwnPropertySymbols,tA=Object.prototype.hasOwnProperty,rA=Object.prototype.propertyIsEnumerable,Pa=(t,e,r)=>e in t?eA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ph=(t,e)=>{for(var r in e||(e={}))tA.call(e,r)&&Pa(t,r,e[r]);if(dh)for(var r of dh(e))rA.call(e,r)&&Pa(t,r,e[r]);return t},ue=(t,e,r)=>Pa(t,typeof e!="symbol"?e+"":e,r);class fc extends Cw{constructor(e){var r;super(e),ue(this,"protocol",fp),ue(this,"version",dp),ue(this,"name",Ea),ue(this,"relayUrl"),ue(this,"projectId"),ue(this,"customStoragePrefix"),ue(this,"events",new Vt.EventEmitter),ue(this,"logger"),ue(this,"heartbeat"),ue(this,"relayer"),ue(this,"crypto"),ue(this,"storage"),ue(this,"history"),ue(this,"expirer"),ue(this,"pairing"),ue(this,"verify"),ue(this,"echoClient"),ue(this,"linkModeSupportedApps"),ue(this,"eventClient"),ue(this,"initialized",!1),ue(this,"logChunkController"),ue(this,"on",(a,c)=>this.events.on(a,c)),ue(this,"once",(a,c)=>this.events.once(a,c)),ue(this,"off",(a,c)=>this.events.off(a,c)),ue(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),ue(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:he.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const n=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||gp,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=Iw({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:_I.logger,name:Ea}),{logger:s,chunkLoggerController:o}=Bh({opts:i,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=pt(s,this.name),this.heartbeat=new iy,this.crypto=new TD(this,this.logger,e==null?void 0:e.keychain),this.history=new LO(this,this.logger),this.expirer=new zO(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Ly(ph(ph({},xI),e==null?void 0:e.storageOptions)),this.relayer=new nO({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new kO(this,this.logger),this.verify=new HO(this,this.logger,this.storage),this.echoClient=new YO(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new QO(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new fc(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(kI,n),r}get context(){return ot(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Hu,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Hu)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof St<"u"&&EI.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const nA=fc,Ap="wc",$p=2,Tp="client",dc=`${Ap}@${$p}:${Tp}:`,Ro={name:Tp,logger:"error"},gh="WALLETCONNECT_DEEPLINK_CHOICE",iA="proposal",yh="Proposal expired",sA="session",wn=L.SEVEN_DAYS,oA="engine",Ce={wc_sessionPropose:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1104},res:{ttl:L.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1106},res:{ttl:L.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1112},res:{ttl:L.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1114},res:{ttl:L.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:L.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:L.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1119}}},Bo={min:L.FIVE_MINUTES,max:L.SEVEN_DAYS},kt={idle:"IDLE",active:"ACTIVE"},aA={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},cA="request",lA=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],uA="wc",hA="auth",fA="authKeys",dA="pairingTopics",pA="requests",Bs=`${uA}@${1.5}:${hA}:`,Wi=`${Bs}:PUB_KEY`;var gA=Object.defineProperty,yA=Object.defineProperties,wA=Object.getOwnPropertyDescriptors,wh=Object.getOwnPropertySymbols,mA=Object.prototype.hasOwnProperty,bA=Object.prototype.propertyIsEnumerable,Ca=(t,e,r)=>e in t?gA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,se=(t,e)=>{for(var r in e||(e={}))mA.call(e,r)&&Ca(t,r,e[r]);if(wh)for(var r of wh(e))bA.call(e,r)&&Ca(t,r,e[r]);return t},Ne=(t,e)=>yA(t,wA(e)),F=(t,e,r)=>Ca(t,typeof e!="symbol"?e+"":e,r);class vA extends Yw{constructor(e){super(e),F(this,"name",oA),F(this,"events",new bh),F(this,"initialized",!1),F(this,"requestQueue",{state:kt.idle,queue:[]}),F(this,"sessionRequestQueue",{state:kt.idle,queue:[]}),F(this,"emittedSessionRequests",new P2({limit:500})),F(this,"requestQueueDelay",L.ONE_SECOND),F(this,"expectedPairingMethodMap",new Map),F(this,"recentlyDeletedMap",new Map),F(this,"recentlyDeletedLimit",200),F(this,"relayMessageCache",[]),F(this,"pendingSessions",new Map),F(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Ce)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay)))}),F(this,"connect",async r=>{var n;this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Ne(se({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=q3(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:l,relays:u,authentication:h,walletPay:f}=i,p=((n=h==null?void 0:h[0])==null?void 0:n.ttl)||Ce.wc_sessionPropose.req.ttl||L.FIVE_MINUTES;this.validateRequestExpiry(p);let d=s,g,w=!1;try{if(d){const P=this.client.core.pairing.pairings.get(d);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),w=P.active}}catch(P){throw this.client.logger.error(`connect() -> pairing.get(${d}) failed`),P}if(!d||!w){const{topic:P,uri:M}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});d=P,g=M}if(!d){const{message:P}=j("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(P)}const m=await this.client.core.crypto.generateKeyPair(),_=Ee(p),y=se(Ne(se(se({requiredNamespaces:o,optionalNamespaces:a,relays:u??[{protocol:pp}],proposer:{publicKey:m,metadata:this.client.metadata},expiryTimestamp:_,pairingTopic:d},c&&{sessionProperties:c}),l&&{scopedProperties:l}),{id:Ft()}),(h||f)&&{requests:{authentication:h==null?void 0:h.map(P=>{const{domain:M,chains:U,nonce:C,uri:D,exp:T,nbf:v,type:b,statement:S,requestId:$,resources:x,signatureTypes:A}=P;return{domain:M,chains:U,nonce:C,type:b??"caip122",aud:D,version:"1",iat:new Date().toISOString(),exp:T,nbf:v,statement:S,requestId:$,resources:x,signatureTypes:A}}),walletPay:f}}),E=ae("session_connect",y.id),{reject:I,resolve:O,done:N}=Vr(p,yh),R=({id:P})=>{P===y.id&&(this.client.events.off("proposal_expire",R),this.pendingSessions.delete(y.id),this.events.emit(E,{error:{message:yh,code:0}}))};return this.client.events.on("proposal_expire",R),this.events.once(E,({error:P,session:M})=>{this.client.events.off("proposal_expire",R),P?I(P):M&&O(M)}),await this.setProposal(y.id,y),await this.sendProposeSession({proposal:y,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:y.id}}}).catch(P=>{throw this.deleteProposal(y.id),P}),{uri:g,approval:N}}),F(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(n){throw this.client.logger.error("pair() failed"),n}}),F(this,"approve",async r=>{var n,i,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(n=r==null?void 0:r.id)==null?void 0:n.toString(),trace:[At.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(M){throw o.setError(qr.no_internet_connection),M}try{await this.isValidProposalId(r==null?void 0:r.id)}catch(M){throw this.client.logger.error(`approve() -> proposal.get(${r==null?void 0:r.id}) failed`),o.setError(qr.proposal_not_found),M}try{await this.isValidApprove(r)}catch(M){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(qr.session_approve_namespace_validation_failure),M}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:p}=r,d=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:g,proposer:w,requiredNamespaces:m,optionalNamespaces:_}=d;let y=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:g});y||(y=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:At.session_approve_started,properties:{topic:g,trace:[At.session_approve_started,At.session_namespaces_validation_success]}}));const E=await this.client.core.crypto.generateKeyPair(),I=w.publicKey,O=await this.client.core.crypto.generateSharedKey(E,I),N=Ne(se(se(se({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:E,metadata:this.client.metadata},expiry:Ee(wn)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{proposalRequestsResponses:p}),R=he.relay;y.addTrace(At.subscribing_session_topic);try{await this.client.core.relayer.subscribe(O,{transportType:R,internal:{skipSubscribe:!0}})}catch(M){throw y.setError(qr.subscribe_session_topic_failure),M}y.addTrace(At.subscribe_session_topic_success);const P=Ne(se({},N),{topic:O,requiredNamespaces:m,optionalNamespaces:_,pairingTopic:g,acknowledged:!1,self:N.controller,peer:{publicKey:w.publicKey,metadata:w.metadata},controller:E,transportType:he.relay,authentication:p==null?void 0:p.authentication,walletPayResult:p==null?void 0:p.walletPay});await this.client.session.set(O,P),y.addTrace(At.store_session);try{await this.sendApproveSession({sessionTopic:O,proposal:d,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:E},sessionSettleRequest:N,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:se({correlationId:a},this.getTVFApproveParams(P))}}),y.addTrace(At.session_approve_publish_success)}catch(M){throw this.client.logger.error(M),this.client.session.delete(O,fe("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(O),M}return this.client.core.eventClient.deleteEvent({eventId:y.eventId}),await this.client.core.pairing.updateMetadata({topic:g,metadata:w.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:g}),await this.setExpiry(O,Ee(wn)),{topic:O,acknowledged:()=>Promise.resolve(this.client.session.get(O))}}),F(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:i}=r;let s;try{s=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}s&&await this.sendError({id:n,topic:s,error:i,rpcOpts:Ce.wc_sessionPropose.reject}),await this.deleteProposal(n)}),F(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:n,namespaces:i}=r,{done:s,resolve:o,reject:a}=Vr(L.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=Ft(),l=Pr().toString(),u=this.client.session.get(n).namespaces;return this.events.once(ae("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(n,{namespaces:i}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(n,{namespaces:u}),a(h)}),{acknowledged:s}}),F(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=r,i=Ft(),{done:s,resolve:o,reject:a}=Vr(L.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(ae("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,Ee(wn)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),F(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(w){throw this.client.logger.error("request() -> isValidRequest() failed"),w}const{chainId:n,request:i,topic:s,expiry:o=Ce.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(s);(a==null?void 0:a.transportType)===he.relay&&await this.confirmOnlineStateOrThrow();const c=Ft(),l=Pr().toString(),{done:u,resolve:h,reject:f}=Vr(o,"Request expired. Please try again.");this.events.once(ae("session_request",c),({error:w,result:m})=>{w?f(w):h(m)});const p="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:p,params:{request:Ne(se({},i),{expiryTimestamp:Ee(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(w=>f(w)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:n,id:c}),await u();const g={request:Ne(se({},i),{expiryTimestamp:Ee(o)}),chainId:n};return await Promise.all([new Promise(async w=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:p,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(m=>f(m)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:n,id:c}),w()}),new Promise(async w=>{var m;if(!((m=a.sessionConfig)!=null&&m.disableDeepLink)){const _=await D2(this.client.core.storage,gh);await x2({id:c,topic:s,wcDeepLink:_})}w()}),u()]).then(w=>w[2])}),F(this,"respond",async r=>{var n,i;this.isInitialized();const s=this.client.core.eventClient.createEvent({properties:{topic:(r==null?void 0:r.topic)||((i=(n=r==null?void 0:r.response)==null?void 0:n.id)==null?void 0:i.toString()),trace:[At.session_request_response_started]}});try{await this.isValidRespond(r)}catch(h){throw s.addTrace(h==null?void 0:h.message),s.setError(qr.session_request_response_validation_failure),h}s.addTrace(At.session_request_response_validation_success);const{topic:o,response:a}=r,{id:c}=a,l=this.client.session.get(o);l.transportType===he.relay&&await this.confirmOnlineStateOrThrow();const u=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);try{s.addTrace(At.session_request_response_publish_started),Lt(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:u}):_t(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:u}),this.cleanupAfterResponse(r)}catch(h){throw s.addTrace(h==null?void 0:h.message),s.setError(qr.session_request_response_publish_failure),h}}),F(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:n}=r;if(this.client.session.keys.includes(n)){const i=Ft(),s=Pr().toString(),{done:o,resolve:a,reject:c}=Vr(L.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(ae("session_ping",i),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),F(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:n,event:i,chainId:s}=r,o=Pr().toString(),a=Ft();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),F(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:n}=r;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:fe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:i}=j("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(i)}}),F(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(n=>K3(n,r)))),F(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),F(this,"authenticate",async(r,n)=>{var i;this.isInitialized(),this.isValidAuthenticate(r);const s=n&&this.client.core.linkModeSupportedApps.includes(n)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=s?he.link_mode:he.relay;o===he.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:f,exp:p,nbf:d,methods:g=[],expiry:w}=r,m=[...r.resources||[]],{topic:_,uri:y}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:_,uri:y}});const E=await this.client.core.crypto.generateKeyPair(),I=Ki(E);if(await Promise.all([this.client.auth.authKeys.set(Wi,{responseTopic:I,publicKey:E}),this.client.auth.pairingTopics.set(I,{topic:I,pairingTopic:_})]),await this.client.core.relayer.subscribe(I,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${_}`),g.length>0){const{namespace:x}=zi(a[0]);let A=V_(x,"request",g);Vi(m)&&(A=H_(A,m.pop())),m.push(A)}const O=w&&w>Ce.wc_sessionAuthenticate.req.ttl?w:Ce.wc_sessionAuthenticate.req.ttl,N={authPayload:{type:f??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:d,resources:m},requester:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:Ee(O)},R={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},P={requiredNamespaces:{},optionalNamespaces:R,relays:[{protocol:"irn"}],pairingTopic:_,proposer:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:Ee(Ce.wc_sessionPropose.req.ttl),id:Ft()},{done:M,resolve:U,reject:C}=Vr(O,"Request expired"),D=Ft(),T=ae("session_connect",P.id),v=ae("session_request",D),b=async({error:x,session:A})=>{this.events.off(v,S),x?C(x):A&&U({session:A})},S=async x=>{var A,B,k;if(await this.deletePendingAuthRequest(D,{message:"fulfilled",code:0}),x.error){const W=fe("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return x.error.code===W.code?void 0:(this.events.off(T,b),C(x.error.message))}await this.deleteProposal(P.id),this.events.off(T,b);const{cacaos:K,responder:z}=x.result,q=[],H=[];for(const W of K){await iu({cacao:W,projectId:this.client.core.projectId})||(this.client.logger.error(W,"Signature verification failed"),C(fe("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Q}=W,pe=Vi(Q.resources),be=[oa(Q.iss)],xe=as(Q.iss);if(pe){const Ve=su(pe),Kt=ou(pe);q.push(...Ve),be.push(...Kt)}for(const Ve of be)H.push(`${Ve}:${xe}`)}const G=await this.client.core.crypto.generateSharedKey(E,z.publicKey);let X;q.length>0&&(X={topic:G,acknowledged:!0,self:{publicKey:E,metadata:this.client.metadata},peer:z,controller:z.publicKey,expiry:Ee(wn),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:_,namespaces:Cu([...new Set(q)],[...new Set(H)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,X),_&&await this.client.core.pairing.updateMetadata({topic:_,metadata:z.metadata}),X=this.client.session.get(G)),(A=this.client.metadata.redirect)!=null&&A.linkMode&&(B=z.metadata.redirect)!=null&&B.linkMode&&(k=z.metadata.redirect)!=null&&k.universal&&n&&(this.client.core.addLinkModeSupportedApp(z.metadata.redirect.universal),this.client.session.update(G,{transportType:he.link_mode})),U({auths:K,session:X})};this.events.once(T,b),this.events.once(v,S);let $;try{if(s){const x=sr("wc_sessionAuthenticate",N,D);this.client.core.history.set(_,x);const A=await this.client.core.crypto.encode("",x,{type:Ei,encoding:$r});$=Fi(n,_,A)}else await Promise.all([this.sendRequest({topic:_,method:"wc_sessionAuthenticate",params:N,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:D}),this.sendRequest({topic:_,method:"wc_sessionPropose",params:P,expiry:Ce.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:P.id})])}catch(x){throw this.events.off(T,b),this.events.off(v,S),x}return await this.setProposal(P.id,P),await this.setAuthRequest(D,{request:Ne(se({},N),{verifyContext:{}}),pairingTopic:_,transportType:o}),{uri:$??y,response:M}}),F(this,"approveSessionAuthenticate",async r=>{const{id:n,auths:i}=r,s=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[zr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(w){throw s.setError(qn.no_internet_connection),w}const o=this.getPendingAuthRequest(n);if(!o)throw s.setError(qn.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);const a=o.transportType||he.relay;a===he.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=Ki(c),h={type:ur,receiverPublicKey:c,senderPublicKey:l},f=[],p=[];for(const w of i){if(!await iu({cacao:w,projectId:this.client.core.projectId})){s.setError(qn.invalid_cacao);const I=fe("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:u,error:I,encodeOpts:h}),new Error(I.message)}s.addTrace(zr.cacaos_verified);const{p:m}=w,_=Vi(m.resources),y=[oa(m.iss)],E=as(m.iss);if(_){const I=su(_),O=ou(_);f.push(...I),y.push(...O)}for(const I of y)p.push(`${I}:${E}`)}const d=await this.client.core.crypto.generateSharedKey(l,c);s.addTrace(zr.create_authenticated_session_topic);let g;if((f==null?void 0:f.length)>0){g={topic:d,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Ee(wn),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Cu([...new Set(f)],[...new Set(p)]),transportType:a},s.addTrace(zr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(w){throw s.setError(qn.subscribe_authenticated_session_topic_failure),w}s.addTrace(zr.subscribe_authenticated_session_topic_success),await this.client.session.set(d,g),s.addTrace(zr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(zr.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:n,result:{cacaos:i,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(w){throw s.setError(qn.authenticated_session_approve_publish_failure),w}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:g}}),F(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:n,reason:i}=r,s=this.getPendingAuthRequest(n);if(!s)throw new Error(`Could not find pending auth request with id ${n}`);s.transportType===he.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Ki(o),l={type:ur,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:i,encodeOpts:l,rpcOpts:Ce.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.deleteProposal(n)}),F(this,"formatAuthMessage",r=>{this.isInitialized();const{request:n,iss:i}=r;return Ed(n,i)}),F(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),F(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&s.topic&&s.topic!==n.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),F(this,"deleteSession",async r=>{var n;const{topic:i,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,fe("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(gh).catch(l=>this.client.logger.warn(l)),i===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=kt.idle),await Promise.all(this.getPendingSessionRequests().filter(l=>l.topic===i).map(l=>this.deletePendingSessionRequest(l.id,fe("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),F(this,"deleteProposal",async(r,n)=>{if(n)try{const i=this.client.proposal.get(r),s=this.client.core.eventClient.getEvent({topic:i.pairingTopic});s==null||s.setError(qr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,fe("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),F(this,"deletePendingSessionRequest",async(r,n,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),i&&(this.sessionRequestQueue.state=kt.idle,this.client.events.emit("session_request_expire",{id:r}))}),F(this,"deletePendingAuthRequest",async(r,n,i=!1)=>{await Promise.all([this.client.auth.requests.delete(r,n),i?Promise.resolve():this.client.core.expirer.del(r)])}),F(this,"setExpiry",async(r,n)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,n),await this.client.session.update(r,{expiry:n}))}),F(this,"setProposal",async(r,n)=>{this.client.core.expirer.set(r,Ee(Ce.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,n)}),F(this,"setAuthRequest",async(r,n)=>{const{request:i,pairingTopic:s,transportType:o=he.relay}=n;this.client.core.expirer.set(r,i.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:r,pairingTopic:s,verifyContext:i.verifyContext,transportType:o})}),F(this,"setPendingSessionRequest",async r=>{const{id:n,topic:i,params:s,verifyContext:o}=r,a=s.request.expiryTimestamp||Ee(Ce.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:i,params:s,verifyContext:o})}),F(this,"sendRequest",async r=>{const{topic:n,method:i,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h,publishOpts:f={}}=r,p=sr(i,s,c);let d;const g=!!u;try{const _=g?$r:tt;d=await this.client.core.crypto.encode(n,p,{encoding:_})}catch(_){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),_}let w;if(lA.includes(i)){const _=Et(JSON.stringify(p)),y=Et(d);w=await this.client.core.verify.register({id:y,decryptedId:_})}const m=se(se({},Ce[i].req),f);if(m.attestation=w,o&&(m.ttl=o),a&&(m.id=a),this.client.core.history.set(n,p),g){const _=Fi(u,n,d);await Y.Linking.openURL(_,this.client.name)}else m.tvf=Ne(se({},h),{correlationId:p.id}),l?(m.internal=Ne(se({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,d,m)):this.client.core.relayer.publish(n,d,m).catch(_=>this.client.logger.error(_));return p.id}),F(this,"sendProposeSession",async r=>{const{proposal:n,publishOpts:i}=r,s=sr("wc_sessionPropose",n,n.id);this.client.core.history.set(n.pairingTopic,s);const o=await this.client.core.crypto.encode(n.pairingTopic,s,{encoding:tt}),a=Et(JSON.stringify(s)),c=Et(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:n.pairingTopic,sessionProposal:o},opts:Ne(se({},i),{publishMethod:"wc_proposeSession",attestation:l})})}),F(this,"sendApproveSession",async r=>{const{sessionTopic:n,pairingProposalResponse:i,proposal:s,sessionSettleRequest:o,publishOpts:a}=r,c=ds(s.id,i),l=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:tt}),u=sr("wc_sessionSettle",o,a==null?void 0:a.id),h=await this.client.core.crypto.encode(n,u,{encoding:tt});this.client.core.history.set(n,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:n,pairingTopic:s.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:Ne(se({},a),{publishMethod:"wc_approveSession"})})}),F(this,"sendResult",async r=>{const{id:n,topic:i,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,l=ds(n,s);let u;const h=c&&typeof(Y==null?void 0:Y.Linking)<"u";try{const d=h?$r:tt;u=await this.client.core.crypto.encode(i,l,Ne(se({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),d}let f,p;try{f=await this.client.core.history.get(i,n);const d=f.request;try{p=this.getTVFParams(n,d.params,s)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g==null?void 0:g.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${n}) failed`),d}if(h){const d=Fi(c,i,u);await Y.Linking.openURL(d,this.client.name)}else{const d=f.request.method,g=Ce[d].res;g.tvf=Ne(se({},p),{correlationId:n}),o?(g.internal=Ne(se({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,u,g)):this.client.core.relayer.publish(i,u,g).catch(w=>this.client.logger.error(w))}await this.client.core.history.resolve(l)}),F(this,"sendError",async r=>{const{id:n,topic:i,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=r,l=uc(n,s);let u;const h=c&&typeof(Y==null?void 0:Y.Linking)<"u";try{const p=h?$r:tt;u=await this.client.core.crypto.encode(i,l,Ne(se({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),p}let f;try{f=await this.client.core.history.get(i,n)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${i}, ${n}) failed`),p}if(h){const p=Fi(c,i,u);await Y.Linking.openURL(p,this.client.name)}else{const p=f.request.method,d=a||Ce[p].res;this.client.core.relayer.publish(i,u,d)}await this.client.core.history.resolve(l)}),F(this,"cleanup",async()=>{const r=[],n=[];this.client.session.getAll().forEach(i=>{let s=!1;xr(i.expiry)&&(s=!0),this.client.core.crypto.keychain.has(i.topic)||(s=!0),s&&r.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{xr(i.expiryTimestamp)&&n.push(i.id)}),await Promise.all([...r.map(i=>this.deleteSession({topic:i})),...n.map(i=>this.deleteProposal(i))])}),F(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),F(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),F(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===kt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=kt.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=kt.idle}),F(this,"processRequest",async r=>{const{topic:n,payload:i,attestation:s,transportType:o,encryptedId:a}=r,c=i.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:i,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,i);case"wc_sessionPing":return await this.onSessionPingRequest(n,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:i,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:i,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),F(this,"onRelayEventResponse",async r=>{const{topic:n,payload:i,transportType:s}=r,o=(await this.client.core.history.get(n,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(n,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,i);case"wc_sessionExtend":return this.onSessionExtendResponse(n,i);case"wc_sessionPing":return this.onSessionPingResponse(n,i);case"wc_sessionRequest":return this.onSessionRequestResponse(n,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),F(this,"onRelayEventUnknownPayload",r=>{const{topic:n}=r,{message:i}=j("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),F(this,"shouldIgnorePairingRequest",r=>{const{topic:n,requestMethod:i}=r,s=this.expectedPairingMethodMap.get(n);return!s||s.includes(i)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),F(this,"onSessionProposeRequest",async r=>{const{topic:n,payload:i,attestation:s,encryptedId:o}=r,{params:a,id:c}=i;try{const l=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(tr.proposal_listener_not_found)),this.isValidConnect(se({},i.params));const u=a.expiryTimestamp||Ee(Ce.wc_sessionPropose.req.ttl),h=se({id:c,pairingTopic:n,expiryTimestamp:u,attestation:s,encryptedId:o},a);await this.setProposal(c,h);const f=await this.getVerifyContext({attestationId:s,hash:Et(JSON.stringify(i)),encryptedId:o,metadata:h.proposer.metadata});l==null||l.addTrace(Mt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(l){await this.sendError({id:c,topic:n,error:l,rpcOpts:Ce.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),F(this,"onSessionProposeResponse",async(r,n,i)=>{const{id:s}=n;if(Lt(n)){const{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(s,{sessionTopic:u,pairingTopic:r,proposalId:s,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(_t(n)){await this.deleteProposal(s);const o=ae("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),F(this,"onSessionSettleRequest",async(r,n)=>{const{id:i,params:s}=n;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:p}=n.params,d=[...this.pendingSessions.values()].find(m=>m.sessionTopic===r);if(!d)return this.client.logger.error(`Pending session not found for topic ${r}`);const g=this.client.proposal.get(d.proposalId),w=Ne(se(se(se({topic:r,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:he.relay,authentication:p==null?void 0:p.authentication,walletPayResult:p==null?void 0:p.walletPay});await this.client.session.set(w.topic,w),await this.setExpiry(w.topic,w.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:w.peer.metadata}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(w),await this.sendResult({id:n.id,topic:r,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:w}),this.events.emit(ae("session_connect",d.proposalId),{session:w})}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionSettleResponse",async(r,n)=>{const{id:i}=n;Lt(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ae("session_approve",i),{})):_t(n)&&(await this.client.session.delete(r,fe("USER_DISCONNECTED")),this.events.emit(ae("session_approve",i),{error:n.error}))}),F(this,"onSessionUpdateRequest",async(r,n)=>{const{params:i,id:s}=n;try{const o=`${r}_session_update`,a=Ln.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:r,error:fe("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(se({topic:r},i));try{Ln.set(o,s),await this.client.session.update(r,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:r,result:!0})}catch(c){throw Ln.delete(o),c}this.client.events.emit("session_update",{id:s,topic:r,params:i})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"isRequestOutOfSync",(r,n)=>n.toString().slice(0,-3)<r.toString().slice(0,-3)),F(this,"onSessionUpdateResponse",(r,n)=>{const{id:i}=n,s=ae("session_update",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Lt(n)?this.events.emit(ae("session_update",i),{}):_t(n)&&this.events.emit(ae("session_update",i),{error:n.error})}),F(this,"onSessionExtendRequest",async(r,n)=>{const{id:i}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Ee(wn)),await this.sendResult({id:i,topic:r,result:!0}),this.client.events.emit("session_extend",{id:i,topic:r})}catch(s){await this.sendError({id:i,topic:r,error:s}),this.client.logger.error(s)}}),F(this,"onSessionExtendResponse",(r,n)=>{const{id:i}=n,s=ae("session_extend",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Lt(n)?this.events.emit(ae("session_extend",i),{}):_t(n)&&this.events.emit(ae("session_extend",i),{error:n.error})}),F(this,"onSessionPingRequest",async(r,n)=>{const{id:i}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:i,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:r})}catch(s){await this.sendError({id:i,topic:r,error:s}),this.client.logger.error(s)}}),F(this,"onSessionPingResponse",(r,n)=>{const{id:i}=n,s=ae("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);Lt(n)?this.events.emit(ae("session_ping",i),{}):_t(n)&&this.events.emit(ae("session_ping",i),{error:n.error})},500)}),F(this,"onSessionDeleteRequest",async(r,n)=>{const{id:i}=n;try{await this.isValidDisconnect({topic:r,reason:n.params}),this.cleanupPendingSentRequestsForTopic({topic:r,error:fe("USER_DISCONNECTED")}),await this.deleteSession({topic:r,id:i})}catch(s){this.client.logger.error(s)}}),F(this,"onSessionRequest",async r=>{var n,i,s;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=r,{id:h,params:f}=a;try{await this.isValidRequest(se({topic:o},f));const p=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:Et(JSON.stringify(sr("wc_sessionRequest",f,h))),encryptedId:l,metadata:p.peer.metadata,transportType:u}),g={id:h,topic:o,params:f,verifyContext:d};await this.setPendingSessionRequest(g),u===he.link_mode&&(n=p.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((i=p.peer.metadata.redirect)==null?void 0:i.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),F(this,"onSessionRequestResponse",(r,n)=>{const{id:i}=n,s=ae("session_request",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Lt(n)?this.events.emit(ae("session_request",i),{result:n.result}):_t(n)&&this.events.emit(ae("session_request",i),{error:n.error})}),F(this,"onSessionEventRequest",async(r,n)=>{const{id:i,params:s}=n;try{const o=`${r}_session_event_${s.event.name}`,a=Ln.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(se({topic:r},s)),this.client.events.emit("session_event",{id:i,topic:r,params:s}),Ln.set(o,i)}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionAuthenticateResponse",(r,n)=>{const{id:i}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:n}),Lt(n)?this.events.emit(ae("session_request",i),{result:n.result}):_t(n)&&this.events.emit(ae("session_request",i),{error:n.error})}),F(this,"onSessionAuthenticateRequest",async r=>{var n;const{topic:i,payload:s,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:l,authPayload:u,expiryTimestamp:h}=s.params,f=await this.getVerifyContext({attestationId:o,hash:Et(JSON.stringify(s)),encryptedId:a,metadata:l.metadata,transportType:c}),p={requester:l,pairingTopic:i,id:s.id,authPayload:u,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:p,pairingTopic:i,transportType:c}),c===he.link_mode&&(n=l.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:f})}catch(l){this.client.logger.error(l);const u=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(s.params.requester.metadata,c),p={type:ur,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:s.id,topic:i,error:l,encodeOpts:p,rpcOpts:Ce.wc_sessionAuthenticate.autoReject,appLink:f})}}),F(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),F(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=kt.idle,this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay))}),F(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:n})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{this.events.emit(ae("session_request",s.request.id),{error:n})})}),F(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===kt.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(n){this.client.logger.error(n)}}),F(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=kt.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),F(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const n=this.client.proposal.getAll().find(i=>i.pairingTopic===r.topic);n&&this.onSessionProposeRequest({topic:r.topic,payload:sr("wc_sessionPropose",Ne(se({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id),attestation:n.attestation,encryptedId:n.encryptedId})}),F(this,"isValidConnect",async r=>{if(!Xe(r)){const{message:l}=j("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(l)}const{pairingTopic:n,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Ae(n)||await this.isValidPairingTopic(n),!nS(c)){const{message:l}=j("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(i&&!Ae(i)&&ai(i)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(i,"requiredNamespaces")}if(s&&!Ae(s)&&ai(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),o&&!Ae(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ae(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),F(this,"validateNamespaces",(r,n)=>{const i=rS(r,"connect()",n);if(i)throw new Error(i.message)}),F(this,"isValidApprove",async r=>{if(!Xe(r))throw new Error(j("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:i,relayProtocol:s,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const c=this.client.proposal.get(n),l=Ao(i,"approve()");if(l)throw new Error(l.message);const u=Bu(c.requiredNamespaces,i,"approve()");if(u)throw new Error(u.message);if(!me(s,!0)){const{message:h}=j("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if(o&&!Ae(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ae(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(i));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),F(this,"isValidReject",async r=>{if(!Xe(r)){const{message:s}=j("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:n,reason:i}=r;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!sS(i)){const{message:s}=j("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(s)}}),F(this,"isValidSessionSettleRequest",r=>{if(!Xe(r)){const{message:l}=j("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:n,controller:i,namespaces:s,expiry:o}=r;if(!op(n)){const{message:l}=j("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=Z3(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Ao(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(xr(o)){const{message:l}=j("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),F(this,"isValidUpdate",async r=>{if(!Xe(r)){const{message:c}=j("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:n,namespaces:i}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const s=this.client.session.get(n),o=Ao(i,"update()");if(o)throw new Error(o.message);const a=Bu(s.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),F(this,"isValidExtend",async r=>{if(!Xe(r)){const{message:i}=j("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(i)}const{topic:n}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),F(this,"isValidRequest",async r=>{if(!Xe(r)){const{message:c}=j("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:n,request:i,chainId:s,expiry:o}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!Ru(a,s)){const{message:c}=j("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!oS(i)){const{message:c}=j("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!lS(a,s,i.method)){const{message:c}=j("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),F(this,"isValidRespond",async r=>{var n;if(!Xe(r)){const{message:a}=j("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:i,response:s}=r;try{await this.isValidSessionTopic(i)}catch(a){throw(n=r==null?void 0:r.response)!=null&&n.id&&this.cleanupAfterResponse(r),a}if(!aS(s)){const{message:a}=j("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}const o=this.client.pendingRequest.get(s.id);if(o.topic!==i){const{message:a}=j("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${s.id}, expected topic: ${o.topic}, received topic: ${i}`);throw new Error(a)}}),F(this,"isValidPing",async r=>{if(!Xe(r)){const{message:i}=j("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(i)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),F(this,"isValidEmit",async r=>{if(!Xe(r)){const{message:a}=j("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:n,event:i,chainId:s}=r;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!Ru(o,s)){const{message:a}=j("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!cS(i)){const{message:a}=j("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!uS(o,s,i.name)){const{message:a}=j("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),F(this,"isValidDisconnect",async r=>{if(!Xe(r)){const{message:i}=j("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(i)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),F(this,"isValidAuthenticate",r=>{const{chains:n,uri:i,domain:s,nonce:o}=r;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!me(i,!1))throw new Error("uri is required parameter");if(!me(s,!1))throw new Error("domain is required parameter");if(!me(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>zi(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=zi(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),F(this,"getVerifyContext",async r=>{const{attestationId:n,hash:i,encryptedId:s,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Xn,validation:"UNKNOWN",origin:o.url||""}};try{if(a===he.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:n,hash:i,encryptedId:s,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),F(this,"validateSessionProps",(r,n)=>{Object.values(r).forEach((i,s)=>{if(i==null){const{message:o}=j("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${i} for key ${Object.keys(r)[s]}`);throw new Error(o)}})}),F(this,"getPendingAuthRequest",r=>{const n=this.client.auth.requests.get(r);return typeof n=="object"?n:void 0}),F(this,"addToRecentlyDeleted",(r,n)=>{if(this.recentlyDeletedMap.set(r,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=s)break;this.recentlyDeletedMap.delete(o)}}}),F(this,"checkRecentlyDeleted",r=>{const n=this.recentlyDeletedMap.get(r);if(n){const{message:i}=j("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${r}`);throw new Error(i)}}),F(this,"isLinkModeEnabled",(r,n)=>{var i,s,o,a,c,l,u,h,f;return!r||n!==he.link_mode?!1:((s=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=r==null?void 0:r.redirect)==null?void 0:u.universal)!==void 0&&((h=r==null?void 0:r.redirect)==null?void 0:h.universal)!==""&&((f=r==null?void 0:r.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(Y==null?void 0:Y.Linking)<"u"}),F(this,"getAppLinkIfEnabled",(r,n)=>{var i;return this.isLinkModeEnabled(r,n)?(i=r==null?void 0:r.redirect)==null?void 0:i.universal:void 0}),F(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const n=Hl(r,"topic")||"",i=decodeURIComponent(Hl(r,"wc_ev")||""),s=this.client.session.keys.includes(n);s&&this.client.session.update(n,{transportType:he.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:i,sessionExists:s})}),F(this,"registerLinkModeListeners",async()=>{var r;if(Xa()||kr()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const n=Y==null?void 0:Y.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await n.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),F(this,"getTVFApproveParams",r=>{try{const n=np(r.namespaces),i=U3(r.namespaces),s=k3(r.namespaces),o=r.sessionProperties,a=r.scopedProperties;return{approvedChains:n,approvedMethods:i,approvedEvents:s,sessionProperties:o,scopedProperties:a}}catch(n){return this.client.logger.warn(n,"Error getting TVF approve params"),{}}}),F(this,"getTVFParams",(r,n,i)=>{var s,o,a;if(!((s=n.request)!=null&&s.method))return{};const c={correlationId:r,rpcMethods:[n.request.method],chainId:n.chainId};try{const l=this.extractTxHashesFromResult(n.request,i);c.txHashes=l,c.contractAddresses=this.isValidContractData(n.request.params)?[(a=(o=n.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn(l,"Error getting TVF params")}return c}),F(this,"isValidContractData",r=>{var n;if(!r)return!1;try{const i=(r==null?void 0:r.data)||((n=r==null?void 0:r[0])==null?void 0:n.data);if(!i.startsWith("0x"))return!1;const s=i.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),F(this,"extractTxHashesFromResult",(r,n)=>{var i;try{if(!n)return[];const s=r.method,o=aA[s];if(s==="sui_signTransaction")return[I_(n.transactionBytes)];if(s==="near_signTransaction")return[eu(n)];if(s==="near_signTransactions")return n.map(c=>eu(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(i=n.tx_json)==null?void 0:i.hash];if(s==="polkadot_signTransaction")return[AS({transaction:r.params.transactionPayload,signature:n.signature})];if(s==="algo_signTxn")return nn(n)?n.map(c=>tu(c)):[tu(n)];if(s==="cosmos_signDirect")return[O_(n)];if(s==="wallet_sendCalls")return A_(n);if(typeof n=="string")return[n];const a=n[o.key];if(nn(a))return s==="solana_signAllTransactions"?a.map(c=>S_(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn(s,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[n,i]of Object.entries(r))for(const s of i)try{await this.onProviderMessageEvent({topic:n,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${s}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ge.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:n,attestation:i,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Wi)?this.client.auth.authKeys.get(Wi):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,n,{receiverPublicKey:o,encoding:s===he.link_mode?$r:tt});hc(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:i,transportType:s,encryptedId:Et(n)})):Ns(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:s}),this.client.core.history.delete(r,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:s})),await this.client.core.relayer.messages.ack(r,n)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${n}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(bt.expired,async e=>{const{topic:r,id:n}=id(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,j("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,j("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Hr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Hr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!me(e,!1)){const{message:r}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(xr(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=j("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!me(e,!1)){const{message:r}=j("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=j("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(xr(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=j("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=j("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(me(e,!1)){const{message:r}=j("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=j("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!iS(e)){const{message:r}=j("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=j("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(xr(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=j("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}validateRequestExpiry(e){if(e&&!dS(e,Bo)){const{message:r}=j("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${Bo.min} and ${Bo.max}`);throw new Error(r)}}}class EA extends ln{constructor(e,r){super(e,r,iA,dc),this.core=e,this.logger=r}}class _A extends ln{constructor(e,r){super(e,r,sA,dc),this.core=e,this.logger=r}}class xA extends ln{constructor(e,r){super(e,r,cA,dc,n=>n.id),this.core=e,this.logger=r}}class SA extends ln{constructor(e,r){super(e,r,fA,Bs,()=>Wi),this.core=e,this.logger=r}}class IA extends ln{constructor(e,r){super(e,r,dA,Bs),this.core=e,this.logger=r}}class DA extends ln{constructor(e,r){super(e,r,pA,Bs,n=>n.id),this.core=e,this.logger=r}}var OA=Object.defineProperty,AA=(t,e,r)=>e in t?OA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Uo=(t,e,r)=>AA(t,typeof e!="symbol"?e+"":e,r);class $A{constructor(e,r){this.core=e,this.logger=r,Uo(this,"authKeys"),Uo(this,"pairingTopics"),Uo(this,"requests"),this.authKeys=new SA(this.core,this.logger),this.pairingTopics=new IA(this.core,this.logger),this.requests=new DA(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var TA=Object.defineProperty,PA=(t,e,r)=>e in t?TA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,re=(t,e,r)=>PA(t,typeof e!="symbol"?e+"":e,r);class pc extends Gw{constructor(e){super(e),re(this,"protocol",Ap),re(this,"version",$p),re(this,"name",Ro.name),re(this,"metadata"),re(this,"core"),re(this,"logger"),re(this,"events",new Vt.EventEmitter),re(this,"engine"),re(this,"session"),re(this,"proposal"),re(this,"pendingRequest"),re(this,"auth"),re(this,"signConfig"),re(this,"on",(n,i)=>this.events.on(n,i)),re(this,"once",(n,i)=>this.events.once(n,i)),re(this,"off",(n,i)=>this.events.off(n,i)),re(this,"removeListener",(n,i)=>this.events.removeListener(n,i)),re(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),re(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"update",async n=>{try{return await this.engine.update(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"request",async n=>{try{return await this.engine.request(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"find",n=>{try{return this.engine.find(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),re(this,"authenticate",async(n,i)=>{try{return await this.engine.authenticate(n,i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}}),re(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}}),this.name=(e==null?void 0:e.name)||Ro.name,this.metadata=w2(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const r=ap({logger:(e==null?void 0:e.logger)||Ro.logger,name:this.name});this.logger=r,this.core=(e==null?void 0:e.core)||new nA(e),this.session=new _A(this.core,this.logger),this.proposal=new EA(this.core,this.logger),this.pendingRequest=new xA(this.core,this.logger),this.engine=new vA(this),this.auth=new $A(this.core,this.logger)}static async init(e){const r=new pc(e);return await r.initialize(),r}get context(){return ot(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const Pp=t=>{if(typeof t=="number")return`0x${t.toString(16)}`;if(typeof t=="string")return t.startsWith("0x")?t:`0x${parseInt(t,10).toString(16)}`;throw new Error(`Invalid chainId: ${t}`)};async function Cp(t){if(t.session.length){const e=t.session.keys.length-1;return t.session.get(t.session.keys[e])}return null}function CA(){return/Mobi|Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(window.navigator.userAgent)}function NA(t){return t.startsWith("solana:")}async function ar(t,e,r,n){const i=await Cp(t);if(!i)throw Xr.disconnected();return typeof window<"u"&&CA()&&i.peer.metadata.redirect&&i.peer.metadata.redirect.native&&window.open(i.peer.metadata.redirect.native,"_blank"),t.request({topic:i.topic,chainId:e,request:{method:r,params:NA(e)?oe(oe({},n),{},{pubkey:i.self.publicKey}):n}})}async function In(t){const e=await Cp(t);if(!e)throw Xr.disconnected();const r=Qf(e.namespaces);if(r&&r.length)return[...new Set(r.map(n=>Xf(n).address))];throw Pt.connectionError("Failed to get accounts")}function RA({connector:t,chainId:e}){return{getPrivateKey:async()=>{throw Re.methodNotSupported()},getPublicKey:async()=>{throw Re.methodNotSupported()},getAccounts:async r=>In(t),processTransaction:async(r,n)=>await ar(t,`eip155:${e}`,mn.ETH_TRANSACTION,[r]),processSignTransaction:async(r,n)=>await ar(t,`eip155:${e}`,"eth_signTransaction",[r]),processEthSignMessage:async(r,n)=>await ar(t,`eip155:${e}`,mn.ETH_SIGN,[r.from,r.data]),processPersonalMessage:async(r,n)=>await ar(t,`eip155:${e}`,mn.PERSONAL_SIGN,[r.data,r.from]),processTypedMessageV4:async r=>await ar(t,`eip155:${e}`,mn.ETH_SIGN_TYPED_DATA_V4,[r.from,r.data])}}function BA({connector:t,chainId:e}){return{requestAccounts:async r=>In(t),getPrivateKey:async()=>{throw Re.methodNotSupported()},getSecretKey:async()=>{throw Re.methodNotSupported()},getPublicKey:async()=>{throw Re.methodNotSupported()},getAccounts:async r=>In(t),signAllTransactions:async r=>{throw Re.methodNotSupported()},signAndSendTransaction:async r=>{throw Re.methodNotSupported()},signMessage:async r=>(await ar(t,`solana:${ko[e]}`,Gi.SIGN_MESSAGE,{message:ug.encode(ie.from(r.params.data,"utf-8"))})).signature,signTransaction:async r=>{if((await In(t)).length===0)throw Xr.disconnected();return(await ar(t,`solana:${ko[e]}`,Gi.SIGN_TRANSACTION,{transaction:r.params.message})).signature}}}async function UA({connector:t,chainId:e,newChainId:r}){await ar(t,`eip155:${e}`,"wallet_switchEthereumChain",[{chainId:r}])}async function kA({connector:t,chainId:e,chainConfig:r}){if(!r)throw Xr.custom({message:"Chain config is required",code:4902});const n=Pp(r.chainId),i=oe(oe({},r),{},{chainId:n});await ar(t,`eip155:${e}`,"wallet_addEthereumChain",[i])}function MA({getAccounts:t,getPrivateKey:e,getPublicKey:r,processEthSignMessage:n,processPersonalMessage:i,processTransaction:s,processSignTransaction:o,processTypedMessageV4:a}){if(!t)throw new Error("opts.getAccounts is required");async function c(m,_){if(typeof m=="string"&&m.length>0){const E=(await t(_)).map(O=>O.toLowerCase()),I=m.toLowerCase();if(E.includes(I))return I}throw Re.invalidParams({message:"Invalid parameters: must provide an Ethereum address."})}async function l(m,_){_.result=await t(m)}async function u(m,_){if(!s)throw Re.methodNotSupported();const y=m.params[0]||{from:""};y.from=await c(y.from,m),_.result=await s(y,m)}async function h(m,_){if(!o)throw Re.methodNotSupported();const y=m.params[0]||{from:""};y.from=await c(y.from,m),_.result=await o(y,m)}async function f(m,_){if(!n)throw Re.methodNotSupported();let y=m.params;const E=m.params[2]||{};if(Array.isArray(m.params)){if(m.params.length!==2)throw new Error(`WalletMiddleware - incorrect params for ${m.method} method. expected [address, message]`);const I=m.params,O=I[0],N=I[1];y={from:O,data:N}}y=oe(oe({},E),y),_.result=await n(y,m)}async function p(m,_){if(!a)throw Re.methodNotSupported();if(!(m!=null&&m.params))throw new Error("WalletMiddleware - missing params");let y=m.params;if(Array.isArray(m.params)){if(m.params.length!==2)throw new Error(`WalletMiddleware - incorrect params for ${m.method} method. expected [address, typedData]`);const E=m.params,I=E[0],O=E[1];y={from:I,data:O}}_.result=await a(y,m)}async function d(m,_){if(!i)throw Re.methodNotSupported();let y=m.params;const E=m.params[2]||{};if(Array.isArray(m.params)){if(!(m.params.length>=2))throw new Error(`WalletMiddleware - incorrect params for ${m.method} method. expected [message, address]`);const I=m.params;if(typeof I[0]=="object"){const{challenge:O,address:N}=I[0];y={from:N,data:O}}else{const O=I[0];y={from:I[1],data:O}}}y=oe(oe({},E),y),_.result=await i(y,m)}async function g(m,_){if(!e)throw Re.methodNotSupported();_.result=await e(m)}async function w(m,_){if(!r)throw Re.methodNotSupported();_.result=await r(m)}return Na({eth_accounts:ct(l),eth_requestAccounts:ct(l),eth_private_key:ct(g),eth_public_key:ct(w),public_key:ct(w),private_key:ct(g),eth_sendTransaction:ct(u),eth_signTransaction:ct(h),eth_sign:ct(f),eth_signTypedData_v4:ct(p),personal_sign:ct(d)})}function FA(t){const{getAccounts:e,getPrivateKey:r,getPublicKey:n,processTransaction:i,processSignTransaction:s,processEthSignMessage:o,processTypedMessageV4:a,processPersonalMessage:c}=t;return vh([Na({eth_syncing:!1}),MA({getAccounts:e,getPrivateKey:r,getPublicKey:n,processTransaction:i,processEthSignMessage:o,processSignTransaction:s,processTypedMessageV4:a,processPersonalMessage:c})])}function LA({switchChain:t,addChain:e}){async function r(i,s){var o;const a=(o=i.params)!==null&&o!==void 0&&o.length?i.params[0]:void 0;if(!a)throw Re.invalidParams("Missing chainId");s.result=await t(a)}async function n(i,s){var o;const a=(o=i.params)!==null&&o!==void 0&&o.length?i.params[0]:void 0;if(!a)throw Re.invalidParams("Missing chainConfig");s.result=await e(a)}return Na({wallet_switchEthereumChain:ct(r),wallet_addEthereumChain:ct(n)})}function jA(t){return(e,r,n,i)=>e.method==="eth_chainId"?(r.result=t,i()):n()}function qA(t){return(e,r,n,i)=>e.method==="eth_provider_config"?(r.result=t,i()):n()}function zA(t){const{chainId:e,rpcTarget:r}=t,n=Gp({rpcTarget:r});return{networkMiddleware:vh([jA(e),qA(t),n]),fetchMiddleware:n}}var Np;class ps extends Yp{constructor({config:e,state:r,connector:n}){super({config:{chain:e.chain,chains:e.chains,skipLookupNetwork:!!e.skipLookupNetwork},state:oe(oe({},r||{}),{},{chainId:"loading",accounts:[]})}),lt(this,"connector",null),this.connector=n||null}async enable(){if(!this.connector)throw Xr.custom({message:"Connector is not initialized, pass wallet connect connector in constructor",code:4902});return await this.setupProvider(this.connector),this._providerEngineProxy.request({method:"eth_accounts"})}async setupProvider(e){this.onConnectorStateUpdate(e),await this.setupEngine(e,this.config.chain.chainId)}async switchChain({chainId:e}){if(!this.connector)throw Xr.custom({message:"Connector is not initialized, pass wallet connect connector in constructor",code:4902});if(!this.getChain(e))throw Pt.connectionError("Chain config is not available");const n=parseInt(this.getCurrentChainId(),16);await UA({connector:this.connector,chainId:n,newChainId:e}),await this.setupEngine(this.connector,e),this.lookupNetwork(this.connector,e),this.update({chainId:e})}async addChain(e){if(!this.connector)throw Xr.custom({message:"Connector is not initialized, pass wallet connect connector in constructor",code:4902});const r=parseInt(this.getCurrentChainId(),16);await kA({connector:this.connector,chainId:r,chainConfig:e})}async lookupNetwork(e,r){return r}async setupEngine(e,r){const n=this.getChain(r);if(n.chainNamespace===rt.EIP155)await this.setupEthEngine(e,r);else if(n.chainNamespace===rt.SOLANA)await this.setupSolEngine(e,r);else throw new Error(`Unsupported chainNamespace: ${n.chainNamespace}`);this.emit("chainChanged",r),this.emit("connect",{chainId:r}),this.update({chainId:r})}async setupEthEngine(e,r){const n=this.getChain(r),i=parseInt(r,16),s=RA({connector:e,chainId:i}),o=await In(e);this.update({accounts:o||[]});const a=FA(s),c=this.getEthChainSwitchMiddleware(),l=new _c,{networkMiddleware:u}=zA(n);l.push(a),l.push(c),l.push(u);const h=xc(l);this.updateProviderEngineProxy(h)}async setupSolEngine(e,r){const n=this.getChain(r),i=BA({connector:e,chainId:r}),s=await In(e);this.update({accounts:s||[]});const o=hg(i),a=new _c,{networkMiddleware:c}=fg(n);a.push(o),a.push(c);const l=xc(a);this.updateProviderEngineProxy(l)}getEthChainSwitchMiddleware(){return LA({switchChain:async n=>{const{chainId:i}=n;await this.switchChain({chainId:i})},addChain:async n=>{await this.addChain(n)}})}connectedTopic(){var e;if(!this.connector)throw Pt.notConnectedError("Wallet connect connector is not connected");if((e=this.connector)!==null&&e!==void 0&&(e=e.session)!==null&&e!==void 0&&e.length){var r;const n=this.connector.session.keys.length-1;return(r=this.connector.session.get(this.connector.session.keys[n]))===null||r===void 0?void 0:r.topic}}checkIfAccountAllowed(e){if(!this.connector||!this.connectedTopic())return!1;const r=this.connector.session.get(this.connectedTopic()),n=Qf(r.namespaces);let i=!1;for(const o of n){var s;if(((s=Xf(o).address)===null||s===void 0?void 0:s.toLowerCase())===(e==null?void 0:e.toLowerCase())){i=!0;break}}return i}async onConnectorStateUpdate(e){e.events.on("session_event",async r=>{if(Ze.debug("session_event data",r),!this.provider)throw Pt.notConnectedError("Wallet connect connector is not connected");const{event:n}=r.params,{name:i,data:s}=n||{};if(i==="accountsChanged"&&s!==null&&s!==void 0&&s.length&&this.state.accounts[0]!==s[0]&&this.checkIfAccountAllowed(s[0])&&(this.update({accounts:s}),this.emit("accountsChanged",s)),n.name==="chainChanged"){if(!s)return;const a=Pp(s),{currentChain:c}=this;a&&c.chainId!==a&&await this.setupEngine(e,a)}})}getCurrentChainId(){const e=this.state.chainId;return!e||e==="loading"?this.config.chains[0].chainId:e}}Np=ps;lt(ps,"getProviderInstance",async t=>{const e=new Np({config:{chain:t.chain,chains:t.chains,skipLookupNetwork:t.skipLookupNetwork}});return await e.setupProvider(t.connector),e});class VA extends Zp{constructor(e){var r,n,i,s,o;super(e),lt(this,"name",pr.WALLET_CONNECT_V2),lt(this,"connectorNamespace",Jp.MULTICHAIN),lt(this,"currentChainNamespace",rt.OTHER),lt(this,"type",Xp.EXTERNAL),lt(this,"connectorOptions",void 0),lt(this,"status",Me.NOT_READY),lt(this,"connectorData",{uri:""}),lt(this,"connector",null),lt(this,"activeSession",null),lt(this,"wcProvider",null),lt(this,"analytics",void 0),this.connectorOptions=oe({},e);const{qrcodeModal:a,walletConnectInitOptions:c}=(e==null?void 0:e.connectorSettings)||{};this.connectorOptions=oe(oe({},this.connectorOptions),{},{connectorSettings:(r=(n=this.connectorOptions)===null||n===void 0?void 0:n.connectorSettings)!==null&&r!==void 0?r:{},loginSettings:(i=(s=this.connectorOptions)===null||s===void 0?void 0:s.loginSettings)!==null&&i!==void 0?i:{}}),this.analytics=e.analytics,a&&(this.connectorOptions.connectorSettings.qrcodeModal=a),c&&(this.connectorOptions.connectorSettings.walletConnectInitOptions=oe(oe({},(o=this.connectorOptions.connectorSettings.walletConnectInitOptions)!==null&&o!==void 0?o:{}),c));const{loginSettings:l}=e;l&&(this.connectorOptions.loginSettings=oe(oe({},this.connectorOptions.loginSettings||{}),l))}get connected(){return!!this.activeSession}get provider(){return this.status!==Me.NOT_READY&&this.wcProvider?this.wcProvider:null}set provider(e){throw new Error("Not implemented")}async init(e){var r;const n=this.coreOptions.chains.find(c=>c.chainId===e.chainId);super.checkInitializationRequirements({chainConfig:n});const i=(r=this.connectorOptions.connectorSettings)===null||r===void 0||(r=r.walletConnectInitOptions)===null||r===void 0?void 0:r.projectId,s=this.coreOptions.chains.filter(c=>c.chainNamespace===rt.EIP155||c.chainNamespace===rt.SOLANA);if(s.length===0)throw Ht.invalidParams("No supported chains found");const o=await Og(s,i);(!this.connectorOptions.loginSettings||Object.keys(this.connectorOptions.loginSettings).length===0)&&(this.connectorOptions.loginSettings=o.loginSettings),this.connectorOptions.connectorSettings=Qp(o.connectorSettings||{},this.connectorOptions.connectorSettings||{});const{connectorSettings:a}=this.connectorOptions;if(this.connector=await pc.init(a==null?void 0:a.walletConnectInitOptions),this.wcProvider=new ps({config:{chain:n,chains:this.coreOptions.chains},connector:this.connector}),this.emit(gt.READY,pr.WALLET_CONNECT_V2),this.status=Me.READY,Ze.debug("initializing wallet connect v2 connector"),e.autoConnect)if(await this.checkForPersistedSession(),this.connected){this.rehydrated=!0;try{await this.onConnectHandler({chain:n,getIdentityToken:e.getIdentityToken})}catch(c){Ze.error("wallet auto connect",c),this.emit(gt.REHYDRATION_ERROR,c)}}else this.status=Me.NOT_READY,this.emit(gt.CACHE_CLEAR)}async connect({chainId:e,getIdentityToken:r}){super.checkConnectionRequirements();const n=this.coreOptions.chains.find(l=>l.chainId===e);if(!n)throw Pt.connectionError("Chain config is not available");if(!this.connector)throw Ht.notReady("Wallet connector is not ready yet");const i=!this.connected&&!this.rehydrated,s=Date.now();let o={connector:this.name,connector_type:this.type,is_injected:this.isInjected,is_wallet_connect:!0,chain_id:eg(n),chain_name:n==null?void 0:n.displayName,chain_namespace:n==null?void 0:n.chainNamespace};try{const l=()=>{if(i){var u,h,f;const{name:p,url:d,redirect:g}=((u=this.activeSession)===null||u===void 0||(u=u.peer)===null||u===void 0?void 0:u.metadata)||{},{native:w,universal:m,linkMode:_}=g||{};o=oe(oe({},o),{},{connector:p||this.name,wallet_url:d,redirect_native:w,redirect_universal:m,redirect_link_mode_enabled:_}),(h=this.analytics)===null||h===void 0||h.track(xi.CONNECTION_STARTED,o),(f=this.analytics)===null||f===void 0||f.track(xi.CONNECTION_COMPLETED,oe(oe({},o),{},{duration:Date.now()-s}))}};return this.connected?(await this.onConnectHandler({chain:n,getIdentityToken:r}),this.provider):(this.status!==Me.CONNECTING&&await this.createNewSession({chainConfig:n,trackCompletionEvents:l,getIdentityToken:r}),this.provider)}catch(l){if(Ze.error("Wallet connect v2 connector error while connecting",l),this.status=Me.READY,this.rehydrated=!0,this.emit(gt.ERRORED,l),i){var a,c;(a=this.analytics)===null||a===void 0||a.track(xi.CONNECTION_STARTED,o),(c=this.analytics)===null||c===void 0||c.track(xi.CONNECTION_FAILED,oe(oe(oe({},o),tg(l)),{},{duration:Date.now()-s}))}throw l instanceof rg?l:Pt.connectionError(`Failed to login with wallet connect: ${(l==null?void 0:l.message)||""}`,l)}}async switchChain(e,r=!1){if(super.checkSwitchChainRequirements(e,r),!this.wcProvider)throw Ht.notReady("Wallet Connect provider is not ready yet");try{await this.wcProvider.switchChain({chainId:e.chainId})}catch(n){throw Ze.error("error while switching chain",n),n}}async getUserInfo(){if(!this.canAuthorize)throw Pt.notConnectedError("Not connected with wallet, Please login/connect first");return{}}async disconnect(e={cleanup:!1,sessionRemovedByWallet:!1}){var r,n;const{cleanup:i}=e;if(!this.connector||!this.connected||!((r=this.activeSession)!==null&&r!==void 0&&r.topic))throw Pt.notConnectedError("Not connected with wallet");e.sessionRemovedByWallet||await this.connector.disconnect({topic:(n=this.activeSession)===null||n===void 0?void 0:n.topic,reason:fe("USER_DISCONNECTED")}),this.rehydrated=!1,i?(this.connector=null,this.status=Me.NOT_READY,this.wcProvider=null):this.status=Me.READY,this.activeSession=null,this.emit(gt.DISCONNECTED)}async getIdentityToken(){if(!this.provider||!this.canAuthorize)throw Pt.notConnectedError();this.status=Me.AUTHORIZING,this.emit(gt.AUTHORIZING,{connector:pr.WALLET_CONNECT_V2});const{chainId:e}=this.provider,r=this.coreOptions.chains.find(s=>s.chainId===e);if(!r)throw Pt.connectionError("Chain config is not available");const{chainNamespace:n}=r,i=await this.provider.request({method:n===rt.EIP155?mn.GET_ACCOUNTS:Gi.GET_ACCOUNTS});if(i&&i.length>0){const s=ng(i[0],this.name);if(s&&!ig(s))return this.status=Me.AUTHORIZED,this.emit(gt.AUTHORIZED,{connector:pr.WALLET_CONNECT_V2,identityTokenInfo:{idToken:s}}),{idToken:s};const o={domain:window.location.origin,uri:window.location.href,address:i[0],chainId:parseInt(e,16),version:"1",nonce:Math.random().toString(36).slice(2),issuedAt:new Date().toISOString()},a=await sg(o,n),c=await this._getSignedMessage(a,i,n),l=await og(n,c,a,this.name,this.coreOptions.sessionTime,this.coreOptions.clientId,this.coreOptions.web3AuthNetwork);return ag(i[0],this.name,l),this.status=Me.AUTHORIZED,this.emit(gt.AUTHORIZED,{connector:pr.WALLET_CONNECT_V2,identityTokenInfo:{idToken:l}}),{idToken:l}}throw Pt.notConnectedError("Not connected with wallet, Please login/connect first")}async enableMFA(){throw new Error("Method Not implemented")}async manageMFA(){throw new Error("Method Not implemented")}cleanupPendingPairings(){if(!this.connector)throw Ht.notReady("Wallet connector is not ready yet");const e=this.connector.pairing.getAll({active:!1});nn(e)&&e.forEach(r=>{this.connector&&this.connector.pairing.delete(r.topic,fe("USER_DISCONNECTED"))})}async checkForPersistedSession(){if(!this.connector)throw Ht.notReady("Wallet connector is not ready yet");if(this.connector.session.length){const e=this.connector.session.keys.length-1;this.activeSession=this.connector.session.get(this.connector.session.keys[e])}return this.activeSession}async createNewSession({forceNewSession:e=!1,chainConfig:r,trackCompletionEvents:n,getIdentityToken:i}){try{var s,o;if(!this.connector)throw Ht.notReady("Wallet connector is not ready yet");if(!this.connectorOptions.loginSettings||Object.keys(this.connectorOptions.loginSettings).length===0)throw Ht.notReady("login settings are not set yet");if(this.status=Me.CONNECTING,this.emit(gt.CONNECTING,{connector:pr.WALLET_CONNECT_V2}),e&&(s=this.activeSession)!==null&&s!==void 0&&s.topic){var a;await this.connector.disconnect({topic:(a=this.activeSession)===null||a===void 0?void 0:a.topic,reason:fe("USER_DISCONNECTED")})}const{uri:l,approval:u}=await this.connector.connect(this.connectorOptions.loginSettings),h=(o=this.connectorOptions)===null||o===void 0||(o=o.connectorSettings)===null||o===void 0?void 0:o.qrcodeModal;if(l)if(h)try{await h.openModal({uri:l}),Ze.debug("EVENT","QR Code Modal closed"),this.status=Me.READY,this.emit(gt.READY,pr.WALLET_CONNECT_V2)}catch(p){Ze.error("unable to open qr code modal",p)}else this.updateConnectorData({uri:l});Ze.info("awaiting session approval from wallet");const f=await u();this.activeSession=f,await this.onConnectHandler({chain:r,trackCompletionEvents:n,getIdentityToken:i}),h&&h.closeModal()}catch(l){var c;if((c=l.message)!==null&&c!==void 0&&c.toLowerCase().includes("proposal expired")){if(Ze.info("current connector status: ",this.status),this.status===Me.CONNECTING)return Ze.info("retrying to create new wallet connect session since proposal expired"),this.createNewSession({forceNewSession:!0,chainConfig:r,getIdentityToken:i});if(this.status===Me.READY){Ze.info("ignoring proposal expired error since some other connector is connected");return}}throw Ze.error("error while creating new wallet connect session",l),this.emit(gt.ERRORED,l),l}}async onConnectHandler({chain:e,trackCompletionEvents:r,getIdentityToken:n}){var i;if(!this.connector||!this.wcProvider)throw Ht.notReady("Wallet connect connector is not ready yet");this.subscribeEvents(),(i=this.connectorOptions.connectorSettings)!==null&&i!==void 0&&i.qrcodeModal&&(this.wcProvider=new ps({config:{chain:e,chains:this.coreOptions.chains,skipLookupNetwork:!0},connector:this.connector})),await this.wcProvider.setupProvider(this.connector),this.cleanupPendingPairings(),this.status=Me.CONNECTED,r&&r();let s;this.emit(gt.CONNECTED,{connector:pr.WALLET_CONNECT_V2,reconnected:this.rehydrated,provider:this.provider,identityTokenInfo:s}),n&&(s=await this.getIdentityToken())}subscribeEvents(){if(!this.connector)throw Ht.notReady("Wallet connector is not ready yet");this.connector.events.on("session_update",({topic:e,params:r})=>{if(!this.connector)return;const{namespaces:n}=r,i=this.connector.session.get(e),s=oe(oe({},i),{},{namespaces:n});this.activeSession=s}),this.connector.events.on("session_delete",()=>{this.disconnect({sessionRemovedByWallet:!0})}),this.connector.events.on("session_expire",({topic:e})=>{var r;Ze.info("Session expired event received for topic:",e),((r=this.activeSession)===null||r===void 0?void 0:r.topic)===e&&this.disconnect({sessionRemovedByWallet:!0}).catch(n=>{Ze.error("Failed to disconnect expired session",n)})})}async _getSignedMessage(e,r,n){return await this.provider.request({method:n===rt.EIP155?mn.PERSONAL_SIGN:Gi.SIGN_MESSAGE,params:n===rt.EIP155?[e,r[0]]:{data:e}})}}const T6=t=>({coreOptions:e,projectConfig:r,analytics:n})=>{var i;const s=(t==null||(i=t.walletConnectInitOptions)===null||i===void 0?void 0:i.projectId)||(r==null?void 0:r.walletConnectProjectId),o=oe(oe({},t),{},{walletConnectInitOptions:oe(oe({},t==null?void 0:t.walletConnectInitOptions),{},{projectId:s})});return new VA({connectorSettings:o,coreOptions:e,analytics:n})};export{mg as DEFAULT_EIP155_METHODS,vg as DEFAULT_EIP_155_EVENTS,Eg as DEFAULT_SOLANA_EVENTS,bg as DEFAULT_SOLANA_METHODS,ps as WalletConnectV2Provider,xg as getNamespacesFromChains,Dg as getRequiredNamespaces,Ig as getSupportedEventsByNamespace,Sg as getSupportedMethodsByNamespace,Og as getWalletConnectV2Settings,T6 as walletConnectV2Connector};
